{"ast":null,"code":"import { Symbols, WidgetEventCapability, EventDirection, WidgetApi, WidgetApiToWidgetAction, CurrentApiVersions, UnstableApiVersion, MatrixCapabilities } from 'matrix-widget-api';\nimport Joi from 'joi';\nimport { stringify, parse } from 'qs';\nimport { filter, fromEvent, firstValueFrom, map, first, throwError, from, mergeAll, concat, ReplaySubject, share } from 'rxjs';\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Generate a list of capabilities to access the timeline of other rooms.\n * If enabled, all previously or future capabilities will apply to _all_\n * selected rooms.\n * If `Symbols.AnyRoom` is passed, this is expanded to all joined\n * or invited rooms the client is able to see, current and future.\n *\n * @param roomIds - a list of room ids or `@link Symbols.AnyRoom`.\n * @returns the generated capabilities.\n */\nfunction generateRoomTimelineCapabilities(roomIds) {\n  if (roomIds === Symbols.AnyRoom) {\n    return ['org.matrix.msc2762.timeline:*'];\n  }\n  if (Array.isArray(roomIds)) {\n    return roomIds.map(function (id) {\n      return \"org.matrix.msc2762.timeline:\".concat(id);\n    });\n  }\n  return [];\n}\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Generate a unique displayname of a user that is consistent across Matrix clients.\n *\n * @remarks The algorithm is based on https://spec.matrix.org/v1.1/client-server-api/#calculating-the-display-name-for-a-user\n *\n * @param member - the member to generate a name for.\n * @param allRoomMembers - a list of all members of the same room.\n * @returns the displayname that is unique in given the set of all room members.\n */\nfunction getRoomMemberDisplayName(member, allRoomMembers) {\n  if (allRoomMembers === void 0) {\n    allRoomMembers = [];\n  }\n  // If the m.room.member state event has no displayname field, or if that field\n  // has a null value, use the raw user id as the display name.\n  if (typeof member.content.displayname !== 'string') {\n    return member.state_key;\n  }\n  // If the m.room.member event has a displayname which is unique among members of\n  // the room with membership: join or membership: invite, ...\n  var hasDuplicateDisplayName = allRoomMembers.some(function (m) {\n    // same room\n    return m.room_id === member.room_id &&\n    // not the own event\n    m.state_key !== member.state_key &&\n    // only join or invite state\n    ['join', 'invite'].includes(m.content.membership) &&\n    // same displayname\n    m.content.displayname === member.content.displayname;\n  });\n  if (!hasDuplicateDisplayName) {\n    // ... use the given displayname as the user-visible display name.\n    return member.content.displayname;\n  } else {\n    // The m.room.member event has a non-unique displayname. This should be\n    // disambiguated using the user id, for example “display name (@id:homeserver.org)”.\n    return \"\".concat(member.content.displayname, \" (\").concat(member.state_key, \")\");\n  }\n}\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __assign$2 = undefined && undefined.__assign || function () {\n  __assign$2 = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign$2.apply(this, arguments);\n};\n/**\n * Check if the given event is a {@link StateEvent}.\n *\n * @param event - An event that is either a {@link RoomEvent} or a {@link StateEvent}.\n * @returns True, if the event is a {@link StateEvent}.\n */\nfunction isStateEvent(event) {\n  return 'state_key' in event && typeof event.state_key === 'string';\n}\n/**\n * Check if the given event is a {@link RoomEvent}.\n *\n * @param event - An event that is either a {@link RoomEvent} or a {@link StateEvent}.\n * @returns True, if the event is a {@link RoomEvent}.\n */\nfunction isRoomEvent(event) {\n  return !('state_key' in event);\n}\n/**\n * Check if the given value is a valid {@link RoomEvent}.\n *\n * @param event - The value to check\n * @returns true if value is a valid room event, else false.\n */\n// Allow any here, so that the validation works for every event\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction isValidRoomEvent(event) {\n  return roomEventSchema.validate(event).error === undefined;\n}\n/**\n * Check if the given value is a valid {@link StateEvent}.\n *\n * @param event - The value to check\n * @returns true if value is a valid state event, else false.\n */\n// Allow any here, so that the validation works for every event\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction isValidStateEvent(event) {\n  return stateEventSchema.validate(event).error === undefined;\n}\n/**\n * Check if the given value is a valid {@link ToDeviceMessageEvent}.\n *\n * @param event - The value to check\n * @returns true if value is a valid to device message, else false.\n */\nfunction isValidToDeviceMessageEvent(event) {\n  return toDeviceMessageSchema.validate(event).error === undefined;\n}\n/**\n * Base properties to validate for all events.\n */\nvar eventSchemaProps = {\n  type: Joi.string().required(),\n  // Do roughly check against the format\n  // https://spec.matrix.org/v1.13/appendices/#common-identifier-format\n  sender: Joi.string().pattern(new RegExp('^@[^\\\\s:]*:\\\\S*$')).required(),\n  room_id: Joi.string().pattern(new RegExp('^![^:]*:\\\\S*')).required(),\n  content: Joi.object().required()\n};\nvar roomEventSchema = Joi.object(__assign$2(__assign$2({}, eventSchemaProps), {\n  event_id: Joi.string().pattern(new RegExp('^\\\\$.*')).required(),\n  origin_server_ts: Joi.date().timestamp('javascript').required()\n})).unknown();\nvar stateEventSchema = Joi.object(__assign$2(__assign$2({}, eventSchemaProps), {\n  event_id: Joi.string().pattern(new RegExp('^\\\\$.*')),\n  origin_server_ts: Joi.date().timestamp('javascript'),\n  state_key: Joi.string().allow('').required()\n})).unknown();\nvar toDeviceMessageSchema = Joi.object({\n  type: Joi.string().required(),\n  sender: Joi.string().required(),\n  encrypted: Joi.boolean().required(),\n  content: Joi.object().required()\n}).unknown();\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __awaiter$4 = undefined && undefined.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator$4 = undefined && undefined.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function () {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n  return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (g && (g = 0, op[0] && (_ = 0)), _) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n/**\n * The capability that needs to be requested in order to navigate to another room.\n */\nvar WIDGET_CAPABILITY_NAVIGATE = 'org.matrix.msc2931.navigate';\n/**\n * Navigate the client to another matrix room.\n *\n * @remarks This requires the {@link WIDGET_CAPABILITY_NAVIGATE} capability.\n *\n * @param widgetApi - the {@link WidgetApi} instance.\n * @param roomId - the room ID.\n * @param opts - {@link NavigateToRoomOptions}\n */\nfunction navigateToRoom(widgetApi_1, roomId_1) {\n  return __awaiter$4(this, arguments, void 0, function (widgetApi, roomId, opts) {\n    var _a, via, params, url;\n    if (opts === void 0) {\n      opts = {};\n    }\n    return __generator$4(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          _a = opts.via, via = _a === void 0 ? [] : _a;\n          params = stringify({\n            via: via\n          }, {\n            addQueryPrefix: true,\n            arrayFormat: 'repeat'\n          });\n          url = \"https://matrix.to/#/\".concat(encodeURIComponent(roomId)).concat(params);\n          return [4 /*yield*/, widgetApi.navigateTo(url)];\n        case 1:\n          _b.sent();\n          return [2 /*return*/];\n      }\n    });\n  });\n}\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Compares two room events by their origin server timestamp.\n *\n * @param a - A room event\n * @param b - A room event\n * @returns Either zero if the timestamp is equal, \\>0 if a is newer, or \\<0 if\n *          b is newer.\n */\nfunction compareOriginServerTS(a, b) {\n  return a.origin_server_ts - b.origin_server_ts;\n}\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * The name of the power levels state event.\n */\nvar STATE_EVENT_POWER_LEVELS = 'm.room.power_levels';\nfunction isNumberOrUndefined(value) {\n  return value === undefined || typeof value === 'number';\n}\nfunction isStringToNumberMapOrUndefined(value) {\n  return value === undefined || value !== null && typeof value === 'object' && Object.entries(value).every(function (_a) {\n    var k = _a[0],\n      v = _a[1];\n    return typeof k === 'string' && typeof v === 'number';\n  });\n}\n/**\n * Validates that `event` is has a valid structure for a\n * {@link PowerLevelsStateEvent}.\n * @param event - The event to validate.\n * @returns True, if the event is valid.\n */\nfunction isValidPowerLevelStateEvent(event) {\n  if (event.type !== STATE_EVENT_POWER_LEVELS || typeof event.content !== 'object') {\n    return false;\n  }\n  var content = event.content;\n  if (!isStringToNumberMapOrUndefined(content.events)) {\n    return false;\n  }\n  if (!isNumberOrUndefined(content.state_default)) {\n    return false;\n  }\n  if (!isNumberOrUndefined(content.events_default)) {\n    return false;\n  }\n  if (!isStringToNumberMapOrUndefined(content.users)) {\n    return false;\n  }\n  if (!isNumberOrUndefined(content.users_default)) {\n    return false;\n  }\n  if (!isNumberOrUndefined(content.ban)) {\n    return false;\n  }\n  if (!isNumberOrUndefined(content.invite)) {\n    return false;\n  }\n  if (!isNumberOrUndefined(content.kick)) {\n    return false;\n  }\n  if (!isNumberOrUndefined(content.redact)) {\n    return false;\n  }\n  return true;\n}\n/**\n * Check if a user has the power to send a specific room event.\n *\n * @param powerLevelStateEvent - the content of the `m.room.power_levels` event\n * @param userId - the id of the user\n * @param eventType - the type of room event\n * @returns if true, the user has the power\n */\nfunction hasRoomEventPower(powerLevelStateEvent, userId, eventType) {\n  if (!powerLevelStateEvent) {\n    // See https://github.com/matrix-org/matrix-spec/blob/203b9756f52adfc2a3b63d664f18cdbf9f8bf126/data/event-schemas/schema/m.room.power_levels.yaml#L36-L43\n    return true;\n  }\n  var userLevel = calculateUserPowerLevel(powerLevelStateEvent, userId);\n  var eventLevel = calculateRoomEventPowerLevel(powerLevelStateEvent, eventType);\n  return userLevel >= eventLevel;\n}\n/**\n * Check if a user has the power to send a specific state event.\n *\n * @param powerLevelStateEvent - the content of the `m.room.power_levels` event\n * @param userId - the id of the user\n * @param eventType - the type of state event\n * @returns if true, the user has the power\n */\nfunction hasStateEventPower(powerLevelStateEvent, userId, eventType) {\n  if (!powerLevelStateEvent) {\n    // See https://github.com/matrix-org/matrix-spec/blob/203b9756f52adfc2a3b63d664f18cdbf9f8bf126/data/event-schemas/schema/m.room.power_levels.yaml#L36-L43\n    return true;\n  }\n  var userLevel = calculateUserPowerLevel(powerLevelStateEvent, userId);\n  var eventLevel = calculateStateEventPowerLevel(powerLevelStateEvent, eventType);\n  return userLevel >= eventLevel;\n}\n/**\n * Check if a user has the power to perform a specific action.\n *\n * Supported actions:\n *   * invite: Invite a new user into the room\n *   * kick: Kick a user from the room\n *   * ban: Ban a user from the room\n *   * redact: Redact a message from another user\n *\n * @param powerLevelStateEvent - the content of the `m.room.power_levels` event\n * @param userId - the id of the user\n * @param action - the action\n * @returns if true, the user has the power\n */\nfunction hasActionPower(powerLevelStateEvent, userId, action) {\n  if (!powerLevelStateEvent) {\n    // See https://github.com/matrix-org/matrix-spec/blob/203b9756f52adfc2a3b63d664f18cdbf9f8bf126/data/event-schemas/schema/m.room.power_levels.yaml#L36-L43\n    return true;\n  }\n  var userLevel = calculateUserPowerLevel(powerLevelStateEvent, userId);\n  var eventLevel = calculateActionPowerLevel(powerLevelStateEvent, action);\n  return userLevel >= eventLevel;\n}\n/**\n * Calculate the power level of the user based on a `m.room.power_levels` event.\n *\n * @param powerLevelStateEvent - the content of the `m.room.power_levels` event.\n * @param userId - the ID of the user.\n * @returns the power level of the user.\n */\nfunction calculateUserPowerLevel(powerLevelStateEvent, userId) {\n  var _a, _b, _c;\n  // See https://github.com/matrix-org/matrix-spec/blob/203b9756f52adfc2a3b63d664f18cdbf9f8bf126/data/event-schemas/schema/m.room.power_levels.yaml#L8-L12\n  return (_c = (_b = userId ? (_a = powerLevelStateEvent.users) === null || _a === void 0 ? void 0 : _a[userId] : undefined) !== null && _b !== void 0 ? _b : powerLevelStateEvent.users_default) !== null && _c !== void 0 ? _c : 0;\n}\n/**\n * Calculate the power level that a user needs send a specific room event.\n *\n * @param powerLevelStateEvent - the content of the `m.room.power_levels` event\n * @param eventType - the type of room event\n * @returns the power level that is needed\n */\nfunction calculateRoomEventPowerLevel(powerLevelStateEvent, eventType) {\n  var _a, _b, _c;\n  // See https://github.com/matrix-org/matrix-spec/blob/203b9756f52adfc2a3b63d664f18cdbf9f8bf126/data/event-schemas/schema/m.room.power_levels.yaml#L14-L19\n  return (_c = (_b = (_a = powerLevelStateEvent.events) === null || _a === void 0 ? void 0 : _a[eventType]) !== null && _b !== void 0 ? _b : powerLevelStateEvent.events_default) !== null && _c !== void 0 ? _c : 0;\n}\n/**\n * Calculate the power level that a user needs send a specific state event.\n *\n * @param powerLevelStateEvent - the content of the `m.room.power_levels` event\n * @param eventType - the type of state event\n * @returns the power level that is needed\n */\nfunction calculateStateEventPowerLevel(powerLevelStateEvent, eventType) {\n  var _a, _b, _c;\n  // See https://github.com/matrix-org/matrix-spec/blob/203b9756f52adfc2a3b63d664f18cdbf9f8bf126/data/event-schemas/schema/m.room.power_levels.yaml#L14-L19\n  return (_c = (_b = (_a = powerLevelStateEvent.events) === null || _a === void 0 ? void 0 : _a[eventType]) !== null && _b !== void 0 ? _b : powerLevelStateEvent.state_default) !== null && _c !== void 0 ? _c : 50;\n}\n/**\n * Calculate the power level that a user needs to perform an action.\n *\n * Supported actions:\n *   * invite: Invite a new user into the room\n *   * kick: Kick a user from the room\n *   * ban: Ban a user from the room\n *   * redact: Redact a message from another user\n *\n * @param powerLevelStateEvent - the content of the `m.room.power_levels` event\n * @param action - the action\n * @returns the power level that is needed\n */\nfunction calculateActionPowerLevel(powerLevelStateEvent, action) {\n  var _a, _b;\n  // See https://github.com/matrix-org/matrix-spec/blob/203b9756f52adfc2a3b63d664f18cdbf9f8bf126/data/event-schemas/schema/m.room.power_levels.yaml#L27-L32\n  if (action === 'invite') {\n    return (_a = powerLevelStateEvent === null || powerLevelStateEvent === void 0 ? void 0 : powerLevelStateEvent[action]) !== null && _a !== void 0 ? _a : 0;\n  }\n  return (_b = powerLevelStateEvent === null || powerLevelStateEvent === void 0 ? void 0 : powerLevelStateEvent[action]) !== null && _b !== void 0 ? _b : 50;\n}\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __awaiter$3 = undefined && undefined.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator$3 = undefined && undefined.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function () {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n  return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (g && (g = 0, op[0] && (_ = 0)), _) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n/**\n * The name of the redaction room event.\n */\nvar ROOM_EVENT_REDACTION = 'm.room.redaction';\n/**\n * Check whether the format of a redaction event is valid.\n * @param event - The event to check.\n * @returns True if the event format is valid, otherwise false.\n */\nfunction isValidRedactionEvent(event) {\n  if (event.type === ROOM_EVENT_REDACTION && typeof event.redacts === 'string') {\n    return true;\n  }\n  return false;\n}\n/**\n * Redacts an event in the current room.\n * @param widgetApi - An instance of the widget API.\n * @param eventId - The id of the event to redact.\n * @returns The redaction event that was send to the room.\n */\nfunction redactEvent(widgetApi, eventId) {\n  return __awaiter$3(this, void 0, void 0, function () {\n    var result;\n    return __generator$3(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4 /*yield*/, widgetApi.sendRoomEvent(ROOM_EVENT_REDACTION, {\n            redacts: eventId\n          })];\n        case 1:\n          result = _a.sent();\n          // The redaction event is special and needs to be casted, as the widget\n          // toolkit assumes that the content of an event is returned as we send it.\n          // However for redactions the content is copied directly into the event to\n          // make it available without decrypting the content.\n          return [2 /*return*/, result];\n      }\n    });\n  });\n}\n/**\n * Observes redaction events in the current room.\n * @param widgetApi - An instance of the widget API.\n * @returns An observable of validated redaction events.\n */\nfunction observeRedactionEvents(widgetApi) {\n  return widgetApi.observeRoomEvents(ROOM_EVENT_REDACTION).pipe(filter(isValidRedactionEvent));\n}\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Get the original event id, or the event id of the current event if it\n * doesn't relates to another event.\n * @param event - The room event.\n * @returns The event id of the original event, or the current event id.\n */\nfunction getOriginalEventId(event) {\n  var _a, _b, _c;\n  var newContentRelatesTo = event.content;\n  if (((_a = newContentRelatesTo['m.relates_to']) === null || _a === void 0 ? void 0 : _a.rel_type) === 'm.replace') {\n    return (_c = (_b = newContentRelatesTo['m.relates_to']) === null || _b === void 0 ? void 0 : _b.event_id) !== null && _c !== void 0 ? _c : event.event_id;\n  }\n  return event.event_id;\n}\n/**\n * Get the content of the event, independent from whether it contains the\n * content directly or contains a \"m.new_content\" key.\n * @param event - The room event.\n * @returns Only the content of the room event.\n */\nfunction getContent(event) {\n  var _a;\n  var newContentRelatesTo = event.content;\n  return (_a = newContentRelatesTo['m.new_content']) !== null && _a !== void 0 ? _a : event.content;\n}\n/**\n * Validates that `event` has a valid structure for a\n * {@link EventWithRelatesTo}.\n * @param event - The event to validate.\n * @returns True, if the event is valid.\n */\nfunction isValidEventWithRelatesTo(event) {\n  if (!event.content || typeof event.content !== 'object') {\n    return false;\n  }\n  var relatedEvent = event;\n  if (!relatedEvent.content['m.relates_to'] || typeof relatedEvent.content['m.relates_to'] !== 'object') {\n    return false;\n  }\n  if (typeof relatedEvent.content['m.relates_to'].rel_type !== 'string' || typeof relatedEvent.content['m.relates_to'].event_id !== 'string') {\n    return false;\n  }\n  return true;\n}\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * The name of the room member state event.\n */\nvar STATE_EVENT_ROOM_MEMBER = 'm.room.member';\nfunction isStringUndefinedOrNull(value) {\n  return value === undefined || value === null || typeof value === 'string';\n}\n/**\n * Validates that `event` is has a valid structure for a\n * {@link RoomMemberStateEventContent}.\n * @param event - The event to validate.\n * @returns True, if the event is valid.\n */\nfunction isValidRoomMemberStateEvent(event) {\n  if (event.type !== STATE_EVENT_ROOM_MEMBER || typeof event.content !== 'object') {\n    return false;\n  }\n  var content = event.content;\n  if (typeof content.membership !== 'string') {\n    return false;\n  }\n  if (!isStringUndefinedOrNull(content.displayname)) {\n    return false;\n  }\n  // the avatar_url shouldn't be null, but some implementations\n  // set it as a valid value\n  if (!isStringUndefinedOrNull(content.avatar_url)) {\n    return false;\n  }\n  return true;\n}\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __assign$1 = undefined && undefined.__assign || function () {\n  __assign$1 = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign$1.apply(this, arguments);\n};\n/**\n * Extract the parameters used to initialize the widget API from the current\n * `window.location`.\n * @returns The parameters required for initializing the widget API.\n */\nfunction extractWidgetApiParameters() {\n  var query = parse(window.location.search, {\n    ignoreQueryPrefix: true\n  });\n  // If either parentUrl or widgetId is missing, we have no element context and\n  // want to inform the user that the widget only works inside of element.\n  if (typeof query.parentUrl !== 'string') {\n    throw Error('Missing parameter \"parentUrl\"');\n  }\n  var clientOrigin = new URL(query.parentUrl).origin;\n  if (typeof query.widgetId !== 'string') {\n    throw Error('Missing parameter \"widgetId\"');\n  }\n  var widgetId = query.widgetId;\n  return {\n    widgetId: widgetId,\n    clientOrigin: clientOrigin\n  };\n}\n/**\n * Extract the widget parameters from the current `window.location`.\n * @returns The all unprocessed raw widget parameters.\n */\nfunction extractRawWidgetParameters() {\n  var hash = window.location.hash.substring(window.location.hash.indexOf('?') + 1);\n  var params = __assign$1(__assign$1({}, parse(window.location.search, {\n    ignoreQueryPrefix: true\n  })), parse(hash));\n  return Object.fromEntries(Object.entries(params).filter(\n  // For now only use simple values, don't allow them to be specified more\n  // than once.\n  function (e) {\n    return typeof e[1] === 'string';\n  }));\n}\n/**\n * Extract the widget parameters from the current `window.location`.\n * @returns The widget parameters.\n */\nfunction extractWidgetParameters() {\n  var params = extractRawWidgetParameters();\n  // This is a hack to detect whether we are in a mobile client that supports widgets,\n  // but not the widget API. Mobile clients are not passing the parameters required for\n  // the widget API (like widgetId), but are passing the replaced placeholder values for\n  // the widget parameters.\n  var roomId = params['matrix_room_id'];\n  var isOpenedByClient = typeof roomId === 'string' && roomId !== '$matrix_room_id';\n  return {\n    userId: params['matrix_user_id'],\n    displayName: params['matrix_display_name'],\n    avatarUrl: params['matrix_avatar_url'],\n    roomId: roomId,\n    theme: params['theme'],\n    clientId: params['matrix_client_id'],\n    clientLanguage: params['matrix_client_language'],\n    baseUrl: params['matrix_base_url'],\n    deviceId: params['matrix_device_id'],\n    isOpenedByClient: isOpenedByClient\n  };\n}\n/**\n * Parse a widget id into the individual fields.\n * @param widgetId - The widget id to parse.\n * @returns The individual fields encoded inside a widget id.\n */\nfunction parseWidgetId(widgetId) {\n  // TODO: Is this whole parsing still working for user widgets?\n  var mainWidgetId = decodeURIComponent(widgetId).replace(/^modal_/, '');\n  var roomId = mainWidgetId.indexOf('_') ? decodeURIComponent(mainWidgetId.split('_')[0]) : undefined;\n  var creator = (mainWidgetId.match(/_/g) || []).length > 1 ? decodeURIComponent(mainWidgetId.split('_')[1]) : undefined;\n  var isModal = decodeURIComponent(widgetId).startsWith('modal_');\n  return {\n    mainWidgetId: mainWidgetId,\n    roomId: roomId,\n    creator: creator,\n    isModal: isModal\n  };\n}\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __assign = undefined && undefined.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __awaiter$2 = undefined && undefined.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator$2 = undefined && undefined.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function () {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n  return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (g && (g = 0, op[0] && (_ = 0)), _) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\nvar __rest = undefined && undefined.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n/**\n * Checks whether the necessary widget parameters were provided to the widget.\n *\n * @param widgetApi - The widget api to read the parameters from\n * @returns True, if all parameters were provided.\n */\nfunction hasWidgetParameters(widgetApi) {\n  return typeof widgetApi.widgetParameters.userId === 'string' && typeof widgetApi.widgetParameters.displayName === 'string' && typeof widgetApi.widgetParameters.avatarUrl === 'string' && typeof widgetApi.widgetParameters.roomId === 'string' && typeof widgetApi.widgetParameters.theme === 'string' && typeof widgetApi.widgetParameters.clientId === 'string' && typeof widgetApi.widgetParameters.clientLanguage === 'string' && typeof widgetApi.widgetParameters.baseUrl === 'string';\n}\n/**\n * Generate a registration URL for the widget based on the current URL and\n * include all widget parameters (and their placeholders).\n * @param options - Options for generating the URL.\n *                  Use `pathName` to include an optional sub path in the URL.\n *                  Use `includeParameters` to append the widget parameters to\n *                  the URL, defaults to `true`.\n * @returns The generated URL.\n */\nfunction generateWidgetRegistrationUrl(options) {\n  var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n  if (options === void 0) {\n    options = {};\n  }\n  var pathName = options.pathName,\n    _k = options.includeParameters,\n    includeParameters = _k === void 0 ? true : _k,\n    widgetParameters = options.widgetParameters;\n  // don't forward widgetId and parentUrl as they will be generated by the client\n  // eslint-disable-next-line\n  var _l = extractRawWidgetParameters();\n  _l.widgetId;\n  _l.parentUrl;\n  var rawWidgetParameters = __rest(_l, [\"widgetId\", \"parentUrl\"]);\n  var parameters = Object.entries(__assign(__assign({}, rawWidgetParameters), {\n    theme: (_a = widgetParameters === null || widgetParameters === void 0 ? void 0 : widgetParameters.theme) !== null && _a !== void 0 ? _a : '$org.matrix.msc2873.client_theme',\n    matrix_user_id: (_b = widgetParameters === null || widgetParameters === void 0 ? void 0 : widgetParameters.userId) !== null && _b !== void 0 ? _b : '$matrix_user_id',\n    matrix_display_name: (_c = widgetParameters === null || widgetParameters === void 0 ? void 0 : widgetParameters.displayName) !== null && _c !== void 0 ? _c : '$matrix_display_name',\n    matrix_avatar_url: (_d = widgetParameters === null || widgetParameters === void 0 ? void 0 : widgetParameters.avatarUrl) !== null && _d !== void 0 ? _d : '$matrix_avatar_url',\n    matrix_room_id: (_e = widgetParameters === null || widgetParameters === void 0 ? void 0 : widgetParameters.roomId) !== null && _e !== void 0 ? _e : '$matrix_room_id',\n    matrix_client_id: (_f = widgetParameters === null || widgetParameters === void 0 ? void 0 : widgetParameters.clientId) !== null && _f !== void 0 ? _f : '$org.matrix.msc2873.client_id',\n    matrix_client_language: (_g = widgetParameters === null || widgetParameters === void 0 ? void 0 : widgetParameters.clientLanguage) !== null && _g !== void 0 ? _g : '$org.matrix.msc2873.client_language',\n    matrix_device_id: (_h = widgetParameters === null || widgetParameters === void 0 ? void 0 : widgetParameters.deviceId) !== null && _h !== void 0 ? _h : '$org.matrix.msc3819.matrix_device_id',\n    matrix_base_url: (_j = widgetParameters === null || widgetParameters === void 0 ? void 0 : widgetParameters.baseUrl) !== null && _j !== void 0 ? _j : '$org.matrix.msc4039.matrix_base_url'\n  })).map(function (_a) {\n    var k = _a[0],\n      v = _a[1];\n    return \"\".concat(k, \"=\").concat(v);\n  }).join('&');\n  var url = new URL(window.location.href);\n  if (pathName) {\n    url.pathname = pathName;\n  } else {\n    // ensure trailing '/'\n    url.pathname = url.pathname.replace(/\\/?$/, '/');\n  }\n  url.search = '';\n  url.hash = includeParameters ? \"#/?\".concat(parameters) : '';\n  return url.toString();\n}\nvar STATE_EVENT_WIDGETS = 'im.vector.modular.widgets';\n/**\n * Repair/configure the registration of the current widget.\n * This steps make sure to include all the required widget parameters in the\n * URL. Support setting a widget name and additional parameters.\n *\n * @param widgetApi - The widget api of the current widget.\n * @param registration - Optional configuration options for the widget\n *                       registration, like the display name of the widget.\n */\nfunction repairWidgetRegistration(widgetApi_1) {\n  return __awaiter$2(this, arguments, void 0, function (widgetApi, registration) {\n    var readResult, url, name, type, data;\n    if (registration === void 0) {\n      registration = {};\n    }\n    return __generator$2(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4 /*yield*/, widgetApi.requestCapabilities([WidgetEventCapability.forStateEvent(EventDirection.Send, STATE_EVENT_WIDGETS, widgetApi.widgetId), WidgetEventCapability.forStateEvent(EventDirection.Receive, STATE_EVENT_WIDGETS, widgetApi.widgetId)])];\n        case 1:\n          _a.sent();\n          return [4 /*yield*/, widgetApi.receiveSingleStateEvent(STATE_EVENT_WIDGETS, widgetApi.widgetId)];\n        case 2:\n          readResult = _a.sent();\n          if (!readResult) {\n            throw new Error(\"Error while repairing registration, can't find existing registration.\");\n          }\n          url = generateWidgetRegistrationUrl();\n          name = registration.name && (!readResult.content.name || readResult.content.name === 'Custom Widget' || readResult.content.name === 'Custom') ? registration.name : readResult.content.name;\n          type = registration.type && (!readResult.content.type || readResult.content.type === 'm.custom') ? registration.type : readResult.content.type;\n          data = registration.data ? __assign(__assign({}, readResult.content.data), registration.data) : readResult.content.data;\n          // This is a workaround because changing the widget config is breaking the\n          // widget API communication. However we need to fail in case the power level\n          // for this change is missing. As the error happens quite fast, we just wait\n          // a moment and then consider the operation as succeeded.\n          return [4 /*yield*/, Promise.race([widgetApi.sendStateEvent(STATE_EVENT_WIDGETS, __assign(__assign({}, readResult.content), {\n            url: url.toString(),\n            name: name,\n            type: type,\n            data: data\n          }), {\n            stateKey: widgetApi.widgetId\n          }), new Promise(function (resolve) {\n            return setTimeout(resolve, 1000);\n          })])];\n        case 3:\n          // This is a workaround because changing the widget config is breaking the\n          // widget API communication. However we need to fail in case the power level\n          // for this change is missing. As the error happens quite fast, we just wait\n          // a moment and then consider the operation as succeeded.\n          _a.sent();\n          return [2 /*return*/];\n      }\n    });\n  });\n}\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Enumeration of widget parameters that can be checked if they are available upon registration.\n */\nvar WidgetParameter;\n(function (WidgetParameter) {\n  WidgetParameter[\"UserId\"] = \"userId\";\n  WidgetParameter[\"DisplayName\"] = \"displayName\";\n  WidgetParameter[\"AvatarUrl\"] = \"avatarUrl\";\n  WidgetParameter[\"RoomId\"] = \"roomId\";\n  WidgetParameter[\"Theme\"] = \"theme\";\n  WidgetParameter[\"ClientId\"] = \"clientId\";\n  WidgetParameter[\"ClientLanguage\"] = \"clientLanguage\";\n  WidgetParameter[\"DeviceId\"] = \"deviceId\";\n  WidgetParameter[\"BaseUrl\"] = \"baseUrl\";\n})(WidgetParameter || (WidgetParameter = {}));\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __awaiter$1 = undefined && undefined.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator$1 = undefined && undefined.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function () {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n  return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (g && (g = 0, op[0] && (_ = 0)), _) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\nfunction convertToRawCapabilities(rawCapabilities) {\n  return rawCapabilities.map(function (c) {\n    return typeof c === 'string' ? c : c.raw;\n  });\n}\nfunction isDefined(arg) {\n  return arg !== null && arg !== undefined;\n}\nfunction unique(items) {\n  return Array.from(new Set(items));\n}\nfunction subtractSet(as, bs) {\n  var result = new Set(as);\n  bs.forEach(function (v) {\n    return result.delete(v);\n  });\n  return result;\n}\nfunction isInRoom(matrixEvent, currentRoomId, roomIds) {\n  if (!roomIds) {\n    return matrixEvent.room_id === currentRoomId;\n  }\n  if (typeof roomIds === 'string') {\n    if (roomIds !== Symbols.AnyRoom) {\n      throw Error(\"Unknown room id symbol: \".concat(roomIds));\n    }\n    return true;\n  }\n  return roomIds.includes(matrixEvent.room_id);\n}\n/**\n * Create a state event from the arguments.\n *\n * @returns A state event with current timestamp origin_server_ts.\n */\nfunction makeEventFromSendStateEventResult(type, stateKey, content, sender, sendResult) {\n  if (sendResult.event_id === undefined) {\n    throw new Error('Send state event did not return an event ID');\n  }\n  return {\n    content: content,\n    event_id: sendResult.event_id,\n    origin_server_ts: Date.now(),\n    room_id: sendResult.room_id,\n    sender: sender,\n    state_key: stateKey,\n    type: type\n  };\n}\n/**\n * Send a state event and resolve to a \"virtual\" state event.\n *\n * @returns Promise, that resolves to a state event with current timestamp origin_server_ts.\n */\nfunction sendStateEventWithEventResult(widgetApi, type, stateKey, content) {\n  return __awaiter$1(this, void 0, void 0, function () {\n    var response;\n    return __generator$1(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          if (widgetApi.widgetParameters.userId === undefined) {\n            throw new Error('Own user ID is undefined');\n          }\n          return [4 /*yield*/, widgetApi.sendStateEvent(type, content, {\n            stateKey: stateKey\n          })];\n        case 1:\n          response = _a.sent();\n          return [2 /*return*/, makeEventFromSendStateEventResult(type, stateKey, content, widgetApi.widgetParameters.userId, response)];\n      }\n    });\n  });\n}\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __awaiter = undefined && undefined.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator = undefined && undefined.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function () {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n  return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (g && (g = 0, op[0] && (_ = 0)), _) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\nvar __spreadArray = undefined && undefined.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\n/**\n * Implementation of the API from the widget to the client.\n *\n * @remarks Widget API is specified here:\n * https://docs.google.com/document/d/1uPF7XWY_dXTKVKV7jZQ2KmsI19wn9-kFRgQ1tFQP7wQ/edit#heading=h.9rn9lt6ctkgi\n */\nvar WidgetApiImpl = /** @class */function () {\n  function WidgetApiImpl(\n  /**\n   * Provide access to the underlying widget API from `matrix-widget-sdk`.\n   *\n   * @remarks Normally there is no need to use it, however if features are\n   *          missing from `WidgetApi` it can be handy to work with the\n   *          original API.\n   */\n  matrixWidgetApi, /** {@inheritDoc WidgetApi.widgetId} */\n  widgetId, /** {@inheritDoc WidgetApi.widgetParameters} */\n  widgetParameters, _a) {\n    var _b = _a === void 0 ? {} : _a,\n      _c = _b.capabilities,\n      capabilities = _c === void 0 ? [] : _c,\n      _d = _b.supportStandalone,\n      supportStandalone = _d === void 0 ? false : _d;\n    var _this = this;\n    this.matrixWidgetApi = matrixWidgetApi;\n    this.widgetId = widgetId;\n    this.widgetParameters = widgetParameters;\n    // Disable the update_state API that is not implemented.\n    this.matrixWidgetApi.on(\"action:\".concat(WidgetApiToWidgetAction.SupportedApiVersions), function (event) {\n      event.preventDefault();\n      var supportedVersions = CurrentApiVersions.filter(function (apiVersion) {\n        return apiVersion !== UnstableApiVersion.MSC2762_UPDATE_STATE;\n      });\n      matrixWidgetApi.transport.reply(event.detail, {\n        supported_versions: supportedVersions\n      });\n    });\n    this.events$ = fromEvent(this.matrixWidgetApi, \"action:\".concat(WidgetApiToWidgetAction.SendEvent), function (event) {\n      event.preventDefault();\n      try {\n        _this.matrixWidgetApi.transport.reply(event.detail, {});\n      } catch (_a) {\n        // Ignore errors while replying\n      }\n      return event;\n    }).pipe(share());\n    this.toDeviceMessages$ = fromEvent(this.matrixWidgetApi, 'action:send_to_device', function (event) {\n      event.preventDefault();\n      try {\n        matrixWidgetApi.transport.reply(event.detail, {});\n      } catch (_a) {\n        // Ignore errors while replying\n      }\n      return event;\n    }).pipe(filter(function (event) {\n      return isValidToDeviceMessageEvent(event.detail.data);\n    })).pipe(share());\n    this.initialCapabilities = __spreadArray(__spreadArray([], capabilities, true), supportStandalone ? [] : [MatrixCapabilities.RequiresClient], true);\n  }\n  /**\n   * Initialize a new widget API instance and wait till it is ready.\n   * There should only be one instance of the widget API. The widget API should\n   * be created as early as possible when starting the application. This is\n   * required to match the timing of the API connection establishment with the\n   * client, especially in Safari. Therefore it is recommended to create it\n   * inside the entrypoint, before initializing rendering engines like react.\n   *\n   * @param param0 - {@link WidgetApiOptions}\n   *\n   * @returns A widget API instance ready to use.\n   */\n  WidgetApiImpl.create = function () {\n    return __awaiter(this, arguments, void 0, function (_a) {\n      var _b, clientOrigin, widgetId, widgetParameters, matrixWidgetApi, widgetApi;\n      var _c = _a === void 0 ? {} : _a,\n        _d = _c.capabilities,\n        capabilities = _d === void 0 ? [] : _d,\n        _e = _c.supportStandalone,\n        supportStandalone = _e === void 0 ? false : _e;\n      return __generator(this, function (_f) {\n        switch (_f.label) {\n          case 0:\n            _b = extractWidgetApiParameters(), clientOrigin = _b.clientOrigin, widgetId = _b.widgetId;\n            widgetParameters = extractWidgetParameters();\n            matrixWidgetApi = new WidgetApi(widgetId, clientOrigin);\n            widgetApi = new WidgetApiImpl(matrixWidgetApi, widgetId, widgetParameters, {\n              capabilities: capabilities,\n              supportStandalone: supportStandalone\n            });\n            return [4 /*yield*/, widgetApi.initialize()];\n          case 1:\n            _f.sent();\n            return [2 /*return*/, widgetApi];\n        }\n      });\n    });\n  };\n  /**\n   * Initialize the widget API and wait till a connection with the client is\n   * fully established.\n   *\n   * Waits till the user has approved the initial set of capabilities. The\n   * method doesn't fail if the user doesn't approve all of them. It is\n   * required to check manually afterwards.\n   * In case of modal widgets it waits till the `widgetConfig` is received.\n   *\n   * @remarks Should only be called once during startup.\n   */\n  WidgetApiImpl.prototype.initialize = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var ready, isModal, configReady, rawCapabilities;\n      var _this = this;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            ready = new Promise(function (resolve) {\n              _this.matrixWidgetApi.once('ready', function () {\n                return resolve();\n              });\n            });\n            isModal = parseWidgetId(this.widgetId).isModal;\n            configReady = isModal ? function () {\n              return __awaiter(_this, void 0, void 0, function () {\n                var widgetConfig$, _a;\n                var _this = this;\n                return __generator(this, function (_b) {\n                  switch (_b.label) {\n                    case 0:\n                      widgetConfig$ = fromEvent(this.matrixWidgetApi, \"action:\".concat(WidgetApiToWidgetAction.WidgetConfig), function (ev) {\n                        ev.preventDefault();\n                        _this.matrixWidgetApi.transport.reply(ev.detail, {});\n                        return ev.detail.data;\n                      });\n                      _a = this;\n                      return [4 /*yield*/, firstValueFrom(widgetConfig$)];\n                    case 1:\n                      _a.widgetConfig = _b.sent();\n                      return [2 /*return*/];\n                  }\n                });\n              });\n            }() : undefined;\n            rawCapabilities = unique(convertToRawCapabilities(this.initialCapabilities));\n            this.matrixWidgetApi.requestCapabilities(rawCapabilities);\n            this.matrixWidgetApi.start();\n            return [4 /*yield*/, ready];\n          case 1:\n            _a.sent();\n            if (!configReady) return [3 /*break*/, 3];\n            return [4 /*yield*/, configReady];\n          case 2:\n            _a.sent();\n            _a.label = 3;\n          case 3:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  /** {@inheritDoc WidgetApi.getWidgetConfig} */\n  WidgetApiImpl.prototype.getWidgetConfig = function () {\n    return this.widgetConfig;\n  };\n  /** {@inheritDoc WidgetApi.rerequestInitialCapabilities} */\n  WidgetApiImpl.prototype.rerequestInitialCapabilities = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, this.requestCapabilities(this.initialCapabilities)];\n          case 1:\n            return [2 /*return*/, _a.sent()];\n        }\n      });\n    });\n  };\n  /** {@inheritDoc WidgetApi.hasInitialCapabilities} */\n  WidgetApiImpl.prototype.hasInitialCapabilities = function () {\n    return this.hasCapabilities(this.initialCapabilities);\n  };\n  /** {@inheritDoc WidgetApi.requestCapabilities} */\n  WidgetApiImpl.prototype.requestCapabilities = function (capabilities) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            if (!this.outstandingCapabilitiesRequest) return [3 /*break*/, 4];\n            _b.label = 1;\n          case 1:\n            _b.trys.push([1, 3,, 4]);\n            return [4 /*yield*/, this.outstandingCapabilitiesRequest];\n          case 2:\n            _b.sent();\n            return [3 /*break*/, 4];\n          case 3:\n            _b.sent();\n            return [3 /*break*/, 4];\n          case 4:\n            _b.trys.push([4,, 6, 7]);\n            this.outstandingCapabilitiesRequest = this.requestCapabilitiesInternal(capabilities);\n            return [4 /*yield*/, this.outstandingCapabilitiesRequest];\n          case 5:\n            _b.sent();\n            return [3 /*break*/, 7];\n          case 6:\n            this.outstandingCapabilitiesRequest = undefined;\n            return [7 /*endfinally*/];\n          case 7:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  WidgetApiImpl.prototype.requestCapabilitiesInternal = function (capabilities) {\n    return __awaiter(this, void 0, void 0, function () {\n      var rawCapabilities, requestedSet, capabilities$;\n      var _this = this;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            rawCapabilities = unique(convertToRawCapabilities(capabilities));\n            // Take shortcut if possible, that avoid extra roundtrips over the API.\n            if (this.hasCapabilities(rawCapabilities)) {\n              return [2 /*return*/];\n            }\n            requestedSet = new Set(rawCapabilities);\n            capabilities$ = fromEvent(this.matrixWidgetApi, \"action:\".concat(WidgetApiToWidgetAction.NotifyCapabilities), function (ev) {\n              return ev;\n            }).pipe(\n            // TODO: `hasCapability` in the matrix-widget-api isn't consistent when capability\n            //       upgrades happened. But `updateRequestedCapabilities` will deduplicate already\n            //       approved capabilities, so the the `requested` field will be inconsistent.\n            //       If we would enable this check, the function will never resolve. This should\n            //       be reactivated once the capability upgrade is working correctly. See also:\n            //       https://github.com/matrix-org/matrix-widget-api/issues/52\n            // Ignore events from other parallel capability requests\n            //filter((ev) =>\n            //  equalsSet(new Set(ev.detail.data.requested), requestedSet)\n            //),\n            map(function (ev) {\n              var approvedSet = new Set(ev.detail.data.approved);\n              var missingSet = subtractSet(requestedSet, approvedSet);\n              if (missingSet.size > 0) {\n                throw new Error(\"Capabilities rejected: \".concat(Array.from(missingSet).join(', ')));\n              }\n            }), first());\n            // eslint-disable-next-line no-async-promise-executor\n            return [4 /*yield*/, new Promise(function (resolve, reject) {\n              return __awaiter(_this, void 0, void 0, function () {\n                var subscription, err_1;\n                return __generator(this, function (_a) {\n                  switch (_a.label) {\n                    case 0:\n                      subscription = capabilities$.subscribe({\n                        next: resolve,\n                        error: reject\n                      });\n                      _a.label = 1;\n                    case 1:\n                      _a.trys.push([1, 3,, 4]);\n                      this.matrixWidgetApi.requestCapabilities(rawCapabilities);\n                      return [4 /*yield*/, this.matrixWidgetApi.updateRequestedCapabilities()];\n                    case 2:\n                      _a.sent();\n                      return [3 /*break*/, 4];\n                    case 3:\n                      err_1 = _a.sent();\n                      subscription.unsubscribe();\n                      reject(err_1);\n                      return [3 /*break*/, 4];\n                    case 4:\n                      return [2 /*return*/];\n                  }\n                });\n              });\n            })];\n          case 1:\n            // eslint-disable-next-line no-async-promise-executor\n            _a.sent();\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  /** {@inheritDoc WidgetApi.hasCapabilities} */\n  WidgetApiImpl.prototype.hasCapabilities = function (capabilities) {\n    var _this = this;\n    var rawCapabilities = convertToRawCapabilities(capabilities);\n    return rawCapabilities.every(function (c) {\n      return _this.matrixWidgetApi.hasCapability(c);\n    });\n  };\n  /** {@inheritDoc WidgetApi.receiveSingleStateEvent} */\n  WidgetApiImpl.prototype.receiveSingleStateEvent = function (eventType_1) {\n    return __awaiter(this, arguments, void 0, function (eventType, stateKey) {\n      var events;\n      if (stateKey === void 0) {\n        stateKey = '';\n      }\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, this.receiveStateEvents(eventType, {\n              stateKey: stateKey\n            })];\n          case 1:\n            events = _a.sent();\n            return [2 /*return*/, events && events[0]];\n        }\n      });\n    });\n  };\n  /** {@inheritDoc WidgetApi.receiveStateEvents} */\n  WidgetApiImpl.prototype.receiveStateEvents = function (eventType_1) {\n    return __awaiter(this, arguments, void 0, function (eventType, _a) {\n      var unvalidatedEvents, validatedEvents;\n      var _b = _a === void 0 ? {} : _a,\n        stateKey = _b.stateKey,\n        roomIds = _b.roomIds;\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            return [4 /*yield*/, this.matrixWidgetApi.readStateEvents(eventType, Number.MAX_SAFE_INTEGER, stateKey, typeof roomIds === 'string' ? [Symbols.AnyRoom] : roomIds)];\n          case 1:\n            unvalidatedEvents = _c.sent();\n            validatedEvents = unvalidatedEvents.filter(isValidStateEvent);\n            return [2 /*return*/, validatedEvents];\n        }\n      });\n    });\n  };\n  /** {@inheritDoc WidgetApi.observeStateEvents} */\n  WidgetApiImpl.prototype.observeStateEvents = function (eventType, _a) {\n    var _b = _a === void 0 ? {} : _a,\n      stateKey = _b.stateKey,\n      roomIds = _b.roomIds;\n    var currentRoomId = this.widgetParameters.roomId;\n    if (!currentRoomId) {\n      return throwError(function () {\n        return new Error('Current room id is unknown');\n      });\n    }\n    var historyEvent$ = from(this.receiveStateEvents(eventType, {\n      stateKey: stateKey,\n      roomIds: roomIds\n    })).pipe(mergeAll());\n    var futureEvent$ = this.events$.pipe(map(function (event) {\n      var matrixEvent = event.detail.data;\n      if (matrixEvent.type === eventType && matrixEvent.state_key !== undefined && (stateKey === undefined || matrixEvent.state_key === stateKey) && isInRoom(matrixEvent, currentRoomId, roomIds)) {\n        return event.detail.data;\n      }\n      return undefined;\n    }), filter(isDefined));\n    return concat(historyEvent$, futureEvent$).pipe(filter(isValidStateEvent));\n  };\n  /** {@inheritDoc WidgetApi.sendStateEvent} */\n  WidgetApiImpl.prototype.sendStateEvent = function (eventType, content, _a) {\n    var _b = _a === void 0 ? {} : _a,\n      roomId = _b.roomId,\n      _c = _b.stateKey,\n      stateKey = _c === void 0 ? '' : _c;\n    return this.matrixWidgetApi.sendStateEvent(eventType, stateKey, content, roomId);\n  };\n  /** {@inheritDoc WidgetApi.sendDelayedStateEvent} */\n  WidgetApiImpl.prototype.sendDelayedStateEvent = function (eventType_1, content_1, delay_1) {\n    return __awaiter(this, arguments, void 0, function (eventType, content, delay, _a) {\n      var delay_id;\n      var _b = _a === void 0 ? {} : _a,\n        roomId = _b.roomId,\n        _c = _b.stateKey,\n        stateKey = _c === void 0 ? '' : _c;\n      return __generator(this, function (_d) {\n        switch (_d.label) {\n          case 0:\n            return [4 /*yield*/, this.matrixWidgetApi.sendStateEvent(eventType, stateKey, content, roomId, delay)];\n          case 1:\n            delay_id = _d.sent().delay_id;\n            if (!delay_id) {\n              throw new Error('Delayed event must have a delay_id');\n            }\n            return [2 /*return*/, {\n              delay_id: delay_id\n            }];\n        }\n      });\n    });\n  };\n  /** {@inheritDoc WidgetApi.receiveRoomEvents} */\n  WidgetApiImpl.prototype.receiveRoomEvents = function (eventType_1) {\n    return __awaiter(this, arguments, void 0, function (eventType, _a) {\n      var unvalidatedEvents, validatedEvents;\n      var _b = _a === void 0 ? {} : _a,\n        messageType = _b.messageType,\n        roomIds = _b.roomIds;\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            return [4 /*yield*/, this.matrixWidgetApi.readRoomEvents(eventType, Number.MAX_SAFE_INTEGER, messageType, typeof roomIds === 'string' ? [Symbols.AnyRoom] : roomIds)];\n          case 1:\n            unvalidatedEvents = _c.sent();\n            validatedEvents = unvalidatedEvents.filter(isValidRoomEvent);\n            return [2 /*return*/, validatedEvents];\n        }\n      });\n    });\n  };\n  /** {@inheritDoc WidgetApi.observeRoomEvents} */\n  WidgetApiImpl.prototype.observeRoomEvents = function (eventType, _a) {\n    var _b = _a === void 0 ? {} : _a,\n      messageType = _b.messageType,\n      roomIds = _b.roomIds;\n    var currentRoomId = this.widgetParameters.roomId;\n    if (!currentRoomId) {\n      return throwError(function () {\n        return new Error('Current room id is unknown');\n      });\n    }\n    var historyEvent$ = from(this.receiveRoomEvents(eventType, {\n      messageType: messageType,\n      roomIds: roomIds\n    })).pipe(mergeAll());\n    var futureEvent$ = this.events$.pipe(map(function (event) {\n      var matrixEvent = event.detail.data;\n      if (matrixEvent.type === eventType && matrixEvent.state_key === undefined && (!messageType || matrixEvent.content.msgtype === messageType) && isInRoom(matrixEvent, currentRoomId, roomIds)) {\n        return event.detail.data;\n      }\n      return undefined;\n    }), filter(isDefined));\n    return concat(historyEvent$, futureEvent$).pipe(filter(isValidRoomEvent));\n  };\n  /** {@inheritDoc WidgetApi.sendRoomEvent} */\n  WidgetApiImpl.prototype.sendRoomEvent = function (eventType_1, content_1) {\n    return __awaiter(this, arguments, void 0, function (eventType, content, _a) {\n      var subject, subscription, _b, event_id_1, room_id_1, event_1;\n      var _c = _a === void 0 ? {} : _a,\n        roomId = _c.roomId;\n      return __generator(this, function (_d) {\n        switch (_d.label) {\n          case 0:\n            subject = new ReplaySubject();\n            subscription = this.events$.subscribe(function (e) {\n              return subject.next(e);\n            });\n            _d.label = 1;\n          case 1:\n            _d.trys.push([1,, 4, 5]);\n            return [4 /*yield*/, this.matrixWidgetApi.sendRoomEvent(eventType, content, roomId)];\n          case 2:\n            _b = _d.sent(), event_id_1 = _b.event_id, room_id_1 = _b.room_id;\n            return [4 /*yield*/, firstValueFrom(subject.pipe(filter(function (event) {\n              var matrixEvent = event.detail.data;\n              return matrixEvent.event_id === event_id_1 && matrixEvent.room_id === room_id_1;\n            }), map(function (event) {\n              return event.detail.data;\n            })))];\n          case 3:\n            event_1 = _d.sent();\n            return [2 /*return*/, event_1];\n          case 4:\n            subscription.unsubscribe();\n            return [7 /*endfinally*/];\n          case 5:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  /** {@inheritDoc WidgetApi.sendDelayedRoomEvent} */\n  WidgetApiImpl.prototype.sendDelayedRoomEvent = function (eventType_1, content_1, delay_1) {\n    return __awaiter(this, arguments, void 0, function (eventType, content, delay, _a) {\n      var delay_id;\n      var _b = _a === void 0 ? {} : _a,\n        roomId = _b.roomId;\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            return [4 /*yield*/, this.matrixWidgetApi.sendRoomEvent(eventType, content, roomId, delay)];\n          case 1:\n            delay_id = _c.sent().delay_id;\n            if (!delay_id) {\n              throw new Error('Delayed event must have a delay_id');\n            }\n            return [2 /*return*/, {\n              delay_id: delay_id\n            }];\n        }\n      });\n    });\n  };\n  /** {@inheritDoc WidgetApi.updateDelayedEvent} */\n  WidgetApiImpl.prototype.updateDelayedEvent = function (delayId, action) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, this.matrixWidgetApi.updateDelayedEvent(delayId, action)];\n          case 1:\n            _a.sent();\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  /** {@inheritDoc WidgetApi.readEventRelations} */\n  WidgetApiImpl.prototype.readEventRelations = function (eventId, options) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, chunk, next_batch;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4 /*yield*/, this.matrixWidgetApi.readEventRelations(eventId, options === null || options === void 0 ? void 0 : options.roomId, options === null || options === void 0 ? void 0 : options.relationType, options === null || options === void 0 ? void 0 : options.eventType, options === null || options === void 0 ? void 0 : options.limit, options === null || options === void 0 ? void 0 : options.from, undefined, options === null || options === void 0 ? void 0 : options.direction)];\n          case 1:\n            _a = _b.sent(), chunk = _a.chunk, next_batch = _a.next_batch;\n            return [2 /*return*/, {\n              chunk: chunk,\n              nextToken: next_batch !== null && next_batch !== void 0 ? next_batch : undefined\n            }];\n        }\n      });\n    });\n  };\n  /** {@inheritDoc WidgetApi.sendToDeviceMessage} */\n  WidgetApiImpl.prototype.sendToDeviceMessage = function (eventType, encrypted, content) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, this.matrixWidgetApi.sendToDevice(eventType, encrypted, content)];\n          case 1:\n            _a.sent();\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  /** {@inheritDoc WidgetApi.observeToDeviceMessages} */\n  WidgetApiImpl.prototype.observeToDeviceMessages = function (eventType) {\n    return this.toDeviceMessages$.pipe(map(function (e) {\n      return e.detail.data;\n    }), filter(isValidToDeviceMessageEvent), filter(function (e) {\n      return e.type === eventType;\n    }));\n  };\n  /** {@inheritDoc WidgetApi.openModal} */\n  WidgetApiImpl.prototype.openModal = function (pathName, name, options) {\n    return __awaiter(this, void 0, void 0, function () {\n      var isModal, url, closeModalWidget$;\n      var _this = this;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            isModal = parseWidgetId(this.widgetId).isModal;\n            if (isModal) {\n              throw new Error(\"Modals can't be opened from another modal widget\");\n            }\n            url = generateWidgetRegistrationUrl({\n              pathName: pathName,\n              widgetParameters: this.widgetParameters\n            });\n            return [4 /*yield*/, this.matrixWidgetApi.openModalWidget(url, name, options === null || options === void 0 ? void 0 : options.buttons, options === null || options === void 0 ? void 0 : options.data)];\n          case 1:\n            _a.sent();\n            closeModalWidget$ = fromEvent(this.matrixWidgetApi, \"action:\".concat(WidgetApiToWidgetAction.CloseModalWidget), function (event) {\n              var _a;\n              event.preventDefault();\n              _this.matrixWidgetApi.transport.reply(event.detail, {});\n              if (((_a = event.detail.data) === null || _a === void 0 ? void 0 : _a['m.exited']) === true) {\n                return undefined;\n              }\n              return event.detail.data;\n            });\n            return [2 /*return*/, firstValueFrom(closeModalWidget$)];\n        }\n      });\n    });\n  };\n  /** {@inheritDoc WidgetApi.setModalButtonEnabled} */\n  WidgetApiImpl.prototype.setModalButtonEnabled = function (buttonId, isEnabled) {\n    return __awaiter(this, void 0, void 0, function () {\n      var isModal;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            isModal = parseWidgetId(this.widgetId).isModal;\n            if (!isModal) {\n              throw new Error('Modal buttons can only be enabled from a modal widget');\n            }\n            return [4 /*yield*/, this.matrixWidgetApi.setModalButtonEnabled(buttonId, isEnabled)];\n          case 1:\n            _a.sent();\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  /** {@inheritDoc WidgetApi.observeModalButtons} */\n  WidgetApiImpl.prototype.observeModalButtons = function () {\n    var _this = this;\n    var isModal = parseWidgetId(this.widgetId).isModal;\n    if (!isModal) {\n      throw new Error('Modal buttons can only be observed from a modal widget');\n    }\n    return fromEvent(this.matrixWidgetApi, \"action:\".concat(WidgetApiToWidgetAction.ButtonClicked), function (event) {\n      event.preventDefault();\n      _this.matrixWidgetApi.transport.reply(event.detail, {});\n      return event.detail.data.id;\n    });\n  };\n  /** {@inheritDoc WidgetApi.closeModal} */\n  WidgetApiImpl.prototype.closeModal = function (data) {\n    return __awaiter(this, void 0, void 0, function () {\n      var isModal;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            isModal = parseWidgetId(this.widgetId).isModal;\n            if (!isModal) {\n              throw new Error('Modals can only be closed from a modal widget');\n            }\n            return [4 /*yield*/, this.matrixWidgetApi.closeModalWidget(data ? data : {\n              'm.exited': true\n            })];\n          case 1:\n            _a.sent();\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  /** {@inheritdoc WidgetApi.navigateTo} */\n  WidgetApiImpl.prototype.navigateTo = function (uri) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, this.matrixWidgetApi.navigateTo(uri)];\n          case 1:\n            _a.sent();\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  /** {@inheritdoc WidgetApi.requestOpenIDConnectToken} */\n  WidgetApiImpl.prototype.requestOpenIDConnectToken = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            if (!this.outstandingOpenIDConnectTokenRequest) return [3 /*break*/, 4];\n            _b.label = 1;\n          case 1:\n            _b.trys.push([1, 3,, 4]);\n            return [4 /*yield*/, this.outstandingOpenIDConnectTokenRequest];\n          case 2:\n            _b.sent();\n            return [3 /*break*/, 4];\n          case 3:\n            _b.sent();\n            return [3 /*break*/, 4];\n          case 4:\n            _b.trys.push([4,, 6, 7]);\n            this.outstandingOpenIDConnectTokenRequest = this.requestOpenIDConnectTokenInternal();\n            return [4 /*yield*/, this.outstandingOpenIDConnectTokenRequest];\n          case 5:\n            return [2 /*return*/, _b.sent()];\n          case 6:\n            this.outstandingOpenIDConnectTokenRequest = undefined;\n            return [7 /*endfinally*/];\n          case 7:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  WidgetApiImpl.prototype.requestOpenIDConnectTokenInternal = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var leywayMilliseconds, openIdToken, err_2;\n      var _a;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            leywayMilliseconds = 30 * 1000;\n            if (this.cachedOpenIdToken && this.cachedOpenIdToken.expiresAt - leywayMilliseconds > Date.now()) {\n              return [2 /*return*/, this.cachedOpenIdToken.openIdToken];\n            }\n            _b.label = 1;\n          case 1:\n            _b.trys.push([1, 3,, 4]);\n            return [4 /*yield*/, this.matrixWidgetApi.requestOpenIDConnectToken()];\n          case 2:\n            openIdToken = _b.sent();\n            this.cachedOpenIdToken = {\n              openIdToken: openIdToken,\n              expiresAt: Date.now() + ((_a = openIdToken.expires_in) !== null && _a !== void 0 ? _a : 0) * 1000\n            };\n            return [2 /*return*/, openIdToken];\n          case 3:\n            err_2 = _b.sent();\n            this.cachedOpenIdToken = undefined;\n            throw err_2;\n          case 4:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  /** {@inheritdoc WidgetApi.observeTurnServers} */\n  WidgetApiImpl.prototype.observeTurnServers = function () {\n    return from(this.matrixWidgetApi.getTurnServers()).pipe(\n    // For some reason a different naming was chosen for the API, but\n    // we already convert them to the right type for WebRTC consumers.\n    map(function (_a) {\n      var uris = _a.uris,\n        username = _a.username,\n        password = _a.password;\n      return {\n        urls: uris,\n        username: username,\n        credential: password\n      };\n    }));\n  };\n  /** {@inheritdoc WidgetApi.searchUserDirectory}  */\n  WidgetApiImpl.prototype.searchUserDirectory = function (searchTerm, options) {\n    return __awaiter(this, void 0, void 0, function () {\n      var results;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, this.matrixWidgetApi.searchUserDirectory(searchTerm, options === null || options === void 0 ? void 0 : options.limit)];\n          case 1:\n            results = _a.sent().results;\n            return [2 /*return*/, {\n              results: results.map(function (_a) {\n                var user_id = _a.user_id,\n                  display_name = _a.display_name,\n                  avatar_url = _a.avatar_url;\n                return {\n                  userId: user_id,\n                  displayName: display_name,\n                  avatarUrl: avatar_url\n                };\n              })\n            }];\n        }\n      });\n    });\n  };\n  /** {@inheritdoc WidgetApi.getMediaConfig}  */\n  WidgetApiImpl.prototype.getMediaConfig = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, this.matrixWidgetApi.getMediaConfig()];\n          case 1:\n            return [2 /*return*/, _a.sent()];\n        }\n      });\n    });\n  };\n  /** {@inheritdoc WidgetApi.uploadFile}  */\n  WidgetApiImpl.prototype.uploadFile = function (file) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, this.matrixWidgetApi.uploadFile(file)];\n          case 1:\n            return [2 /*return*/, _a.sent()];\n        }\n      });\n    });\n  };\n  /** {@inheritdoc WidgetApi.downloadFile}  */\n  WidgetApiImpl.prototype.downloadFile = function (contentUrl) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, this.matrixWidgetApi.downloadFile(contentUrl)];\n          case 1:\n            return [2 /*return*/, _a.sent()];\n        }\n      });\n    });\n  };\n  return WidgetApiImpl;\n}();\nexport { ROOM_EVENT_REDACTION, STATE_EVENT_POWER_LEVELS, STATE_EVENT_ROOM_MEMBER, WIDGET_CAPABILITY_NAVIGATE, WidgetApiImpl, WidgetParameter, calculateUserPowerLevel, compareOriginServerTS, extractRawWidgetParameters, extractWidgetApiParameters, extractWidgetParameters, generateRoomTimelineCapabilities, generateWidgetRegistrationUrl, getContent, getOriginalEventId, getRoomMemberDisplayName, hasActionPower, hasRoomEventPower, hasStateEventPower, hasWidgetParameters, isRoomEvent, isStateEvent, isValidEventWithRelatesTo, isValidPowerLevelStateEvent, isValidRedactionEvent, isValidRoomEvent, isValidRoomMemberStateEvent, isValidStateEvent as isValidStateEVent, isValidToDeviceMessageEvent, makeEventFromSendStateEventResult, navigateToRoom, observeRedactionEvents, parseWidgetId, redactEvent, repairWidgetRegistration, sendStateEventWithEventResult };","map":{"version":3,"names":["Symbols","WidgetEventCapability","EventDirection","WidgetApi","WidgetApiToWidgetAction","CurrentApiVersions","UnstableApiVersion","MatrixCapabilities","Joi","stringify","parse","filter","fromEvent","firstValueFrom","map","first","throwError","from","mergeAll","concat","ReplaySubject","share","generateRoomTimelineCapabilities","roomIds","AnyRoom","Array","isArray","id","getRoomMemberDisplayName","member","allRoomMembers","content","displayname","state_key","hasDuplicateDisplayName","some","m","room_id","includes","membership","__assign$2","undefined","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","isStateEvent","event","isRoomEvent","isValidRoomEvent","roomEventSchema","validate","error","isValidStateEvent","stateEventSchema","isValidToDeviceMessageEvent","toDeviceMessageSchema","eventSchemaProps","type","string","required","sender","pattern","RegExp","object","event_id","origin_server_ts","date","timestamp","unknown","allow","encrypted","boolean","__awaiter$4","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","__generator$4","__generator","body","_","label","sent","trys","ops","f","y","g","create","Iterator","verb","Symbol","iterator","v","op","TypeError","pop","push","WIDGET_CAPABILITY_NAVIGATE","navigateToRoom","widgetApi_1","roomId_1","widgetApi","roomId","opts","_a","via","params","url","_b","addQueryPrefix","arrayFormat","encodeURIComponent","navigateTo","compareOriginServerTS","a","b","STATE_EVENT_POWER_LEVELS","isNumberOrUndefined","isStringToNumberMapOrUndefined","entries","every","k","isValidPowerLevelStateEvent","events","state_default","events_default","users","users_default","ban","invite","kick","redact","hasRoomEventPower","powerLevelStateEvent","userId","eventType","userLevel","calculateUserPowerLevel","eventLevel","calculateRoomEventPowerLevel","hasStateEventPower","calculateStateEventPowerLevel","hasActionPower","action","calculateActionPowerLevel","_c","__awaiter$3","__generator$3","ROOM_EVENT_REDACTION","isValidRedactionEvent","redacts","redactEvent","eventId","sendRoomEvent","observeRedactionEvents","observeRoomEvents","pipe","getOriginalEventId","newContentRelatesTo","rel_type","getContent","isValidEventWithRelatesTo","relatedEvent","STATE_EVENT_ROOM_MEMBER","isStringUndefinedOrNull","isValidRoomMemberStateEvent","avatar_url","__assign$1","extractWidgetApiParameters","query","window","location","search","ignoreQueryPrefix","parentUrl","Error","clientOrigin","URL","origin","widgetId","extractRawWidgetParameters","hash","substring","indexOf","fromEntries","extractWidgetParameters","isOpenedByClient","displayName","avatarUrl","theme","clientId","clientLanguage","baseUrl","deviceId","parseWidgetId","mainWidgetId","decodeURIComponent","replace","split","creator","match","isModal","startsWith","__awaiter$2","__generator$2","__rest","getOwnPropertySymbols","propertyIsEnumerable","hasWidgetParameters","widgetParameters","generateWidgetRegistrationUrl","options","_d","_e","_f","_g","_h","_j","pathName","_k","includeParameters","_l","rawWidgetParameters","parameters","matrix_user_id","matrix_display_name","matrix_avatar_url","matrix_room_id","matrix_client_id","matrix_client_language","matrix_device_id","matrix_base_url","join","href","pathname","toString","STATE_EVENT_WIDGETS","repairWidgetRegistration","registration","readResult","name","data","requestCapabilities","forStateEvent","Send","Receive","receiveSingleStateEvent","race","sendStateEvent","stateKey","setTimeout","WidgetParameter","__awaiter$1","__generator$1","convertToRawCapabilities","rawCapabilities","c","raw","isDefined","arg","unique","items","Set","subtractSet","as","bs","forEach","delete","isInRoom","matrixEvent","currentRoomId","makeEventFromSendStateEventResult","sendResult","Date","now","sendStateEventWithEventResult","response","__spreadArray","to","pack","l","ar","slice","WidgetApiImpl","matrixWidgetApi","capabilities","supportStandalone","_this","on","SupportedApiVersions","preventDefault","supportedVersions","apiVersion","MSC2762_UPDATE_STATE","transport","reply","detail","supported_versions","events$","SendEvent","toDeviceMessages$","initialCapabilities","RequiresClient","initialize","ready","configReady","once","widgetConfig$","WidgetConfig","ev","widgetConfig","start","getWidgetConfig","rerequestInitialCapabilities","hasInitialCapabilities","hasCapabilities","outstandingCapabilitiesRequest","requestCapabilitiesInternal","requestedSet","capabilities$","NotifyCapabilities","approvedSet","approved","missingSet","size","subscription","err_1","subscribe","updateRequestedCapabilities","unsubscribe","hasCapability","eventType_1","receiveStateEvents","unvalidatedEvents","validatedEvents","readStateEvents","Number","MAX_SAFE_INTEGER","observeStateEvents","historyEvent$","futureEvent$","sendDelayedStateEvent","content_1","delay_1","delay","delay_id","receiveRoomEvents","messageType","readRoomEvents","msgtype","subject","event_id_1","room_id_1","event_1","sendDelayedRoomEvent","updateDelayedEvent","delayId","readEventRelations","chunk","next_batch","relationType","limit","direction","nextToken","sendToDeviceMessage","sendToDevice","observeToDeviceMessages","openModal","closeModalWidget$","openModalWidget","buttons","CloseModalWidget","setModalButtonEnabled","buttonId","isEnabled","observeModalButtons","ButtonClicked","closeModal","closeModalWidget","uri","requestOpenIDConnectToken","outstandingOpenIDConnectTokenRequest","requestOpenIDConnectTokenInternal","leywayMilliseconds","openIdToken","err_2","cachedOpenIdToken","expiresAt","expires_in","observeTurnServers","getTurnServers","uris","username","password","urls","credential","searchUserDirectory","searchTerm","results","user_id","display_name","getMediaConfig","uploadFile","file","downloadFile","contentUrl","isValidStateEVent"],"sources":["C:/Users/pilat/Documents/Knwlab/matrix-bot-widget/node_modules/@matrix-widget-toolkit/api/build/esm/index.js"],"sourcesContent":["import { Symbols, WidgetEventCapability, EventDirection, WidgetApi, WidgetApiToWidgetAction, CurrentApiVersions, UnstableApiVersion, MatrixCapabilities } from 'matrix-widget-api';\nimport Joi from 'joi';\nimport { stringify, parse } from 'qs';\nimport { filter, fromEvent, firstValueFrom, map, first, throwError, from, mergeAll, concat, ReplaySubject, share } from 'rxjs';\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Generate a list of capabilities to access the timeline of other rooms.\n * If enabled, all previously or future capabilities will apply to _all_\n * selected rooms.\n * If `Symbols.AnyRoom` is passed, this is expanded to all joined\n * or invited rooms the client is able to see, current and future.\n *\n * @param roomIds - a list of room ids or `@link Symbols.AnyRoom`.\n * @returns the generated capabilities.\n */\nfunction generateRoomTimelineCapabilities(roomIds) {\n    if (roomIds === Symbols.AnyRoom) {\n        return ['org.matrix.msc2762.timeline:*'];\n    }\n    if (Array.isArray(roomIds)) {\n        return roomIds.map(function (id) { return \"org.matrix.msc2762.timeline:\".concat(id); });\n    }\n    return [];\n}\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Generate a unique displayname of a user that is consistent across Matrix clients.\n *\n * @remarks The algorithm is based on https://spec.matrix.org/v1.1/client-server-api/#calculating-the-display-name-for-a-user\n *\n * @param member - the member to generate a name for.\n * @param allRoomMembers - a list of all members of the same room.\n * @returns the displayname that is unique in given the set of all room members.\n */\nfunction getRoomMemberDisplayName(member, allRoomMembers) {\n    if (allRoomMembers === void 0) { allRoomMembers = []; }\n    // If the m.room.member state event has no displayname field, or if that field\n    // has a null value, use the raw user id as the display name.\n    if (typeof member.content.displayname !== 'string') {\n        return member.state_key;\n    }\n    // If the m.room.member event has a displayname which is unique among members of\n    // the room with membership: join or membership: invite, ...\n    var hasDuplicateDisplayName = allRoomMembers.some(function (m) {\n        // same room\n        return m.room_id === member.room_id &&\n            // not the own event\n            m.state_key !== member.state_key &&\n            // only join or invite state\n            ['join', 'invite'].includes(m.content.membership) &&\n            // same displayname\n            m.content.displayname === member.content.displayname;\n    });\n    if (!hasDuplicateDisplayName) {\n        // ... use the given displayname as the user-visible display name.\n        return member.content.displayname;\n    }\n    else {\n        // The m.room.member event has a non-unique displayname. This should be\n        // disambiguated using the user id, for example “display name (@id:homeserver.org)”.\n        return \"\".concat(member.content.displayname, \" (\").concat(member.state_key, \")\");\n    }\n}\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __assign$2 = (undefined && undefined.__assign) || function () {\n    __assign$2 = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign$2.apply(this, arguments);\n};\n/**\n * Check if the given event is a {@link StateEvent}.\n *\n * @param event - An event that is either a {@link RoomEvent} or a {@link StateEvent}.\n * @returns True, if the event is a {@link StateEvent}.\n */\nfunction isStateEvent(event) {\n    return 'state_key' in event && typeof event.state_key === 'string';\n}\n/**\n * Check if the given event is a {@link RoomEvent}.\n *\n * @param event - An event that is either a {@link RoomEvent} or a {@link StateEvent}.\n * @returns True, if the event is a {@link RoomEvent}.\n */\nfunction isRoomEvent(event) {\n    return !('state_key' in event);\n}\n/**\n * Check if the given value is a valid {@link RoomEvent}.\n *\n * @param event - The value to check\n * @returns true if value is a valid room event, else false.\n */\n// Allow any here, so that the validation works for every event\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction isValidRoomEvent(event) {\n    return roomEventSchema.validate(event).error === undefined;\n}\n/**\n * Check if the given value is a valid {@link StateEvent}.\n *\n * @param event - The value to check\n * @returns true if value is a valid state event, else false.\n */\n// Allow any here, so that the validation works for every event\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction isValidStateEvent(event) {\n    return stateEventSchema.validate(event).error === undefined;\n}\n/**\n * Check if the given value is a valid {@link ToDeviceMessageEvent}.\n *\n * @param event - The value to check\n * @returns true if value is a valid to device message, else false.\n */\nfunction isValidToDeviceMessageEvent(event) {\n    return toDeviceMessageSchema.validate(event).error === undefined;\n}\n/**\n * Base properties to validate for all events.\n */\nvar eventSchemaProps = {\n    type: Joi.string().required(),\n    // Do roughly check against the format\n    // https://spec.matrix.org/v1.13/appendices/#common-identifier-format\n    sender: Joi.string().pattern(new RegExp('^@[^\\\\s:]*:\\\\S*$')).required(),\n    room_id: Joi.string().pattern(new RegExp('^![^:]*:\\\\S*')).required(),\n    content: Joi.object().required(),\n};\nvar roomEventSchema = Joi.object(__assign$2(__assign$2({}, eventSchemaProps), { event_id: Joi.string().pattern(new RegExp('^\\\\$.*')).required(), origin_server_ts: Joi.date().timestamp('javascript').required() })).unknown();\nvar stateEventSchema = Joi.object(__assign$2(__assign$2({}, eventSchemaProps), { event_id: Joi.string().pattern(new RegExp('^\\\\$.*')), origin_server_ts: Joi.date().timestamp('javascript'), state_key: Joi.string().allow('').required() })).unknown();\nvar toDeviceMessageSchema = Joi.object({\n    type: Joi.string().required(),\n    sender: Joi.string().required(),\n    encrypted: Joi.boolean().required(),\n    content: Joi.object().required(),\n}).unknown();\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __awaiter$4 = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator$4 = (undefined && undefined.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n    return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\n/**\n * The capability that needs to be requested in order to navigate to another room.\n */\nvar WIDGET_CAPABILITY_NAVIGATE = 'org.matrix.msc2931.navigate';\n/**\n * Navigate the client to another matrix room.\n *\n * @remarks This requires the {@link WIDGET_CAPABILITY_NAVIGATE} capability.\n *\n * @param widgetApi - the {@link WidgetApi} instance.\n * @param roomId - the room ID.\n * @param opts - {@link NavigateToRoomOptions}\n */\nfunction navigateToRoom(widgetApi_1, roomId_1) {\n    return __awaiter$4(this, arguments, void 0, function (widgetApi, roomId, opts) {\n        var _a, via, params, url;\n        if (opts === void 0) { opts = {}; }\n        return __generator$4(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    _a = opts.via, via = _a === void 0 ? [] : _a;\n                    params = stringify({ via: via }, { addQueryPrefix: true, arrayFormat: 'repeat' });\n                    url = \"https://matrix.to/#/\".concat(encodeURIComponent(roomId)).concat(params);\n                    return [4 /*yield*/, widgetApi.navigateTo(url)];\n                case 1:\n                    _b.sent();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Compares two room events by their origin server timestamp.\n *\n * @param a - A room event\n * @param b - A room event\n * @returns Either zero if the timestamp is equal, \\>0 if a is newer, or \\<0 if\n *          b is newer.\n */\nfunction compareOriginServerTS(a, b) {\n    return a.origin_server_ts - b.origin_server_ts;\n}\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * The name of the power levels state event.\n */\nvar STATE_EVENT_POWER_LEVELS = 'm.room.power_levels';\nfunction isNumberOrUndefined(value) {\n    return value === undefined || typeof value === 'number';\n}\nfunction isStringToNumberMapOrUndefined(value) {\n    return (value === undefined ||\n        (value !== null &&\n            typeof value === 'object' &&\n            Object.entries(value).every(function (_a) {\n                var k = _a[0], v = _a[1];\n                return typeof k === 'string' && typeof v === 'number';\n            })));\n}\n/**\n * Validates that `event` is has a valid structure for a\n * {@link PowerLevelsStateEvent}.\n * @param event - The event to validate.\n * @returns True, if the event is valid.\n */\nfunction isValidPowerLevelStateEvent(event) {\n    if (event.type !== STATE_EVENT_POWER_LEVELS ||\n        typeof event.content !== 'object') {\n        return false;\n    }\n    var content = event.content;\n    if (!isStringToNumberMapOrUndefined(content.events)) {\n        return false;\n    }\n    if (!isNumberOrUndefined(content.state_default)) {\n        return false;\n    }\n    if (!isNumberOrUndefined(content.events_default)) {\n        return false;\n    }\n    if (!isStringToNumberMapOrUndefined(content.users)) {\n        return false;\n    }\n    if (!isNumberOrUndefined(content.users_default)) {\n        return false;\n    }\n    if (!isNumberOrUndefined(content.ban)) {\n        return false;\n    }\n    if (!isNumberOrUndefined(content.invite)) {\n        return false;\n    }\n    if (!isNumberOrUndefined(content.kick)) {\n        return false;\n    }\n    if (!isNumberOrUndefined(content.redact)) {\n        return false;\n    }\n    return true;\n}\n/**\n * Check if a user has the power to send a specific room event.\n *\n * @param powerLevelStateEvent - the content of the `m.room.power_levels` event\n * @param userId - the id of the user\n * @param eventType - the type of room event\n * @returns if true, the user has the power\n */\nfunction hasRoomEventPower(powerLevelStateEvent, userId, eventType) {\n    if (!powerLevelStateEvent) {\n        // See https://github.com/matrix-org/matrix-spec/blob/203b9756f52adfc2a3b63d664f18cdbf9f8bf126/data/event-schemas/schema/m.room.power_levels.yaml#L36-L43\n        return true;\n    }\n    var userLevel = calculateUserPowerLevel(powerLevelStateEvent, userId);\n    var eventLevel = calculateRoomEventPowerLevel(powerLevelStateEvent, eventType);\n    return userLevel >= eventLevel;\n}\n/**\n * Check if a user has the power to send a specific state event.\n *\n * @param powerLevelStateEvent - the content of the `m.room.power_levels` event\n * @param userId - the id of the user\n * @param eventType - the type of state event\n * @returns if true, the user has the power\n */\nfunction hasStateEventPower(powerLevelStateEvent, userId, eventType) {\n    if (!powerLevelStateEvent) {\n        // See https://github.com/matrix-org/matrix-spec/blob/203b9756f52adfc2a3b63d664f18cdbf9f8bf126/data/event-schemas/schema/m.room.power_levels.yaml#L36-L43\n        return true;\n    }\n    var userLevel = calculateUserPowerLevel(powerLevelStateEvent, userId);\n    var eventLevel = calculateStateEventPowerLevel(powerLevelStateEvent, eventType);\n    return userLevel >= eventLevel;\n}\n/**\n * Check if a user has the power to perform a specific action.\n *\n * Supported actions:\n *   * invite: Invite a new user into the room\n *   * kick: Kick a user from the room\n *   * ban: Ban a user from the room\n *   * redact: Redact a message from another user\n *\n * @param powerLevelStateEvent - the content of the `m.room.power_levels` event\n * @param userId - the id of the user\n * @param action - the action\n * @returns if true, the user has the power\n */\nfunction hasActionPower(powerLevelStateEvent, userId, action) {\n    if (!powerLevelStateEvent) {\n        // See https://github.com/matrix-org/matrix-spec/blob/203b9756f52adfc2a3b63d664f18cdbf9f8bf126/data/event-schemas/schema/m.room.power_levels.yaml#L36-L43\n        return true;\n    }\n    var userLevel = calculateUserPowerLevel(powerLevelStateEvent, userId);\n    var eventLevel = calculateActionPowerLevel(powerLevelStateEvent, action);\n    return userLevel >= eventLevel;\n}\n/**\n * Calculate the power level of the user based on a `m.room.power_levels` event.\n *\n * @param powerLevelStateEvent - the content of the `m.room.power_levels` event.\n * @param userId - the ID of the user.\n * @returns the power level of the user.\n */\nfunction calculateUserPowerLevel(powerLevelStateEvent, userId) {\n    var _a, _b, _c;\n    // See https://github.com/matrix-org/matrix-spec/blob/203b9756f52adfc2a3b63d664f18cdbf9f8bf126/data/event-schemas/schema/m.room.power_levels.yaml#L8-L12\n    return ((_c = (_b = (userId ? (_a = powerLevelStateEvent.users) === null || _a === void 0 ? void 0 : _a[userId] : undefined)) !== null && _b !== void 0 ? _b : powerLevelStateEvent.users_default) !== null && _c !== void 0 ? _c : 0);\n}\n/**\n * Calculate the power level that a user needs send a specific room event.\n *\n * @param powerLevelStateEvent - the content of the `m.room.power_levels` event\n * @param eventType - the type of room event\n * @returns the power level that is needed\n */\nfunction calculateRoomEventPowerLevel(powerLevelStateEvent, eventType) {\n    var _a, _b, _c;\n    // See https://github.com/matrix-org/matrix-spec/blob/203b9756f52adfc2a3b63d664f18cdbf9f8bf126/data/event-schemas/schema/m.room.power_levels.yaml#L14-L19\n    return ((_c = (_b = (_a = powerLevelStateEvent.events) === null || _a === void 0 ? void 0 : _a[eventType]) !== null && _b !== void 0 ? _b : powerLevelStateEvent.events_default) !== null && _c !== void 0 ? _c : 0);\n}\n/**\n * Calculate the power level that a user needs send a specific state event.\n *\n * @param powerLevelStateEvent - the content of the `m.room.power_levels` event\n * @param eventType - the type of state event\n * @returns the power level that is needed\n */\nfunction calculateStateEventPowerLevel(powerLevelStateEvent, eventType) {\n    var _a, _b, _c;\n    // See https://github.com/matrix-org/matrix-spec/blob/203b9756f52adfc2a3b63d664f18cdbf9f8bf126/data/event-schemas/schema/m.room.power_levels.yaml#L14-L19\n    return ((_c = (_b = (_a = powerLevelStateEvent.events) === null || _a === void 0 ? void 0 : _a[eventType]) !== null && _b !== void 0 ? _b : powerLevelStateEvent.state_default) !== null && _c !== void 0 ? _c : 50);\n}\n/**\n * Calculate the power level that a user needs to perform an action.\n *\n * Supported actions:\n *   * invite: Invite a new user into the room\n *   * kick: Kick a user from the room\n *   * ban: Ban a user from the room\n *   * redact: Redact a message from another user\n *\n * @param powerLevelStateEvent - the content of the `m.room.power_levels` event\n * @param action - the action\n * @returns the power level that is needed\n */\nfunction calculateActionPowerLevel(powerLevelStateEvent, action) {\n    var _a, _b;\n    // See https://github.com/matrix-org/matrix-spec/blob/203b9756f52adfc2a3b63d664f18cdbf9f8bf126/data/event-schemas/schema/m.room.power_levels.yaml#L27-L32\n    if (action === 'invite') {\n        return (_a = powerLevelStateEvent === null || powerLevelStateEvent === void 0 ? void 0 : powerLevelStateEvent[action]) !== null && _a !== void 0 ? _a : 0;\n    }\n    return (_b = powerLevelStateEvent === null || powerLevelStateEvent === void 0 ? void 0 : powerLevelStateEvent[action]) !== null && _b !== void 0 ? _b : 50;\n}\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __awaiter$3 = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator$3 = (undefined && undefined.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n    return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\n/**\n * The name of the redaction room event.\n */\nvar ROOM_EVENT_REDACTION = 'm.room.redaction';\n/**\n * Check whether the format of a redaction event is valid.\n * @param event - The event to check.\n * @returns True if the event format is valid, otherwise false.\n */\nfunction isValidRedactionEvent(event) {\n    if (event.type === ROOM_EVENT_REDACTION &&\n        typeof event.redacts === 'string') {\n        return true;\n    }\n    return false;\n}\n/**\n * Redacts an event in the current room.\n * @param widgetApi - An instance of the widget API.\n * @param eventId - The id of the event to redact.\n * @returns The redaction event that was send to the room.\n */\nfunction redactEvent(widgetApi, eventId) {\n    return __awaiter$3(this, void 0, void 0, function () {\n        var result;\n        return __generator$3(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, widgetApi.sendRoomEvent(ROOM_EVENT_REDACTION, { redacts: eventId })];\n                case 1:\n                    result = _a.sent();\n                    // The redaction event is special and needs to be casted, as the widget\n                    // toolkit assumes that the content of an event is returned as we send it.\n                    // However for redactions the content is copied directly into the event to\n                    // make it available without decrypting the content.\n                    return [2 /*return*/, result];\n            }\n        });\n    });\n}\n/**\n * Observes redaction events in the current room.\n * @param widgetApi - An instance of the widget API.\n * @returns An observable of validated redaction events.\n */\nfunction observeRedactionEvents(widgetApi) {\n    return widgetApi\n        .observeRoomEvents(ROOM_EVENT_REDACTION)\n        .pipe(filter(isValidRedactionEvent));\n}\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Get the original event id, or the event id of the current event if it\n * doesn't relates to another event.\n * @param event - The room event.\n * @returns The event id of the original event, or the current event id.\n */\nfunction getOriginalEventId(event) {\n    var _a, _b, _c;\n    var newContentRelatesTo = event.content;\n    if (((_a = newContentRelatesTo['m.relates_to']) === null || _a === void 0 ? void 0 : _a.rel_type) === 'm.replace') {\n        return (_c = (_b = newContentRelatesTo['m.relates_to']) === null || _b === void 0 ? void 0 : _b.event_id) !== null && _c !== void 0 ? _c : event.event_id;\n    }\n    return event.event_id;\n}\n/**\n * Get the content of the event, independent from whether it contains the\n * content directly or contains a \"m.new_content\" key.\n * @param event - The room event.\n * @returns Only the content of the room event.\n */\nfunction getContent(event) {\n    var _a;\n    var newContentRelatesTo = event.content;\n    return (_a = newContentRelatesTo['m.new_content']) !== null && _a !== void 0 ? _a : event.content;\n}\n/**\n * Validates that `event` has a valid structure for a\n * {@link EventWithRelatesTo}.\n * @param event - The event to validate.\n * @returns True, if the event is valid.\n */\nfunction isValidEventWithRelatesTo(event) {\n    if (!event.content || typeof event.content !== 'object') {\n        return false;\n    }\n    var relatedEvent = event;\n    if (!relatedEvent.content['m.relates_to'] ||\n        typeof relatedEvent.content['m.relates_to'] !== 'object') {\n        return false;\n    }\n    if (typeof relatedEvent.content['m.relates_to'].rel_type !== 'string' ||\n        typeof relatedEvent.content['m.relates_to'].event_id !== 'string') {\n        return false;\n    }\n    return true;\n}\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * The name of the room member state event.\n */\nvar STATE_EVENT_ROOM_MEMBER = 'm.room.member';\nfunction isStringUndefinedOrNull(value) {\n    return value === undefined || value === null || typeof value === 'string';\n}\n/**\n * Validates that `event` is has a valid structure for a\n * {@link RoomMemberStateEventContent}.\n * @param event - The event to validate.\n * @returns True, if the event is valid.\n */\nfunction isValidRoomMemberStateEvent(event) {\n    if (event.type !== STATE_EVENT_ROOM_MEMBER ||\n        typeof event.content !== 'object') {\n        return false;\n    }\n    var content = event.content;\n    if (typeof content.membership !== 'string') {\n        return false;\n    }\n    if (!isStringUndefinedOrNull(content.displayname)) {\n        return false;\n    }\n    // the avatar_url shouldn't be null, but some implementations\n    // set it as a valid value\n    if (!isStringUndefinedOrNull(content.avatar_url)) {\n        return false;\n    }\n    return true;\n}\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __assign$1 = (undefined && undefined.__assign) || function () {\n    __assign$1 = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign$1.apply(this, arguments);\n};\n/**\n * Extract the parameters used to initialize the widget API from the current\n * `window.location`.\n * @returns The parameters required for initializing the widget API.\n */\nfunction extractWidgetApiParameters() {\n    var query = parse(window.location.search, { ignoreQueryPrefix: true });\n    // If either parentUrl or widgetId is missing, we have no element context and\n    // want to inform the user that the widget only works inside of element.\n    if (typeof query.parentUrl !== 'string') {\n        throw Error('Missing parameter \"parentUrl\"');\n    }\n    var clientOrigin = new URL(query.parentUrl).origin;\n    if (typeof query.widgetId !== 'string') {\n        throw Error('Missing parameter \"widgetId\"');\n    }\n    var widgetId = query.widgetId;\n    return { widgetId: widgetId, clientOrigin: clientOrigin };\n}\n/**\n * Extract the widget parameters from the current `window.location`.\n * @returns The all unprocessed raw widget parameters.\n */\nfunction extractRawWidgetParameters() {\n    var hash = window.location.hash.substring(window.location.hash.indexOf('?') + 1);\n    var params = __assign$1(__assign$1({}, parse(window.location.search, { ignoreQueryPrefix: true })), parse(hash));\n    return Object.fromEntries(Object.entries(params).filter(\n    // For now only use simple values, don't allow them to be specified more\n    // than once.\n    function (e) { return typeof e[1] === 'string'; }));\n}\n/**\n * Extract the widget parameters from the current `window.location`.\n * @returns The widget parameters.\n */\nfunction extractWidgetParameters() {\n    var params = extractRawWidgetParameters();\n    // This is a hack to detect whether we are in a mobile client that supports widgets,\n    // but not the widget API. Mobile clients are not passing the parameters required for\n    // the widget API (like widgetId), but are passing the replaced placeholder values for\n    // the widget parameters.\n    var roomId = params['matrix_room_id'];\n    var isOpenedByClient = typeof roomId === 'string' && roomId !== '$matrix_room_id';\n    return {\n        userId: params['matrix_user_id'],\n        displayName: params['matrix_display_name'],\n        avatarUrl: params['matrix_avatar_url'],\n        roomId: roomId,\n        theme: params['theme'],\n        clientId: params['matrix_client_id'],\n        clientLanguage: params['matrix_client_language'],\n        baseUrl: params['matrix_base_url'],\n        deviceId: params['matrix_device_id'],\n        isOpenedByClient: isOpenedByClient,\n    };\n}\n/**\n * Parse a widget id into the individual fields.\n * @param widgetId - The widget id to parse.\n * @returns The individual fields encoded inside a widget id.\n */\nfunction parseWidgetId(widgetId) {\n    // TODO: Is this whole parsing still working for user widgets?\n    var mainWidgetId = decodeURIComponent(widgetId).replace(/^modal_/, '');\n    var roomId = mainWidgetId.indexOf('_')\n        ? decodeURIComponent(mainWidgetId.split('_')[0])\n        : undefined;\n    var creator = (mainWidgetId.match(/_/g) || []).length > 1\n        ? decodeURIComponent(mainWidgetId.split('_')[1])\n        : undefined;\n    var isModal = decodeURIComponent(widgetId).startsWith('modal_');\n    return {\n        mainWidgetId: mainWidgetId,\n        roomId: roomId,\n        creator: creator,\n        isModal: isModal,\n    };\n}\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __assign = (undefined && undefined.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter$2 = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator$2 = (undefined && undefined.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n    return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __rest = (undefined && undefined.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\n/**\n * Checks whether the necessary widget parameters were provided to the widget.\n *\n * @param widgetApi - The widget api to read the parameters from\n * @returns True, if all parameters were provided.\n */\nfunction hasWidgetParameters(widgetApi) {\n    return (typeof widgetApi.widgetParameters.userId === 'string' &&\n        typeof widgetApi.widgetParameters.displayName === 'string' &&\n        typeof widgetApi.widgetParameters.avatarUrl === 'string' &&\n        typeof widgetApi.widgetParameters.roomId === 'string' &&\n        typeof widgetApi.widgetParameters.theme === 'string' &&\n        typeof widgetApi.widgetParameters.clientId === 'string' &&\n        typeof widgetApi.widgetParameters.clientLanguage === 'string' &&\n        typeof widgetApi.widgetParameters.baseUrl === 'string');\n}\n/**\n * Generate a registration URL for the widget based on the current URL and\n * include all widget parameters (and their placeholders).\n * @param options - Options for generating the URL.\n *                  Use `pathName` to include an optional sub path in the URL.\n *                  Use `includeParameters` to append the widget parameters to\n *                  the URL, defaults to `true`.\n * @returns The generated URL.\n */\nfunction generateWidgetRegistrationUrl(options) {\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n    if (options === void 0) { options = {}; }\n    var pathName = options.pathName, _k = options.includeParameters, includeParameters = _k === void 0 ? true : _k, widgetParameters = options.widgetParameters;\n    // don't forward widgetId and parentUrl as they will be generated by the client\n    // eslint-disable-next-line\n    var _l = extractRawWidgetParameters(); _l.widgetId; _l.parentUrl; var rawWidgetParameters = __rest(_l, [\"widgetId\", \"parentUrl\"]);\n    var parameters = Object.entries(__assign(__assign({}, rawWidgetParameters), { theme: (_a = widgetParameters === null || widgetParameters === void 0 ? void 0 : widgetParameters.theme) !== null && _a !== void 0 ? _a : '$org.matrix.msc2873.client_theme', matrix_user_id: (_b = widgetParameters === null || widgetParameters === void 0 ? void 0 : widgetParameters.userId) !== null && _b !== void 0 ? _b : '$matrix_user_id', matrix_display_name: (_c = widgetParameters === null || widgetParameters === void 0 ? void 0 : widgetParameters.displayName) !== null && _c !== void 0 ? _c : '$matrix_display_name', matrix_avatar_url: (_d = widgetParameters === null || widgetParameters === void 0 ? void 0 : widgetParameters.avatarUrl) !== null && _d !== void 0 ? _d : '$matrix_avatar_url', matrix_room_id: (_e = widgetParameters === null || widgetParameters === void 0 ? void 0 : widgetParameters.roomId) !== null && _e !== void 0 ? _e : '$matrix_room_id', matrix_client_id: (_f = widgetParameters === null || widgetParameters === void 0 ? void 0 : widgetParameters.clientId) !== null && _f !== void 0 ? _f : '$org.matrix.msc2873.client_id', matrix_client_language: (_g = widgetParameters === null || widgetParameters === void 0 ? void 0 : widgetParameters.clientLanguage) !== null && _g !== void 0 ? _g : '$org.matrix.msc2873.client_language', matrix_device_id: (_h = widgetParameters === null || widgetParameters === void 0 ? void 0 : widgetParameters.deviceId) !== null && _h !== void 0 ? _h : '$org.matrix.msc3819.matrix_device_id', matrix_base_url: (_j = widgetParameters === null || widgetParameters === void 0 ? void 0 : widgetParameters.baseUrl) !== null && _j !== void 0 ? _j : '$org.matrix.msc4039.matrix_base_url' }))\n        .map(function (_a) {\n        var k = _a[0], v = _a[1];\n        return \"\".concat(k, \"=\").concat(v);\n    })\n        .join('&');\n    var url = new URL(window.location.href);\n    if (pathName) {\n        url.pathname = pathName;\n    }\n    else {\n        // ensure trailing '/'\n        url.pathname = url.pathname.replace(/\\/?$/, '/');\n    }\n    url.search = '';\n    url.hash = includeParameters ? \"#/?\".concat(parameters) : '';\n    return url.toString();\n}\nvar STATE_EVENT_WIDGETS = 'im.vector.modular.widgets';\n/**\n * Repair/configure the registration of the current widget.\n * This steps make sure to include all the required widget parameters in the\n * URL. Support setting a widget name and additional parameters.\n *\n * @param widgetApi - The widget api of the current widget.\n * @param registration - Optional configuration options for the widget\n *                       registration, like the display name of the widget.\n */\nfunction repairWidgetRegistration(widgetApi_1) {\n    return __awaiter$2(this, arguments, void 0, function (widgetApi, registration) {\n        var readResult, url, name, type, data;\n        if (registration === void 0) { registration = {}; }\n        return __generator$2(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, widgetApi.requestCapabilities([\n                        WidgetEventCapability.forStateEvent(EventDirection.Send, STATE_EVENT_WIDGETS, widgetApi.widgetId),\n                        WidgetEventCapability.forStateEvent(EventDirection.Receive, STATE_EVENT_WIDGETS, widgetApi.widgetId),\n                    ])];\n                case 1:\n                    _a.sent();\n                    return [4 /*yield*/, widgetApi.receiveSingleStateEvent(STATE_EVENT_WIDGETS, widgetApi.widgetId)];\n                case 2:\n                    readResult = _a.sent();\n                    if (!readResult) {\n                        throw new Error(\"Error while repairing registration, can't find existing registration.\");\n                    }\n                    url = generateWidgetRegistrationUrl();\n                    name = registration.name &&\n                        (!readResult.content.name ||\n                            readResult.content.name === 'Custom Widget' ||\n                            readResult.content.name === 'Custom')\n                        ? registration.name\n                        : readResult.content.name;\n                    type = registration.type &&\n                        (!readResult.content.type || readResult.content.type === 'm.custom')\n                        ? registration.type\n                        : readResult.content.type;\n                    data = registration.data\n                        ? __assign(__assign({}, readResult.content.data), registration.data) : readResult.content.data;\n                    // This is a workaround because changing the widget config is breaking the\n                    // widget API communication. However we need to fail in case the power level\n                    // for this change is missing. As the error happens quite fast, we just wait\n                    // a moment and then consider the operation as succeeded.\n                    return [4 /*yield*/, Promise.race([\n                            widgetApi.sendStateEvent(STATE_EVENT_WIDGETS, __assign(__assign({}, readResult.content), { url: url.toString(), name: name, type: type, data: data }), { stateKey: widgetApi.widgetId }),\n                            new Promise(function (resolve) { return setTimeout(resolve, 1000); }),\n                        ])];\n                case 3:\n                    // This is a workaround because changing the widget config is breaking the\n                    // widget API communication. However we need to fail in case the power level\n                    // for this change is missing. As the error happens quite fast, we just wait\n                    // a moment and then consider the operation as succeeded.\n                    _a.sent();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Enumeration of widget parameters that can be checked if they are available upon registration.\n */\nvar WidgetParameter;\n(function (WidgetParameter) {\n    WidgetParameter[\"UserId\"] = \"userId\";\n    WidgetParameter[\"DisplayName\"] = \"displayName\";\n    WidgetParameter[\"AvatarUrl\"] = \"avatarUrl\";\n    WidgetParameter[\"RoomId\"] = \"roomId\";\n    WidgetParameter[\"Theme\"] = \"theme\";\n    WidgetParameter[\"ClientId\"] = \"clientId\";\n    WidgetParameter[\"ClientLanguage\"] = \"clientLanguage\";\n    WidgetParameter[\"DeviceId\"] = \"deviceId\";\n    WidgetParameter[\"BaseUrl\"] = \"baseUrl\";\n})(WidgetParameter || (WidgetParameter = {}));\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __awaiter$1 = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator$1 = (undefined && undefined.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n    return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nfunction convertToRawCapabilities(rawCapabilities) {\n    return rawCapabilities.map(function (c) { return (typeof c === 'string' ? c : c.raw); });\n}\nfunction isDefined(arg) {\n    return arg !== null && arg !== undefined;\n}\nfunction unique(items) {\n    return Array.from(new Set(items));\n}\nfunction subtractSet(as, bs) {\n    var result = new Set(as);\n    bs.forEach(function (v) { return result.delete(v); });\n    return result;\n}\nfunction isInRoom(matrixEvent, currentRoomId, roomIds) {\n    if (!roomIds) {\n        return matrixEvent.room_id === currentRoomId;\n    }\n    if (typeof roomIds === 'string') {\n        if (roomIds !== Symbols.AnyRoom) {\n            throw Error(\"Unknown room id symbol: \".concat(roomIds));\n        }\n        return true;\n    }\n    return roomIds.includes(matrixEvent.room_id);\n}\n/**\n * Create a state event from the arguments.\n *\n * @returns A state event with current timestamp origin_server_ts.\n */\nfunction makeEventFromSendStateEventResult(type, stateKey, content, sender, sendResult) {\n    if (sendResult.event_id === undefined) {\n        throw new Error('Send state event did not return an event ID');\n    }\n    return {\n        content: content,\n        event_id: sendResult.event_id,\n        origin_server_ts: Date.now(),\n        room_id: sendResult.room_id,\n        sender: sender,\n        state_key: stateKey,\n        type: type,\n    };\n}\n/**\n * Send a state event and resolve to a \"virtual\" state event.\n *\n * @returns Promise, that resolves to a state event with current timestamp origin_server_ts.\n */\nfunction sendStateEventWithEventResult(widgetApi, type, stateKey, content) {\n    return __awaiter$1(this, void 0, void 0, function () {\n        var response;\n        return __generator$1(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    if (widgetApi.widgetParameters.userId === undefined) {\n                        throw new Error('Own user ID is undefined');\n                    }\n                    return [4 /*yield*/, widgetApi.sendStateEvent(type, content, { stateKey: stateKey })];\n                case 1:\n                    response = _a.sent();\n                    return [2 /*return*/, makeEventFromSendStateEventResult(type, stateKey, content, widgetApi.widgetParameters.userId, response)];\n            }\n        });\n    });\n}\n\n/*\n * Copyright 2022 Nordeck IT + Consulting GmbH\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (undefined && undefined.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n    return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArray = (undefined && undefined.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\n/**\n * Implementation of the API from the widget to the client.\n *\n * @remarks Widget API is specified here:\n * https://docs.google.com/document/d/1uPF7XWY_dXTKVKV7jZQ2KmsI19wn9-kFRgQ1tFQP7wQ/edit#heading=h.9rn9lt6ctkgi\n */\nvar WidgetApiImpl = /** @class */ (function () {\n    function WidgetApiImpl(\n    /**\n     * Provide access to the underlying widget API from `matrix-widget-sdk`.\n     *\n     * @remarks Normally there is no need to use it, however if features are\n     *          missing from `WidgetApi` it can be handy to work with the\n     *          original API.\n     */\n    matrixWidgetApi, \n    /** {@inheritDoc WidgetApi.widgetId} */\n    widgetId, \n    /** {@inheritDoc WidgetApi.widgetParameters} */\n    widgetParameters, _a) {\n        var _b = _a === void 0 ? {} : _a, _c = _b.capabilities, capabilities = _c === void 0 ? [] : _c, _d = _b.supportStandalone, supportStandalone = _d === void 0 ? false : _d;\n        var _this = this;\n        this.matrixWidgetApi = matrixWidgetApi;\n        this.widgetId = widgetId;\n        this.widgetParameters = widgetParameters;\n        // Disable the update_state API that is not implemented.\n        this.matrixWidgetApi.on(\"action:\".concat(WidgetApiToWidgetAction.SupportedApiVersions), function (event) {\n            event.preventDefault();\n            var supportedVersions = CurrentApiVersions.filter(function (apiVersion) {\n                return apiVersion !== UnstableApiVersion.MSC2762_UPDATE_STATE;\n            });\n            matrixWidgetApi.transport.reply(event.detail, {\n                supported_versions: supportedVersions,\n            });\n        });\n        this.events$ = fromEvent(this.matrixWidgetApi, \"action:\".concat(WidgetApiToWidgetAction.SendEvent), function (event) {\n            event.preventDefault();\n            try {\n                _this.matrixWidgetApi.transport.reply(event.detail, {});\n            }\n            catch (_a) {\n                // Ignore errors while replying\n            }\n            return event;\n        }).pipe(share());\n        this.toDeviceMessages$ = fromEvent(this.matrixWidgetApi, 'action:send_to_device', function (event) {\n            event.preventDefault();\n            try {\n                matrixWidgetApi.transport.reply(event.detail, {});\n            }\n            catch (_a) {\n                // Ignore errors while replying\n            }\n            return event;\n        })\n            .pipe(filter(function (event) { return isValidToDeviceMessageEvent(event.detail.data); }))\n            .pipe(share());\n        this.initialCapabilities = __spreadArray(__spreadArray([], capabilities, true), (supportStandalone ? [] : [MatrixCapabilities.RequiresClient]), true);\n    }\n    /**\n     * Initialize a new widget API instance and wait till it is ready.\n     * There should only be one instance of the widget API. The widget API should\n     * be created as early as possible when starting the application. This is\n     * required to match the timing of the API connection establishment with the\n     * client, especially in Safari. Therefore it is recommended to create it\n     * inside the entrypoint, before initializing rendering engines like react.\n     *\n     * @param param0 - {@link WidgetApiOptions}\n     *\n     * @returns A widget API instance ready to use.\n     */\n    WidgetApiImpl.create = function () {\n        return __awaiter(this, arguments, void 0, function (_a) {\n            var _b, clientOrigin, widgetId, widgetParameters, matrixWidgetApi, widgetApi;\n            var _c = _a === void 0 ? {} : _a, _d = _c.capabilities, capabilities = _d === void 0 ? [] : _d, _e = _c.supportStandalone, supportStandalone = _e === void 0 ? false : _e;\n            return __generator(this, function (_f) {\n                switch (_f.label) {\n                    case 0:\n                        _b = extractWidgetApiParameters(), clientOrigin = _b.clientOrigin, widgetId = _b.widgetId;\n                        widgetParameters = extractWidgetParameters();\n                        matrixWidgetApi = new WidgetApi(widgetId, clientOrigin);\n                        widgetApi = new WidgetApiImpl(matrixWidgetApi, widgetId, widgetParameters, { capabilities: capabilities, supportStandalone: supportStandalone });\n                        return [4 /*yield*/, widgetApi.initialize()];\n                    case 1:\n                        _f.sent();\n                        return [2 /*return*/, widgetApi];\n                }\n            });\n        });\n    };\n    /**\n     * Initialize the widget API and wait till a connection with the client is\n     * fully established.\n     *\n     * Waits till the user has approved the initial set of capabilities. The\n     * method doesn't fail if the user doesn't approve all of them. It is\n     * required to check manually afterwards.\n     * In case of modal widgets it waits till the `widgetConfig` is received.\n     *\n     * @remarks Should only be called once during startup.\n     */\n    WidgetApiImpl.prototype.initialize = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var ready, isModal, configReady, rawCapabilities;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        ready = new Promise(function (resolve) {\n                            _this.matrixWidgetApi.once('ready', function () { return resolve(); });\n                        });\n                        isModal = parseWidgetId(this.widgetId).isModal;\n                        configReady = isModal\n                            ? (function () { return __awaiter(_this, void 0, void 0, function () {\n                                var widgetConfig$, _a;\n                                var _this = this;\n                                return __generator(this, function (_b) {\n                                    switch (_b.label) {\n                                        case 0:\n                                            widgetConfig$ = fromEvent(this.matrixWidgetApi, \"action:\".concat(WidgetApiToWidgetAction.WidgetConfig), function (ev) {\n                                                ev.preventDefault();\n                                                _this.matrixWidgetApi.transport.reply(ev.detail, {});\n                                                return ev.detail.data;\n                                            });\n                                            _a = this;\n                                            return [4 /*yield*/, firstValueFrom(widgetConfig$)];\n                                        case 1:\n                                            _a.widgetConfig = _b.sent();\n                                            return [2 /*return*/];\n                                    }\n                                });\n                            }); })()\n                            : undefined;\n                        rawCapabilities = unique(convertToRawCapabilities(this.initialCapabilities));\n                        this.matrixWidgetApi.requestCapabilities(rawCapabilities);\n                        this.matrixWidgetApi.start();\n                        return [4 /*yield*/, ready];\n                    case 1:\n                        _a.sent();\n                        if (!configReady) return [3 /*break*/, 3];\n                        return [4 /*yield*/, configReady];\n                    case 2:\n                        _a.sent();\n                        _a.label = 3;\n                    case 3: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /** {@inheritDoc WidgetApi.getWidgetConfig} */\n    WidgetApiImpl.prototype.getWidgetConfig = function () {\n        return this.widgetConfig;\n    };\n    /** {@inheritDoc WidgetApi.rerequestInitialCapabilities} */\n    WidgetApiImpl.prototype.rerequestInitialCapabilities = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.requestCapabilities(this.initialCapabilities)];\n                    case 1: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    /** {@inheritDoc WidgetApi.hasInitialCapabilities} */\n    WidgetApiImpl.prototype.hasInitialCapabilities = function () {\n        return this.hasCapabilities(this.initialCapabilities);\n    };\n    /** {@inheritDoc WidgetApi.requestCapabilities} */\n    WidgetApiImpl.prototype.requestCapabilities = function (capabilities) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (!this.outstandingCapabilitiesRequest) return [3 /*break*/, 4];\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, this.outstandingCapabilitiesRequest];\n                    case 2:\n                        _b.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        _b.sent();\n                        return [3 /*break*/, 4];\n                    case 4:\n                        _b.trys.push([4, , 6, 7]);\n                        this.outstandingCapabilitiesRequest =\n                            this.requestCapabilitiesInternal(capabilities);\n                        return [4 /*yield*/, this.outstandingCapabilitiesRequest];\n                    case 5:\n                        _b.sent();\n                        return [3 /*break*/, 7];\n                    case 6:\n                        this.outstandingCapabilitiesRequest = undefined;\n                        return [7 /*endfinally*/];\n                    case 7: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    WidgetApiImpl.prototype.requestCapabilitiesInternal = function (capabilities) {\n        return __awaiter(this, void 0, void 0, function () {\n            var rawCapabilities, requestedSet, capabilities$;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        rawCapabilities = unique(convertToRawCapabilities(capabilities));\n                        // Take shortcut if possible, that avoid extra roundtrips over the API.\n                        if (this.hasCapabilities(rawCapabilities)) {\n                            return [2 /*return*/];\n                        }\n                        requestedSet = new Set(rawCapabilities);\n                        capabilities$ = fromEvent(this.matrixWidgetApi, \"action:\".concat(WidgetApiToWidgetAction.NotifyCapabilities), function (ev) { return ev; }).pipe(\n                        // TODO: `hasCapability` in the matrix-widget-api isn't consistent when capability\n                        //       upgrades happened. But `updateRequestedCapabilities` will deduplicate already\n                        //       approved capabilities, so the the `requested` field will be inconsistent.\n                        //       If we would enable this check, the function will never resolve. This should\n                        //       be reactivated once the capability upgrade is working correctly. See also:\n                        //       https://github.com/matrix-org/matrix-widget-api/issues/52\n                        // Ignore events from other parallel capability requests\n                        //filter((ev) =>\n                        //  equalsSet(new Set(ev.detail.data.requested), requestedSet)\n                        //),\n                        map(function (ev) {\n                            var approvedSet = new Set(ev.detail.data.approved);\n                            var missingSet = subtractSet(requestedSet, approvedSet);\n                            if (missingSet.size > 0) {\n                                throw new Error(\"Capabilities rejected: \".concat(Array.from(missingSet).join(', ')));\n                            }\n                        }), first());\n                        // eslint-disable-next-line no-async-promise-executor\n                        return [4 /*yield*/, new Promise(function (resolve, reject) { return __awaiter(_this, void 0, void 0, function () {\n                                var subscription, err_1;\n                                return __generator(this, function (_a) {\n                                    switch (_a.label) {\n                                        case 0:\n                                            subscription = capabilities$.subscribe({\n                                                next: resolve,\n                                                error: reject,\n                                            });\n                                            _a.label = 1;\n                                        case 1:\n                                            _a.trys.push([1, 3, , 4]);\n                                            this.matrixWidgetApi.requestCapabilities(rawCapabilities);\n                                            return [4 /*yield*/, this.matrixWidgetApi.updateRequestedCapabilities()];\n                                        case 2:\n                                            _a.sent();\n                                            return [3 /*break*/, 4];\n                                        case 3:\n                                            err_1 = _a.sent();\n                                            subscription.unsubscribe();\n                                            reject(err_1);\n                                            return [3 /*break*/, 4];\n                                        case 4: return [2 /*return*/];\n                                    }\n                                });\n                            }); })];\n                    case 1:\n                        // eslint-disable-next-line no-async-promise-executor\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /** {@inheritDoc WidgetApi.hasCapabilities} */\n    WidgetApiImpl.prototype.hasCapabilities = function (capabilities) {\n        var _this = this;\n        var rawCapabilities = convertToRawCapabilities(capabilities);\n        return rawCapabilities.every(function (c) { return _this.matrixWidgetApi.hasCapability(c); });\n    };\n    /** {@inheritDoc WidgetApi.receiveSingleStateEvent} */\n    WidgetApiImpl.prototype.receiveSingleStateEvent = function (eventType_1) {\n        return __awaiter(this, arguments, void 0, function (eventType, stateKey) {\n            var events;\n            if (stateKey === void 0) { stateKey = ''; }\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.receiveStateEvents(eventType, { stateKey: stateKey })];\n                    case 1:\n                        events = _a.sent();\n                        return [2 /*return*/, events && events[0]];\n                }\n            });\n        });\n    };\n    /** {@inheritDoc WidgetApi.receiveStateEvents} */\n    WidgetApiImpl.prototype.receiveStateEvents = function (eventType_1) {\n        return __awaiter(this, arguments, void 0, function (eventType, _a) {\n            var unvalidatedEvents, validatedEvents;\n            var _b = _a === void 0 ? {} : _a, stateKey = _b.stateKey, roomIds = _b.roomIds;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.matrixWidgetApi.readStateEvents(eventType, Number.MAX_SAFE_INTEGER, stateKey, typeof roomIds === 'string' ? [Symbols.AnyRoom] : roomIds)];\n                    case 1:\n                        unvalidatedEvents = (_c.sent());\n                        validatedEvents = unvalidatedEvents.filter(isValidStateEvent);\n                        return [2 /*return*/, validatedEvents];\n                }\n            });\n        });\n    };\n    /** {@inheritDoc WidgetApi.observeStateEvents} */\n    WidgetApiImpl.prototype.observeStateEvents = function (eventType, _a) {\n        var _b = _a === void 0 ? {} : _a, stateKey = _b.stateKey, roomIds = _b.roomIds;\n        var currentRoomId = this.widgetParameters.roomId;\n        if (!currentRoomId) {\n            return throwError(function () { return new Error('Current room id is unknown'); });\n        }\n        var historyEvent$ = from(this.receiveStateEvents(eventType, { stateKey: stateKey, roomIds: roomIds })).pipe(mergeAll());\n        var futureEvent$ = this.events$.pipe(map(function (event) {\n            var matrixEvent = event.detail.data;\n            if (matrixEvent.type === eventType &&\n                matrixEvent.state_key !== undefined &&\n                (stateKey === undefined || matrixEvent.state_key === stateKey) &&\n                isInRoom(matrixEvent, currentRoomId, roomIds)) {\n                return event.detail.data;\n            }\n            return undefined;\n        }), filter(isDefined));\n        return concat(historyEvent$, futureEvent$).pipe(filter(isValidStateEvent));\n    };\n    /** {@inheritDoc WidgetApi.sendStateEvent} */\n    WidgetApiImpl.prototype.sendStateEvent = function (eventType, content, _a) {\n        var _b = _a === void 0 ? {} : _a, roomId = _b.roomId, _c = _b.stateKey, stateKey = _c === void 0 ? '' : _c;\n        return this.matrixWidgetApi.sendStateEvent(eventType, stateKey, content, roomId);\n    };\n    /** {@inheritDoc WidgetApi.sendDelayedStateEvent} */\n    WidgetApiImpl.prototype.sendDelayedStateEvent = function (eventType_1, content_1, delay_1) {\n        return __awaiter(this, arguments, void 0, function (eventType, content, delay, _a) {\n            var delay_id;\n            var _b = _a === void 0 ? {} : _a, roomId = _b.roomId, _c = _b.stateKey, stateKey = _c === void 0 ? '' : _c;\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0: return [4 /*yield*/, this.matrixWidgetApi.sendStateEvent(eventType, stateKey, content, roomId, delay)];\n                    case 1:\n                        delay_id = (_d.sent()).delay_id;\n                        if (!delay_id) {\n                            throw new Error('Delayed event must have a delay_id');\n                        }\n                        return [2 /*return*/, { delay_id: delay_id }];\n                }\n            });\n        });\n    };\n    /** {@inheritDoc WidgetApi.receiveRoomEvents} */\n    WidgetApiImpl.prototype.receiveRoomEvents = function (eventType_1) {\n        return __awaiter(this, arguments, void 0, function (eventType, _a) {\n            var unvalidatedEvents, validatedEvents;\n            var _b = _a === void 0 ? {} : _a, messageType = _b.messageType, roomIds = _b.roomIds;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.matrixWidgetApi.readRoomEvents(eventType, Number.MAX_SAFE_INTEGER, messageType, typeof roomIds === 'string' ? [Symbols.AnyRoom] : roomIds)];\n                    case 1:\n                        unvalidatedEvents = (_c.sent());\n                        validatedEvents = unvalidatedEvents.filter(isValidRoomEvent);\n                        return [2 /*return*/, validatedEvents];\n                }\n            });\n        });\n    };\n    /** {@inheritDoc WidgetApi.observeRoomEvents} */\n    WidgetApiImpl.prototype.observeRoomEvents = function (eventType, _a) {\n        var _b = _a === void 0 ? {} : _a, messageType = _b.messageType, roomIds = _b.roomIds;\n        var currentRoomId = this.widgetParameters.roomId;\n        if (!currentRoomId) {\n            return throwError(function () { return new Error('Current room id is unknown'); });\n        }\n        var historyEvent$ = from(this.receiveRoomEvents(eventType, { messageType: messageType, roomIds: roomIds })).pipe(mergeAll());\n        var futureEvent$ = this.events$.pipe(map(function (event) {\n            var matrixEvent = event.detail.data;\n            if (matrixEvent.type === eventType &&\n                matrixEvent.state_key === undefined &&\n                (!messageType || matrixEvent.content.msgtype === messageType) &&\n                isInRoom(matrixEvent, currentRoomId, roomIds)) {\n                return event.detail.data;\n            }\n            return undefined;\n        }), filter(isDefined));\n        return concat(historyEvent$, futureEvent$).pipe(filter(isValidRoomEvent));\n    };\n    /** {@inheritDoc WidgetApi.sendRoomEvent} */\n    WidgetApiImpl.prototype.sendRoomEvent = function (eventType_1, content_1) {\n        return __awaiter(this, arguments, void 0, function (eventType, content, _a) {\n            var subject, subscription, _b, event_id_1, room_id_1, event_1;\n            var _c = _a === void 0 ? {} : _a, roomId = _c.roomId;\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0:\n                        subject = new ReplaySubject();\n                        subscription = this.events$.subscribe(function (e) { return subject.next(e); });\n                        _d.label = 1;\n                    case 1:\n                        _d.trys.push([1, , 4, 5]);\n                        return [4 /*yield*/, this.matrixWidgetApi.sendRoomEvent(eventType, content, roomId)];\n                    case 2:\n                        _b = _d.sent(), event_id_1 = _b.event_id, room_id_1 = _b.room_id;\n                        return [4 /*yield*/, firstValueFrom(subject.pipe(filter(function (event) {\n                                var matrixEvent = event.detail.data;\n                                return (matrixEvent.event_id === event_id_1 &&\n                                    matrixEvent.room_id === room_id_1);\n                            }), map(function (event) { return event.detail.data; })))];\n                    case 3:\n                        event_1 = _d.sent();\n                        return [2 /*return*/, event_1];\n                    case 4:\n                        subscription.unsubscribe();\n                        return [7 /*endfinally*/];\n                    case 5: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /** {@inheritDoc WidgetApi.sendDelayedRoomEvent} */\n    WidgetApiImpl.prototype.sendDelayedRoomEvent = function (eventType_1, content_1, delay_1) {\n        return __awaiter(this, arguments, void 0, function (eventType, content, delay, _a) {\n            var delay_id;\n            var _b = _a === void 0 ? {} : _a, roomId = _b.roomId;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.matrixWidgetApi.sendRoomEvent(eventType, content, roomId, delay)];\n                    case 1:\n                        delay_id = (_c.sent()).delay_id;\n                        if (!delay_id) {\n                            throw new Error('Delayed event must have a delay_id');\n                        }\n                        return [2 /*return*/, { delay_id: delay_id }];\n                }\n            });\n        });\n    };\n    /** {@inheritDoc WidgetApi.updateDelayedEvent} */\n    WidgetApiImpl.prototype.updateDelayedEvent = function (delayId, action) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.matrixWidgetApi.updateDelayedEvent(delayId, action)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /** {@inheritDoc WidgetApi.readEventRelations} */\n    WidgetApiImpl.prototype.readEventRelations = function (eventId, options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, chunk, next_batch;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, this.matrixWidgetApi.readEventRelations(eventId, options === null || options === void 0 ? void 0 : options.roomId, options === null || options === void 0 ? void 0 : options.relationType, options === null || options === void 0 ? void 0 : options.eventType, options === null || options === void 0 ? void 0 : options.limit, options === null || options === void 0 ? void 0 : options.from, undefined, options === null || options === void 0 ? void 0 : options.direction)];\n                    case 1:\n                        _a = _b.sent(), chunk = _a.chunk, next_batch = _a.next_batch;\n                        return [2 /*return*/, {\n                                chunk: chunk,\n                                nextToken: next_batch !== null && next_batch !== void 0 ? next_batch : undefined,\n                            }];\n                }\n            });\n        });\n    };\n    /** {@inheritDoc WidgetApi.sendToDeviceMessage} */\n    WidgetApiImpl.prototype.sendToDeviceMessage = function (eventType, encrypted, content) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.matrixWidgetApi.sendToDevice(eventType, encrypted, content)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /** {@inheritDoc WidgetApi.observeToDeviceMessages} */\n    WidgetApiImpl.prototype.observeToDeviceMessages = function (eventType) {\n        return this.toDeviceMessages$.pipe(map(function (e) { return e.detail.data; }), filter(isValidToDeviceMessageEvent), filter(function (e) { return e.type === eventType; }));\n    };\n    /** {@inheritDoc WidgetApi.openModal} */\n    WidgetApiImpl.prototype.openModal = function (pathName, name, options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var isModal, url, closeModalWidget$;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        isModal = parseWidgetId(this.widgetId).isModal;\n                        if (isModal) {\n                            throw new Error(\"Modals can't be opened from another modal widget\");\n                        }\n                        url = generateWidgetRegistrationUrl({\n                            pathName: pathName,\n                            widgetParameters: this.widgetParameters,\n                        });\n                        return [4 /*yield*/, this.matrixWidgetApi.openModalWidget(url, name, options === null || options === void 0 ? void 0 : options.buttons, options === null || options === void 0 ? void 0 : options.data)];\n                    case 1:\n                        _a.sent();\n                        closeModalWidget$ = fromEvent(this.matrixWidgetApi, \"action:\".concat(WidgetApiToWidgetAction.CloseModalWidget), function (event) {\n                            var _a;\n                            event.preventDefault();\n                            _this.matrixWidgetApi.transport.reply(event.detail, {});\n                            if (((_a = event.detail.data) === null || _a === void 0 ? void 0 : _a['m.exited']) === true) {\n                                return undefined;\n                            }\n                            return event.detail.data;\n                        });\n                        return [2 /*return*/, firstValueFrom(closeModalWidget$)];\n                }\n            });\n        });\n    };\n    /** {@inheritDoc WidgetApi.setModalButtonEnabled} */\n    WidgetApiImpl.prototype.setModalButtonEnabled = function (buttonId, isEnabled) {\n        return __awaiter(this, void 0, void 0, function () {\n            var isModal;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        isModal = parseWidgetId(this.widgetId).isModal;\n                        if (!isModal) {\n                            throw new Error('Modal buttons can only be enabled from a modal widget');\n                        }\n                        return [4 /*yield*/, this.matrixWidgetApi.setModalButtonEnabled(buttonId, isEnabled)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /** {@inheritDoc WidgetApi.observeModalButtons} */\n    WidgetApiImpl.prototype.observeModalButtons = function () {\n        var _this = this;\n        var isModal = parseWidgetId(this.widgetId).isModal;\n        if (!isModal) {\n            throw new Error('Modal buttons can only be observed from a modal widget');\n        }\n        return fromEvent(this.matrixWidgetApi, \"action:\".concat(WidgetApiToWidgetAction.ButtonClicked), function (event) {\n            event.preventDefault();\n            _this.matrixWidgetApi.transport.reply(event.detail, {});\n            return event.detail.data.id;\n        });\n    };\n    /** {@inheritDoc WidgetApi.closeModal} */\n    WidgetApiImpl.prototype.closeModal = function (data) {\n        return __awaiter(this, void 0, void 0, function () {\n            var isModal;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        isModal = parseWidgetId(this.widgetId).isModal;\n                        if (!isModal) {\n                            throw new Error('Modals can only be closed from a modal widget');\n                        }\n                        return [4 /*yield*/, this.matrixWidgetApi.closeModalWidget(data ? data : { 'm.exited': true })];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /** {@inheritdoc WidgetApi.navigateTo} */\n    WidgetApiImpl.prototype.navigateTo = function (uri) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.matrixWidgetApi.navigateTo(uri)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /** {@inheritdoc WidgetApi.requestOpenIDConnectToken} */\n    WidgetApiImpl.prototype.requestOpenIDConnectToken = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (!this.outstandingOpenIDConnectTokenRequest) return [3 /*break*/, 4];\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, this.outstandingOpenIDConnectTokenRequest];\n                    case 2:\n                        _b.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        _b.sent();\n                        return [3 /*break*/, 4];\n                    case 4:\n                        _b.trys.push([4, , 6, 7]);\n                        this.outstandingOpenIDConnectTokenRequest =\n                            this.requestOpenIDConnectTokenInternal();\n                        return [4 /*yield*/, this.outstandingOpenIDConnectTokenRequest];\n                    case 5: return [2 /*return*/, _b.sent()];\n                    case 6:\n                        this.outstandingOpenIDConnectTokenRequest = undefined;\n                        return [7 /*endfinally*/];\n                    case 7: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    WidgetApiImpl.prototype.requestOpenIDConnectTokenInternal = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var leywayMilliseconds, openIdToken, err_2;\n            var _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        leywayMilliseconds = 30 * 1000;\n                        if (this.cachedOpenIdToken &&\n                            this.cachedOpenIdToken.expiresAt - leywayMilliseconds > Date.now()) {\n                            return [2 /*return*/, this.cachedOpenIdToken.openIdToken];\n                        }\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, this.matrixWidgetApi.requestOpenIDConnectToken()];\n                    case 2:\n                        openIdToken = _b.sent();\n                        this.cachedOpenIdToken = {\n                            openIdToken: openIdToken,\n                            expiresAt: Date.now() + ((_a = openIdToken.expires_in) !== null && _a !== void 0 ? _a : 0) * 1000,\n                        };\n                        return [2 /*return*/, openIdToken];\n                    case 3:\n                        err_2 = _b.sent();\n                        this.cachedOpenIdToken = undefined;\n                        throw err_2;\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /** {@inheritdoc WidgetApi.observeTurnServers} */\n    WidgetApiImpl.prototype.observeTurnServers = function () {\n        return from(this.matrixWidgetApi.getTurnServers()).pipe(\n        // For some reason a different naming was chosen for the API, but\n        // we already convert them to the right type for WebRTC consumers.\n        map(function (_a) {\n            var uris = _a.uris, username = _a.username, password = _a.password;\n            return ({\n                urls: uris,\n                username: username,\n                credential: password,\n            });\n        }));\n    };\n    /** {@inheritdoc WidgetApi.searchUserDirectory}  */\n    WidgetApiImpl.prototype.searchUserDirectory = function (searchTerm, options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var results;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.matrixWidgetApi.searchUserDirectory(searchTerm, options === null || options === void 0 ? void 0 : options.limit)];\n                    case 1:\n                        results = (_a.sent()).results;\n                        return [2 /*return*/, {\n                                results: results.map(function (_a) {\n                                    var user_id = _a.user_id, display_name = _a.display_name, avatar_url = _a.avatar_url;\n                                    return ({\n                                        userId: user_id,\n                                        displayName: display_name,\n                                        avatarUrl: avatar_url,\n                                    });\n                                }),\n                            }];\n                }\n            });\n        });\n    };\n    /** {@inheritdoc WidgetApi.getMediaConfig}  */\n    WidgetApiImpl.prototype.getMediaConfig = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.matrixWidgetApi.getMediaConfig()];\n                    case 1: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    /** {@inheritdoc WidgetApi.uploadFile}  */\n    WidgetApiImpl.prototype.uploadFile = function (file) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.matrixWidgetApi.uploadFile(file)];\n                    case 1: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    /** {@inheritdoc WidgetApi.downloadFile}  */\n    WidgetApiImpl.prototype.downloadFile = function (contentUrl) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.matrixWidgetApi.downloadFile(contentUrl)];\n                    case 1: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    return WidgetApiImpl;\n}());\n\nexport { ROOM_EVENT_REDACTION, STATE_EVENT_POWER_LEVELS, STATE_EVENT_ROOM_MEMBER, WIDGET_CAPABILITY_NAVIGATE, WidgetApiImpl, WidgetParameter, calculateUserPowerLevel, compareOriginServerTS, extractRawWidgetParameters, extractWidgetApiParameters, extractWidgetParameters, generateRoomTimelineCapabilities, generateWidgetRegistrationUrl, getContent, getOriginalEventId, getRoomMemberDisplayName, hasActionPower, hasRoomEventPower, hasStateEventPower, hasWidgetParameters, isRoomEvent, isStateEvent, isValidEventWithRelatesTo, isValidPowerLevelStateEvent, isValidRedactionEvent, isValidRoomEvent, isValidRoomMemberStateEvent, isValidStateEvent as isValidStateEVent, isValidToDeviceMessageEvent, makeEventFromSendStateEventResult, navigateToRoom, observeRedactionEvents, parseWidgetId, redactEvent, repairWidgetRegistration, sendStateEventWithEventResult };\n"],"mappings":"AAAA,SAASA,OAAO,EAAEC,qBAAqB,EAAEC,cAAc,EAAEC,SAAS,EAAEC,uBAAuB,EAAEC,kBAAkB,EAAEC,kBAAkB,EAAEC,kBAAkB,QAAQ,mBAAmB;AAClL,OAAOC,GAAG,MAAM,KAAK;AACrB,SAASC,SAAS,EAAEC,KAAK,QAAQ,IAAI;AACrC,SAASC,MAAM,EAAEC,SAAS,EAAEC,cAAc,EAAEC,GAAG,EAAEC,KAAK,EAAEC,UAAU,EAAEC,IAAI,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,aAAa,EAAEC,KAAK,QAAQ,MAAM;;AAE9H;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASC,gCAAgCA,CAACC,OAAO,EAAE;EAC/C,IAAIA,OAAO,KAAKvB,OAAO,CAACwB,OAAO,EAAE;IAC7B,OAAO,CAAC,+BAA+B,CAAC;EAC5C;EACA,IAAIC,KAAK,CAACC,OAAO,CAACH,OAAO,CAAC,EAAE;IACxB,OAAOA,OAAO,CAACT,GAAG,CAAC,UAAUa,EAAE,EAAE;MAAE,OAAO,8BAA8B,CAACR,MAAM,CAACQ,EAAE,CAAC;IAAE,CAAC,CAAC;EAC3F;EACA,OAAO,EAAE;AACb;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASC,wBAAwBA,CAACC,MAAM,EAAEC,cAAc,EAAE;EACtD,IAAIA,cAAc,KAAK,KAAK,CAAC,EAAE;IAAEA,cAAc,GAAG,EAAE;EAAE;EACtD;EACA;EACA,IAAI,OAAOD,MAAM,CAACE,OAAO,CAACC,WAAW,KAAK,QAAQ,EAAE;IAChD,OAAOH,MAAM,CAACI,SAAS;EAC3B;EACA;EACA;EACA,IAAIC,uBAAuB,GAAGJ,cAAc,CAACK,IAAI,CAAC,UAAUC,CAAC,EAAE;IAC3D;IACA,OAAOA,CAAC,CAACC,OAAO,KAAKR,MAAM,CAACQ,OAAO;IAC/B;IACAD,CAAC,CAACH,SAAS,KAAKJ,MAAM,CAACI,SAAS;IAChC;IACA,CAAC,MAAM,EAAE,QAAQ,CAAC,CAACK,QAAQ,CAACF,CAAC,CAACL,OAAO,CAACQ,UAAU,CAAC;IACjD;IACAH,CAAC,CAACL,OAAO,CAACC,WAAW,KAAKH,MAAM,CAACE,OAAO,CAACC,WAAW;EAC5D,CAAC,CAAC;EACF,IAAI,CAACE,uBAAuB,EAAE;IAC1B;IACA,OAAOL,MAAM,CAACE,OAAO,CAACC,WAAW;EACrC,CAAC,MACI;IACD;IACA;IACA,OAAO,EAAE,CAACb,MAAM,CAACU,MAAM,CAACE,OAAO,CAACC,WAAW,EAAE,IAAI,CAAC,CAACb,MAAM,CAACU,MAAM,CAACI,SAAS,EAAE,GAAG,CAAC;EACpF;AACJ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAIO,UAAU,GAAIC,SAAS,IAAIA,SAAS,CAACC,QAAQ,IAAK,YAAY;EAC9DF,UAAU,GAAGG,MAAM,CAACC,MAAM,IAAI,UAASC,CAAC,EAAE;IACtC,KAAK,IAAIC,CAAC,EAAEC,CAAC,GAAG,CAAC,EAAEC,CAAC,GAAGC,SAAS,CAACC,MAAM,EAAEH,CAAC,GAAGC,CAAC,EAAED,CAAC,EAAE,EAAE;MACjDD,CAAC,GAAGG,SAAS,CAACF,CAAC,CAAC;MAChB,KAAK,IAAII,CAAC,IAAIL,CAAC,EAAE,IAAIH,MAAM,CAACS,SAAS,CAACC,cAAc,CAACC,IAAI,CAACR,CAAC,EAAEK,CAAC,CAAC,EAC3DN,CAAC,CAACM,CAAC,CAAC,GAAGL,CAAC,CAACK,CAAC,CAAC;IACnB;IACA,OAAON,CAAC;EACZ,CAAC;EACD,OAAOL,UAAU,CAACe,KAAK,CAAC,IAAI,EAAEN,SAAS,CAAC;AAC5C,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA,SAASO,YAAYA,CAACC,KAAK,EAAE;EACzB,OAAO,WAAW,IAAIA,KAAK,IAAI,OAAOA,KAAK,CAACxB,SAAS,KAAK,QAAQ;AACtE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASyB,WAAWA,CAACD,KAAK,EAAE;EACxB,OAAO,EAAE,WAAW,IAAIA,KAAK,CAAC;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASE,gBAAgBA,CAACF,KAAK,EAAE;EAC7B,OAAOG,eAAe,CAACC,QAAQ,CAACJ,KAAK,CAAC,CAACK,KAAK,KAAKrB,SAAS;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASsB,iBAAiBA,CAACN,KAAK,EAAE;EAC9B,OAAOO,gBAAgB,CAACH,QAAQ,CAACJ,KAAK,CAAC,CAACK,KAAK,KAAKrB,SAAS;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASwB,2BAA2BA,CAACR,KAAK,EAAE;EACxC,OAAOS,qBAAqB,CAACL,QAAQ,CAACJ,KAAK,CAAC,CAACK,KAAK,KAAKrB,SAAS;AACpE;AACA;AACA;AACA;AACA,IAAI0B,gBAAgB,GAAG;EACnBC,IAAI,EAAE5D,GAAG,CAAC6D,MAAM,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC;EAC7B;EACA;EACAC,MAAM,EAAE/D,GAAG,CAAC6D,MAAM,CAAC,CAAC,CAACG,OAAO,CAAC,IAAIC,MAAM,CAAC,kBAAkB,CAAC,CAAC,CAACH,QAAQ,CAAC,CAAC;EACvEjC,OAAO,EAAE7B,GAAG,CAAC6D,MAAM,CAAC,CAAC,CAACG,OAAO,CAAC,IAAIC,MAAM,CAAC,cAAc,CAAC,CAAC,CAACH,QAAQ,CAAC,CAAC;EACpEvC,OAAO,EAAEvB,GAAG,CAACkE,MAAM,CAAC,CAAC,CAACJ,QAAQ,CAAC;AACnC,CAAC;AACD,IAAIV,eAAe,GAAGpD,GAAG,CAACkE,MAAM,CAAClC,UAAU,CAACA,UAAU,CAAC,CAAC,CAAC,EAAE2B,gBAAgB,CAAC,EAAE;EAAEQ,QAAQ,EAAEnE,GAAG,CAAC6D,MAAM,CAAC,CAAC,CAACG,OAAO,CAAC,IAAIC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAACH,QAAQ,CAAC,CAAC;EAAEM,gBAAgB,EAAEpE,GAAG,CAACqE,IAAI,CAAC,CAAC,CAACC,SAAS,CAAC,YAAY,CAAC,CAACR,QAAQ,CAAC;AAAE,CAAC,CAAC,CAAC,CAACS,OAAO,CAAC,CAAC;AAC9N,IAAIf,gBAAgB,GAAGxD,GAAG,CAACkE,MAAM,CAAClC,UAAU,CAACA,UAAU,CAAC,CAAC,CAAC,EAAE2B,gBAAgB,CAAC,EAAE;EAAEQ,QAAQ,EAAEnE,GAAG,CAAC6D,MAAM,CAAC,CAAC,CAACG,OAAO,CAAC,IAAIC,MAAM,CAAC,QAAQ,CAAC,CAAC;EAAEG,gBAAgB,EAAEpE,GAAG,CAACqE,IAAI,CAAC,CAAC,CAACC,SAAS,CAAC,YAAY,CAAC;EAAE7C,SAAS,EAAEzB,GAAG,CAAC6D,MAAM,CAAC,CAAC,CAACW,KAAK,CAAC,EAAE,CAAC,CAACV,QAAQ,CAAC;AAAE,CAAC,CAAC,CAAC,CAACS,OAAO,CAAC,CAAC;AACvP,IAAIb,qBAAqB,GAAG1D,GAAG,CAACkE,MAAM,CAAC;EACnCN,IAAI,EAAE5D,GAAG,CAAC6D,MAAM,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC;EAC7BC,MAAM,EAAE/D,GAAG,CAAC6D,MAAM,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC;EAC/BW,SAAS,EAAEzE,GAAG,CAAC0E,OAAO,CAAC,CAAC,CAACZ,QAAQ,CAAC,CAAC;EACnCvC,OAAO,EAAEvB,GAAG,CAACkE,MAAM,CAAC,CAAC,CAACJ,QAAQ,CAAC;AACnC,CAAC,CAAC,CAACS,OAAO,CAAC,CAAC;;AAEZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAII,WAAW,GAAI1C,SAAS,IAAIA,SAAS,CAAC2C,SAAS,IAAK,UAAUC,OAAO,EAAEC,UAAU,EAAEC,CAAC,EAAEC,SAAS,EAAE;EACjG,SAASC,KAAKA,CAACC,KAAK,EAAE;IAAE,OAAOA,KAAK,YAAYH,CAAC,GAAGG,KAAK,GAAG,IAAIH,CAAC,CAAC,UAAUI,OAAO,EAAE;MAAEA,OAAO,CAACD,KAAK,CAAC;IAAE,CAAC,CAAC;EAAE;EAC3G,OAAO,KAAKH,CAAC,KAAKA,CAAC,GAAGK,OAAO,CAAC,EAAE,UAAUD,OAAO,EAAEE,MAAM,EAAE;IACvD,SAASC,SAASA,CAACJ,KAAK,EAAE;MAAE,IAAI;QAAEK,IAAI,CAACP,SAAS,CAACQ,IAAI,CAACN,KAAK,CAAC,CAAC;MAAE,CAAC,CAAC,OAAOO,CAAC,EAAE;QAAEJ,MAAM,CAACI,CAAC,CAAC;MAAE;IAAE;IAC1F,SAASC,QAAQA,CAACR,KAAK,EAAE;MAAE,IAAI;QAAEK,IAAI,CAACP,SAAS,CAAC,OAAO,CAAC,CAACE,KAAK,CAAC,CAAC;MAAE,CAAC,CAAC,OAAOO,CAAC,EAAE;QAAEJ,MAAM,CAACI,CAAC,CAAC;MAAE;IAAE;IAC7F,SAASF,IAAIA,CAACI,MAAM,EAAE;MAAEA,MAAM,CAACC,IAAI,GAAGT,OAAO,CAACQ,MAAM,CAACT,KAAK,CAAC,GAAGD,KAAK,CAACU,MAAM,CAACT,KAAK,CAAC,CAACW,IAAI,CAACP,SAAS,EAAEI,QAAQ,CAAC;IAAE;IAC7GH,IAAI,CAAC,CAACP,SAAS,GAAGA,SAAS,CAACjC,KAAK,CAAC8B,OAAO,EAAEC,UAAU,IAAI,EAAE,CAAC,EAAEU,IAAI,CAAC,CAAC,CAAC;EACzE,CAAC,CAAC;AACN,CAAC;AACD,IAAIM,aAAa,GAAI7D,SAAS,IAAIA,SAAS,CAAC8D,WAAW,IAAK,UAAUlB,OAAO,EAAEmB,IAAI,EAAE;EACjF,IAAIC,CAAC,GAAG;MAAEC,KAAK,EAAE,CAAC;MAAEC,IAAI,EAAE,SAAAA,CAAA,EAAW;QAAE,IAAI9D,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,MAAMA,CAAC,CAAC,CAAC,CAAC;QAAE,OAAOA,CAAC,CAAC,CAAC,CAAC;MAAE,CAAC;MAAE+D,IAAI,EAAE,EAAE;MAAEC,GAAG,EAAE;IAAG,CAAC;IAAEC,CAAC;IAAEC,CAAC;IAAElE,CAAC;IAAEmE,CAAC,GAAGrE,MAAM,CAACsE,MAAM,CAAC,CAAC,OAAOC,QAAQ,KAAK,UAAU,GAAGA,QAAQ,GAAGvE,MAAM,EAAES,SAAS,CAAC;EAChM,OAAO4D,CAAC,CAAChB,IAAI,GAAGmB,IAAI,CAAC,CAAC,CAAC,EAAEH,CAAC,CAAC,OAAO,CAAC,GAAGG,IAAI,CAAC,CAAC,CAAC,EAAEH,CAAC,CAAC,QAAQ,CAAC,GAAGG,IAAI,CAAC,CAAC,CAAC,EAAE,OAAOC,MAAM,KAAK,UAAU,KAAKJ,CAAC,CAACI,MAAM,CAACC,QAAQ,CAAC,GAAG,YAAW;IAAE,OAAO,IAAI;EAAE,CAAC,CAAC,EAAEL,CAAC;EAC3J,SAASG,IAAIA,CAACnE,CAAC,EAAE;IAAE,OAAO,UAAUsE,CAAC,EAAE;MAAE,OAAOvB,IAAI,CAAC,CAAC/C,CAAC,EAAEsE,CAAC,CAAC,CAAC;IAAE,CAAC;EAAE;EACjE,SAASvB,IAAIA,CAACwB,EAAE,EAAE;IACd,IAAIT,CAAC,EAAE,MAAM,IAAIU,SAAS,CAAC,iCAAiC,CAAC;IAC7D,OAAOR,CAAC,KAAKA,CAAC,GAAG,CAAC,EAAEO,EAAE,CAAC,CAAC,CAAC,KAAKd,CAAC,GAAG,CAAC,CAAC,CAAC,EAAEA,CAAC,EAAE,IAAI;MAC1C,IAAIK,CAAC,GAAG,CAAC,EAAEC,CAAC,KAAKlE,CAAC,GAAG0E,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,GAAGR,CAAC,CAAC,QAAQ,CAAC,GAAGQ,EAAE,CAAC,CAAC,CAAC,GAAGR,CAAC,CAAC,OAAO,CAAC,KAAK,CAAClE,CAAC,GAAGkE,CAAC,CAAC,QAAQ,CAAC,KAAKlE,CAAC,CAACS,IAAI,CAACyD,CAAC,CAAC,EAAE,CAAC,CAAC,GAAGA,CAAC,CAACf,IAAI,CAAC,IAAI,CAAC,CAACnD,CAAC,GAAGA,CAAC,CAACS,IAAI,CAACyD,CAAC,EAAEQ,EAAE,CAAC,CAAC,CAAC,CAAC,EAAEnB,IAAI,EAAE,OAAOvD,CAAC;MAC5J,IAAIkE,CAAC,GAAG,CAAC,EAAElE,CAAC,EAAE0E,EAAE,GAAG,CAACA,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE1E,CAAC,CAAC6C,KAAK,CAAC;MACvC,QAAQ6B,EAAE,CAAC,CAAC,CAAC;QACT,KAAK,CAAC;QAAE,KAAK,CAAC;UAAE1E,CAAC,GAAG0E,EAAE;UAAE;QACxB,KAAK,CAAC;UAAEd,CAAC,CAACC,KAAK,EAAE;UAAE,OAAO;YAAEhB,KAAK,EAAE6B,EAAE,CAAC,CAAC,CAAC;YAAEnB,IAAI,EAAE;UAAM,CAAC;QACvD,KAAK,CAAC;UAAEK,CAAC,CAACC,KAAK,EAAE;UAAEK,CAAC,GAAGQ,EAAE,CAAC,CAAC,CAAC;UAAEA,EAAE,GAAG,CAAC,CAAC,CAAC;UAAE;QACxC,KAAK,CAAC;UAAEA,EAAE,GAAGd,CAAC,CAACI,GAAG,CAACY,GAAG,CAAC,CAAC;UAAEhB,CAAC,CAACG,IAAI,CAACa,GAAG,CAAC,CAAC;UAAE;QACxC;UACI,IAAI,EAAE5E,CAAC,GAAG4D,CAAC,CAACG,IAAI,EAAE/D,CAAC,GAAGA,CAAC,CAACK,MAAM,GAAG,CAAC,IAAIL,CAAC,CAACA,CAAC,CAACK,MAAM,GAAG,CAAC,CAAC,CAAC,KAAKqE,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,IAAIA,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE;YAAEd,CAAC,GAAG,CAAC;YAAE;UAAU;UAC3G,IAAIc,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC1E,CAAC,IAAK0E,EAAE,CAAC,CAAC,CAAC,GAAG1E,CAAC,CAAC,CAAC,CAAC,IAAI0E,EAAE,CAAC,CAAC,CAAC,GAAG1E,CAAC,CAAC,CAAC,CAAE,CAAC,EAAE;YAAE4D,CAAC,CAACC,KAAK,GAAGa,EAAE,CAAC,CAAC,CAAC;YAAE;UAAO;UACrF,IAAIA,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,IAAId,CAAC,CAACC,KAAK,GAAG7D,CAAC,CAAC,CAAC,CAAC,EAAE;YAAE4D,CAAC,CAACC,KAAK,GAAG7D,CAAC,CAAC,CAAC,CAAC;YAAEA,CAAC,GAAG0E,EAAE;YAAE;UAAO;UACpE,IAAI1E,CAAC,IAAI4D,CAAC,CAACC,KAAK,GAAG7D,CAAC,CAAC,CAAC,CAAC,EAAE;YAAE4D,CAAC,CAACC,KAAK,GAAG7D,CAAC,CAAC,CAAC,CAAC;YAAE4D,CAAC,CAACI,GAAG,CAACa,IAAI,CAACH,EAAE,CAAC;YAAE;UAAO;UAClE,IAAI1E,CAAC,CAAC,CAAC,CAAC,EAAE4D,CAAC,CAACI,GAAG,CAACY,GAAG,CAAC,CAAC;UACrBhB,CAAC,CAACG,IAAI,CAACa,GAAG,CAAC,CAAC;UAAE;MACtB;MACAF,EAAE,GAAGf,IAAI,CAAClD,IAAI,CAAC+B,OAAO,EAAEoB,CAAC,CAAC;IAC9B,CAAC,CAAC,OAAOR,CAAC,EAAE;MAAEsB,EAAE,GAAG,CAAC,CAAC,EAAEtB,CAAC,CAAC;MAAEc,CAAC,GAAG,CAAC;IAAE,CAAC,SAAS;MAAED,CAAC,GAAGjE,CAAC,GAAG,CAAC;IAAE;IACzD,IAAI0E,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,MAAMA,EAAE,CAAC,CAAC,CAAC;IAAE,OAAO;MAAE7B,KAAK,EAAE6B,EAAE,CAAC,CAAC,CAAC,GAAGA,EAAE,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC;MAAEnB,IAAI,EAAE;IAAK,CAAC;EACpF;AACJ,CAAC;AACD;AACA;AACA;AACA,IAAIuB,0BAA0B,GAAG,6BAA6B;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASC,cAAcA,CAACC,WAAW,EAAEC,QAAQ,EAAE;EAC3C,OAAO3C,WAAW,CAAC,IAAI,EAAElC,SAAS,EAAE,KAAK,CAAC,EAAE,UAAU8E,SAAS,EAAEC,MAAM,EAAEC,IAAI,EAAE;IAC3E,IAAIC,EAAE,EAAEC,GAAG,EAAEC,MAAM,EAAEC,GAAG;IACxB,IAAIJ,IAAI,KAAK,KAAK,CAAC,EAAE;MAAEA,IAAI,GAAG,CAAC,CAAC;IAAE;IAClC,OAAO3B,aAAa,CAAC,IAAI,EAAE,UAAUgC,EAAE,EAAE;MACrC,QAAQA,EAAE,CAAC5B,KAAK;QACZ,KAAK,CAAC;UACFwB,EAAE,GAAGD,IAAI,CAACE,GAAG,EAAEA,GAAG,GAAGD,EAAE,KAAK,KAAK,CAAC,GAAG,EAAE,GAAGA,EAAE;UAC5CE,MAAM,GAAG3H,SAAS,CAAC;YAAE0H,GAAG,EAAEA;UAAI,CAAC,EAAE;YAAEI,cAAc,EAAE,IAAI;YAAEC,WAAW,EAAE;UAAS,CAAC,CAAC;UACjFH,GAAG,GAAG,sBAAsB,CAAClH,MAAM,CAACsH,kBAAkB,CAACT,MAAM,CAAC,CAAC,CAAC7G,MAAM,CAACiH,MAAM,CAAC;UAC9E,OAAO,CAAC,CAAC,CAAC,WAAWL,SAAS,CAACW,UAAU,CAACL,GAAG,CAAC,CAAC;QACnD,KAAK,CAAC;UACFC,EAAE,CAAC3B,IAAI,CAAC,CAAC;UACT,OAAO,CAAC,CAAC,CAAC,WAAW;MAC7B;IACJ,CAAC,CAAC;EACN,CAAC,CAAC;AACN;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASgC,qBAAqBA,CAACC,CAAC,EAAEC,CAAC,EAAE;EACjC,OAAOD,CAAC,CAAChE,gBAAgB,GAAGiE,CAAC,CAACjE,gBAAgB;AAClD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAIkE,wBAAwB,GAAG,qBAAqB;AACpD,SAASC,mBAAmBA,CAACrD,KAAK,EAAE;EAChC,OAAOA,KAAK,KAAKjD,SAAS,IAAI,OAAOiD,KAAK,KAAK,QAAQ;AAC3D;AACA,SAASsD,8BAA8BA,CAACtD,KAAK,EAAE;EAC3C,OAAQA,KAAK,KAAKjD,SAAS,IACtBiD,KAAK,KAAK,IAAI,IACX,OAAOA,KAAK,KAAK,QAAQ,IACzB/C,MAAM,CAACsG,OAAO,CAACvD,KAAK,CAAC,CAACwD,KAAK,CAAC,UAAUhB,EAAE,EAAE;IACtC,IAAIiB,CAAC,GAAGjB,EAAE,CAAC,CAAC,CAAC;MAAEZ,CAAC,GAAGY,EAAE,CAAC,CAAC,CAAC;IACxB,OAAO,OAAOiB,CAAC,KAAK,QAAQ,IAAI,OAAO7B,CAAC,KAAK,QAAQ;EACzD,CAAC,CAAE;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS8B,2BAA2BA,CAAC3F,KAAK,EAAE;EACxC,IAAIA,KAAK,CAACW,IAAI,KAAK0E,wBAAwB,IACvC,OAAOrF,KAAK,CAAC1B,OAAO,KAAK,QAAQ,EAAE;IACnC,OAAO,KAAK;EAChB;EACA,IAAIA,OAAO,GAAG0B,KAAK,CAAC1B,OAAO;EAC3B,IAAI,CAACiH,8BAA8B,CAACjH,OAAO,CAACsH,MAAM,CAAC,EAAE;IACjD,OAAO,KAAK;EAChB;EACA,IAAI,CAACN,mBAAmB,CAAChH,OAAO,CAACuH,aAAa,CAAC,EAAE;IAC7C,OAAO,KAAK;EAChB;EACA,IAAI,CAACP,mBAAmB,CAAChH,OAAO,CAACwH,cAAc,CAAC,EAAE;IAC9C,OAAO,KAAK;EAChB;EACA,IAAI,CAACP,8BAA8B,CAACjH,OAAO,CAACyH,KAAK,CAAC,EAAE;IAChD,OAAO,KAAK;EAChB;EACA,IAAI,CAACT,mBAAmB,CAAChH,OAAO,CAAC0H,aAAa,CAAC,EAAE;IAC7C,OAAO,KAAK;EAChB;EACA,IAAI,CAACV,mBAAmB,CAAChH,OAAO,CAAC2H,GAAG,CAAC,EAAE;IACnC,OAAO,KAAK;EAChB;EACA,IAAI,CAACX,mBAAmB,CAAChH,OAAO,CAAC4H,MAAM,CAAC,EAAE;IACtC,OAAO,KAAK;EAChB;EACA,IAAI,CAACZ,mBAAmB,CAAChH,OAAO,CAAC6H,IAAI,CAAC,EAAE;IACpC,OAAO,KAAK;EAChB;EACA,IAAI,CAACb,mBAAmB,CAAChH,OAAO,CAAC8H,MAAM,CAAC,EAAE;IACtC,OAAO,KAAK;EAChB;EACA,OAAO,IAAI;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASC,iBAAiBA,CAACC,oBAAoB,EAAEC,MAAM,EAAEC,SAAS,EAAE;EAChE,IAAI,CAACF,oBAAoB,EAAE;IACvB;IACA,OAAO,IAAI;EACf;EACA,IAAIG,SAAS,GAAGC,uBAAuB,CAACJ,oBAAoB,EAAEC,MAAM,CAAC;EACrE,IAAII,UAAU,GAAGC,4BAA4B,CAACN,oBAAoB,EAAEE,SAAS,CAAC;EAC9E,OAAOC,SAAS,IAAIE,UAAU;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASE,kBAAkBA,CAACP,oBAAoB,EAAEC,MAAM,EAAEC,SAAS,EAAE;EACjE,IAAI,CAACF,oBAAoB,EAAE;IACvB;IACA,OAAO,IAAI;EACf;EACA,IAAIG,SAAS,GAAGC,uBAAuB,CAACJ,oBAAoB,EAAEC,MAAM,CAAC;EACrE,IAAII,UAAU,GAAGG,6BAA6B,CAACR,oBAAoB,EAAEE,SAAS,CAAC;EAC/E,OAAOC,SAAS,IAAIE,UAAU;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASI,cAAcA,CAACT,oBAAoB,EAAEC,MAAM,EAAES,MAAM,EAAE;EAC1D,IAAI,CAACV,oBAAoB,EAAE;IACvB;IACA,OAAO,IAAI;EACf;EACA,IAAIG,SAAS,GAAGC,uBAAuB,CAACJ,oBAAoB,EAAEC,MAAM,CAAC;EACrE,IAAII,UAAU,GAAGM,yBAAyB,CAACX,oBAAoB,EAAEU,MAAM,CAAC;EACxE,OAAOP,SAAS,IAAIE,UAAU;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASD,uBAAuBA,CAACJ,oBAAoB,EAAEC,MAAM,EAAE;EAC3D,IAAI9B,EAAE,EAAEI,EAAE,EAAEqC,EAAE;EACd;EACA,OAAQ,CAACA,EAAE,GAAG,CAACrC,EAAE,GAAI0B,MAAM,GAAG,CAAC9B,EAAE,GAAG6B,oBAAoB,CAACP,KAAK,MAAM,IAAI,IAAItB,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAAC8B,MAAM,CAAC,GAAGvH,SAAU,MAAM,IAAI,IAAI6F,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAGyB,oBAAoB,CAACN,aAAa,MAAM,IAAI,IAAIkB,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG,CAAC;AACzO;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASN,4BAA4BA,CAACN,oBAAoB,EAAEE,SAAS,EAAE;EACnE,IAAI/B,EAAE,EAAEI,EAAE,EAAEqC,EAAE;EACd;EACA,OAAQ,CAACA,EAAE,GAAG,CAACrC,EAAE,GAAG,CAACJ,EAAE,GAAG6B,oBAAoB,CAACV,MAAM,MAAM,IAAI,IAAInB,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAAC+B,SAAS,CAAC,MAAM,IAAI,IAAI3B,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAGyB,oBAAoB,CAACR,cAAc,MAAM,IAAI,IAAIoB,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG,CAAC;AACvN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASJ,6BAA6BA,CAACR,oBAAoB,EAAEE,SAAS,EAAE;EACpE,IAAI/B,EAAE,EAAEI,EAAE,EAAEqC,EAAE;EACd;EACA,OAAQ,CAACA,EAAE,GAAG,CAACrC,EAAE,GAAG,CAACJ,EAAE,GAAG6B,oBAAoB,CAACV,MAAM,MAAM,IAAI,IAAInB,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAAC+B,SAAS,CAAC,MAAM,IAAI,IAAI3B,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAGyB,oBAAoB,CAACT,aAAa,MAAM,IAAI,IAAIqB,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG,EAAE;AACvN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASD,yBAAyBA,CAACX,oBAAoB,EAAEU,MAAM,EAAE;EAC7D,IAAIvC,EAAE,EAAEI,EAAE;EACV;EACA,IAAImC,MAAM,KAAK,QAAQ,EAAE;IACrB,OAAO,CAACvC,EAAE,GAAG6B,oBAAoB,KAAK,IAAI,IAAIA,oBAAoB,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,oBAAoB,CAACU,MAAM,CAAC,MAAM,IAAI,IAAIvC,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG,CAAC;EAC7J;EACA,OAAO,CAACI,EAAE,GAAGyB,oBAAoB,KAAK,IAAI,IAAIA,oBAAoB,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,oBAAoB,CAACU,MAAM,CAAC,MAAM,IAAI,IAAInC,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG,EAAE;AAC9J;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAIsC,WAAW,GAAInI,SAAS,IAAIA,SAAS,CAAC2C,SAAS,IAAK,UAAUC,OAAO,EAAEC,UAAU,EAAEC,CAAC,EAAEC,SAAS,EAAE;EACjG,SAASC,KAAKA,CAACC,KAAK,EAAE;IAAE,OAAOA,KAAK,YAAYH,CAAC,GAAGG,KAAK,GAAG,IAAIH,CAAC,CAAC,UAAUI,OAAO,EAAE;MAAEA,OAAO,CAACD,KAAK,CAAC;IAAE,CAAC,CAAC;EAAE;EAC3G,OAAO,KAAKH,CAAC,KAAKA,CAAC,GAAGK,OAAO,CAAC,EAAE,UAAUD,OAAO,EAAEE,MAAM,EAAE;IACvD,SAASC,SAASA,CAACJ,KAAK,EAAE;MAAE,IAAI;QAAEK,IAAI,CAACP,SAAS,CAACQ,IAAI,CAACN,KAAK,CAAC,CAAC;MAAE,CAAC,CAAC,OAAOO,CAAC,EAAE;QAAEJ,MAAM,CAACI,CAAC,CAAC;MAAE;IAAE;IAC1F,SAASC,QAAQA,CAACR,KAAK,EAAE;MAAE,IAAI;QAAEK,IAAI,CAACP,SAAS,CAAC,OAAO,CAAC,CAACE,KAAK,CAAC,CAAC;MAAE,CAAC,CAAC,OAAOO,CAAC,EAAE;QAAEJ,MAAM,CAACI,CAAC,CAAC;MAAE;IAAE;IAC7F,SAASF,IAAIA,CAACI,MAAM,EAAE;MAAEA,MAAM,CAACC,IAAI,GAAGT,OAAO,CAACQ,MAAM,CAACT,KAAK,CAAC,GAAGD,KAAK,CAACU,MAAM,CAACT,KAAK,CAAC,CAACW,IAAI,CAACP,SAAS,EAAEI,QAAQ,CAAC;IAAE;IAC7GH,IAAI,CAAC,CAACP,SAAS,GAAGA,SAAS,CAACjC,KAAK,CAAC8B,OAAO,EAAEC,UAAU,IAAI,EAAE,CAAC,EAAEU,IAAI,CAAC,CAAC,CAAC;EACzE,CAAC,CAAC;AACN,CAAC;AACD,IAAI6E,aAAa,GAAIpI,SAAS,IAAIA,SAAS,CAAC8D,WAAW,IAAK,UAAUlB,OAAO,EAAEmB,IAAI,EAAE;EACjF,IAAIC,CAAC,GAAG;MAAEC,KAAK,EAAE,CAAC;MAAEC,IAAI,EAAE,SAAAA,CAAA,EAAW;QAAE,IAAI9D,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,MAAMA,CAAC,CAAC,CAAC,CAAC;QAAE,OAAOA,CAAC,CAAC,CAAC,CAAC;MAAE,CAAC;MAAE+D,IAAI,EAAE,EAAE;MAAEC,GAAG,EAAE;IAAG,CAAC;IAAEC,CAAC;IAAEC,CAAC;IAAElE,CAAC;IAAEmE,CAAC,GAAGrE,MAAM,CAACsE,MAAM,CAAC,CAAC,OAAOC,QAAQ,KAAK,UAAU,GAAGA,QAAQ,GAAGvE,MAAM,EAAES,SAAS,CAAC;EAChM,OAAO4D,CAAC,CAAChB,IAAI,GAAGmB,IAAI,CAAC,CAAC,CAAC,EAAEH,CAAC,CAAC,OAAO,CAAC,GAAGG,IAAI,CAAC,CAAC,CAAC,EAAEH,CAAC,CAAC,QAAQ,CAAC,GAAGG,IAAI,CAAC,CAAC,CAAC,EAAE,OAAOC,MAAM,KAAK,UAAU,KAAKJ,CAAC,CAACI,MAAM,CAACC,QAAQ,CAAC,GAAG,YAAW;IAAE,OAAO,IAAI;EAAE,CAAC,CAAC,EAAEL,CAAC;EAC3J,SAASG,IAAIA,CAACnE,CAAC,EAAE;IAAE,OAAO,UAAUsE,CAAC,EAAE;MAAE,OAAOvB,IAAI,CAAC,CAAC/C,CAAC,EAAEsE,CAAC,CAAC,CAAC;IAAE,CAAC;EAAE;EACjE,SAASvB,IAAIA,CAACwB,EAAE,EAAE;IACd,IAAIT,CAAC,EAAE,MAAM,IAAIU,SAAS,CAAC,iCAAiC,CAAC;IAC7D,OAAOR,CAAC,KAAKA,CAAC,GAAG,CAAC,EAAEO,EAAE,CAAC,CAAC,CAAC,KAAKd,CAAC,GAAG,CAAC,CAAC,CAAC,EAAEA,CAAC,EAAE,IAAI;MAC1C,IAAIK,CAAC,GAAG,CAAC,EAAEC,CAAC,KAAKlE,CAAC,GAAG0E,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,GAAGR,CAAC,CAAC,QAAQ,CAAC,GAAGQ,EAAE,CAAC,CAAC,CAAC,GAAGR,CAAC,CAAC,OAAO,CAAC,KAAK,CAAClE,CAAC,GAAGkE,CAAC,CAAC,QAAQ,CAAC,KAAKlE,CAAC,CAACS,IAAI,CAACyD,CAAC,CAAC,EAAE,CAAC,CAAC,GAAGA,CAAC,CAACf,IAAI,CAAC,IAAI,CAAC,CAACnD,CAAC,GAAGA,CAAC,CAACS,IAAI,CAACyD,CAAC,EAAEQ,EAAE,CAAC,CAAC,CAAC,CAAC,EAAEnB,IAAI,EAAE,OAAOvD,CAAC;MAC5J,IAAIkE,CAAC,GAAG,CAAC,EAAElE,CAAC,EAAE0E,EAAE,GAAG,CAACA,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE1E,CAAC,CAAC6C,KAAK,CAAC;MACvC,QAAQ6B,EAAE,CAAC,CAAC,CAAC;QACT,KAAK,CAAC;QAAE,KAAK,CAAC;UAAE1E,CAAC,GAAG0E,EAAE;UAAE;QACxB,KAAK,CAAC;UAAEd,CAAC,CAACC,KAAK,EAAE;UAAE,OAAO;YAAEhB,KAAK,EAAE6B,EAAE,CAAC,CAAC,CAAC;YAAEnB,IAAI,EAAE;UAAM,CAAC;QACvD,KAAK,CAAC;UAAEK,CAAC,CAACC,KAAK,EAAE;UAAEK,CAAC,GAAGQ,EAAE,CAAC,CAAC,CAAC;UAAEA,EAAE,GAAG,CAAC,CAAC,CAAC;UAAE;QACxC,KAAK,CAAC;UAAEA,EAAE,GAAGd,CAAC,CAACI,GAAG,CAACY,GAAG,CAAC,CAAC;UAAEhB,CAAC,CAACG,IAAI,CAACa,GAAG,CAAC,CAAC;UAAE;QACxC;UACI,IAAI,EAAE5E,CAAC,GAAG4D,CAAC,CAACG,IAAI,EAAE/D,CAAC,GAAGA,CAAC,CAACK,MAAM,GAAG,CAAC,IAAIL,CAAC,CAACA,CAAC,CAACK,MAAM,GAAG,CAAC,CAAC,CAAC,KAAKqE,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,IAAIA,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE;YAAEd,CAAC,GAAG,CAAC;YAAE;UAAU;UAC3G,IAAIc,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC1E,CAAC,IAAK0E,EAAE,CAAC,CAAC,CAAC,GAAG1E,CAAC,CAAC,CAAC,CAAC,IAAI0E,EAAE,CAAC,CAAC,CAAC,GAAG1E,CAAC,CAAC,CAAC,CAAE,CAAC,EAAE;YAAE4D,CAAC,CAACC,KAAK,GAAGa,EAAE,CAAC,CAAC,CAAC;YAAE;UAAO;UACrF,IAAIA,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,IAAId,CAAC,CAACC,KAAK,GAAG7D,CAAC,CAAC,CAAC,CAAC,EAAE;YAAE4D,CAAC,CAACC,KAAK,GAAG7D,CAAC,CAAC,CAAC,CAAC;YAAEA,CAAC,GAAG0E,EAAE;YAAE;UAAO;UACpE,IAAI1E,CAAC,IAAI4D,CAAC,CAACC,KAAK,GAAG7D,CAAC,CAAC,CAAC,CAAC,EAAE;YAAE4D,CAAC,CAACC,KAAK,GAAG7D,CAAC,CAAC,CAAC,CAAC;YAAE4D,CAAC,CAACI,GAAG,CAACa,IAAI,CAACH,EAAE,CAAC;YAAE;UAAO;UAClE,IAAI1E,CAAC,CAAC,CAAC,CAAC,EAAE4D,CAAC,CAACI,GAAG,CAACY,GAAG,CAAC,CAAC;UACrBhB,CAAC,CAACG,IAAI,CAACa,GAAG,CAAC,CAAC;UAAE;MACtB;MACAF,EAAE,GAAGf,IAAI,CAAClD,IAAI,CAAC+B,OAAO,EAAEoB,CAAC,CAAC;IAC9B,CAAC,CAAC,OAAOR,CAAC,EAAE;MAAEsB,EAAE,GAAG,CAAC,CAAC,EAAEtB,CAAC,CAAC;MAAEc,CAAC,GAAG,CAAC;IAAE,CAAC,SAAS;MAAED,CAAC,GAAGjE,CAAC,GAAG,CAAC;IAAE;IACzD,IAAI0E,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,MAAMA,EAAE,CAAC,CAAC,CAAC;IAAE,OAAO;MAAE7B,KAAK,EAAE6B,EAAE,CAAC,CAAC,CAAC,GAAGA,EAAE,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC;MAAEnB,IAAI,EAAE;IAAK,CAAC;EACpF;AACJ,CAAC;AACD;AACA;AACA;AACA,IAAI0E,oBAAoB,GAAG,kBAAkB;AAC7C;AACA;AACA;AACA;AACA;AACA,SAASC,qBAAqBA,CAACtH,KAAK,EAAE;EAClC,IAAIA,KAAK,CAACW,IAAI,KAAK0G,oBAAoB,IACnC,OAAOrH,KAAK,CAACuH,OAAO,KAAK,QAAQ,EAAE;IACnC,OAAO,IAAI;EACf;EACA,OAAO,KAAK;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASC,WAAWA,CAAClD,SAAS,EAAEmD,OAAO,EAAE;EACrC,OAAON,WAAW,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;IACjD,IAAIzE,MAAM;IACV,OAAO0E,aAAa,CAAC,IAAI,EAAE,UAAU3C,EAAE,EAAE;MACrC,QAAQA,EAAE,CAACxB,KAAK;QACZ,KAAK,CAAC;UAAE,OAAO,CAAC,CAAC,CAAC,WAAWqB,SAAS,CAACoD,aAAa,CAACL,oBAAoB,EAAE;YAAEE,OAAO,EAAEE;UAAQ,CAAC,CAAC,CAAC;QACjG,KAAK,CAAC;UACF/E,MAAM,GAAG+B,EAAE,CAACvB,IAAI,CAAC,CAAC;UAClB;UACA;UACA;UACA;UACA,OAAO,CAAC,CAAC,CAAC,YAAYR,MAAM,CAAC;MACrC;IACJ,CAAC,CAAC;EACN,CAAC,CAAC;AACN;AACA;AACA;AACA;AACA;AACA;AACA,SAASiF,sBAAsBA,CAACrD,SAAS,EAAE;EACvC,OAAOA,SAAS,CACXsD,iBAAiB,CAACP,oBAAoB,CAAC,CACvCQ,IAAI,CAAC3K,MAAM,CAACoK,qBAAqB,CAAC,CAAC;AAC5C;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASQ,kBAAkBA,CAAC9H,KAAK,EAAE;EAC/B,IAAIyE,EAAE,EAAEI,EAAE,EAAEqC,EAAE;EACd,IAAIa,mBAAmB,GAAG/H,KAAK,CAAC1B,OAAO;EACvC,IAAI,CAAC,CAACmG,EAAE,GAAGsD,mBAAmB,CAAC,cAAc,CAAC,MAAM,IAAI,IAAItD,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACuD,QAAQ,MAAM,WAAW,EAAE;IAC/G,OAAO,CAACd,EAAE,GAAG,CAACrC,EAAE,GAAGkD,mBAAmB,CAAC,cAAc,CAAC,MAAM,IAAI,IAAIlD,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAAC3D,QAAQ,MAAM,IAAI,IAAIgG,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAGlH,KAAK,CAACkB,QAAQ;EAC7J;EACA,OAAOlB,KAAK,CAACkB,QAAQ;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS+G,UAAUA,CAACjI,KAAK,EAAE;EACvB,IAAIyE,EAAE;EACN,IAAIsD,mBAAmB,GAAG/H,KAAK,CAAC1B,OAAO;EACvC,OAAO,CAACmG,EAAE,GAAGsD,mBAAmB,CAAC,eAAe,CAAC,MAAM,IAAI,IAAItD,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAGzE,KAAK,CAAC1B,OAAO;AACrG;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS4J,yBAAyBA,CAAClI,KAAK,EAAE;EACtC,IAAI,CAACA,KAAK,CAAC1B,OAAO,IAAI,OAAO0B,KAAK,CAAC1B,OAAO,KAAK,QAAQ,EAAE;IACrD,OAAO,KAAK;EAChB;EACA,IAAI6J,YAAY,GAAGnI,KAAK;EACxB,IAAI,CAACmI,YAAY,CAAC7J,OAAO,CAAC,cAAc,CAAC,IACrC,OAAO6J,YAAY,CAAC7J,OAAO,CAAC,cAAc,CAAC,KAAK,QAAQ,EAAE;IAC1D,OAAO,KAAK;EAChB;EACA,IAAI,OAAO6J,YAAY,CAAC7J,OAAO,CAAC,cAAc,CAAC,CAAC0J,QAAQ,KAAK,QAAQ,IACjE,OAAOG,YAAY,CAAC7J,OAAO,CAAC,cAAc,CAAC,CAAC4C,QAAQ,KAAK,QAAQ,EAAE;IACnE,OAAO,KAAK;EAChB;EACA,OAAO,IAAI;AACf;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAIkH,uBAAuB,GAAG,eAAe;AAC7C,SAASC,uBAAuBA,CAACpG,KAAK,EAAE;EACpC,OAAOA,KAAK,KAAKjD,SAAS,IAAIiD,KAAK,KAAK,IAAI,IAAI,OAAOA,KAAK,KAAK,QAAQ;AAC7E;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASqG,2BAA2BA,CAACtI,KAAK,EAAE;EACxC,IAAIA,KAAK,CAACW,IAAI,KAAKyH,uBAAuB,IACtC,OAAOpI,KAAK,CAAC1B,OAAO,KAAK,QAAQ,EAAE;IACnC,OAAO,KAAK;EAChB;EACA,IAAIA,OAAO,GAAG0B,KAAK,CAAC1B,OAAO;EAC3B,IAAI,OAAOA,OAAO,CAACQ,UAAU,KAAK,QAAQ,EAAE;IACxC,OAAO,KAAK;EAChB;EACA,IAAI,CAACuJ,uBAAuB,CAAC/J,OAAO,CAACC,WAAW,CAAC,EAAE;IAC/C,OAAO,KAAK;EAChB;EACA;EACA;EACA,IAAI,CAAC8J,uBAAuB,CAAC/J,OAAO,CAACiK,UAAU,CAAC,EAAE;IAC9C,OAAO,KAAK;EAChB;EACA,OAAO,IAAI;AACf;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAIC,UAAU,GAAIxJ,SAAS,IAAIA,SAAS,CAACC,QAAQ,IAAK,YAAY;EAC9DuJ,UAAU,GAAGtJ,MAAM,CAACC,MAAM,IAAI,UAASC,CAAC,EAAE;IACtC,KAAK,IAAIC,CAAC,EAAEC,CAAC,GAAG,CAAC,EAAEC,CAAC,GAAGC,SAAS,CAACC,MAAM,EAAEH,CAAC,GAAGC,CAAC,EAAED,CAAC,EAAE,EAAE;MACjDD,CAAC,GAAGG,SAAS,CAACF,CAAC,CAAC;MAChB,KAAK,IAAII,CAAC,IAAIL,CAAC,EAAE,IAAIH,MAAM,CAACS,SAAS,CAACC,cAAc,CAACC,IAAI,CAACR,CAAC,EAAEK,CAAC,CAAC,EAC3DN,CAAC,CAACM,CAAC,CAAC,GAAGL,CAAC,CAACK,CAAC,CAAC;IACnB;IACA,OAAON,CAAC;EACZ,CAAC;EACD,OAAOoJ,UAAU,CAAC1I,KAAK,CAAC,IAAI,EAAEN,SAAS,CAAC;AAC5C,CAAC;AACD;AACA;AACA;AACA;AACA;AACA,SAASiJ,0BAA0BA,CAAA,EAAG;EAClC,IAAIC,KAAK,GAAGzL,KAAK,CAAC0L,MAAM,CAACC,QAAQ,CAACC,MAAM,EAAE;IAAEC,iBAAiB,EAAE;EAAK,CAAC,CAAC;EACtE;EACA;EACA,IAAI,OAAOJ,KAAK,CAACK,SAAS,KAAK,QAAQ,EAAE;IACrC,MAAMC,KAAK,CAAC,+BAA+B,CAAC;EAChD;EACA,IAAIC,YAAY,GAAG,IAAIC,GAAG,CAACR,KAAK,CAACK,SAAS,CAAC,CAACI,MAAM;EAClD,IAAI,OAAOT,KAAK,CAACU,QAAQ,KAAK,QAAQ,EAAE;IACpC,MAAMJ,KAAK,CAAC,8BAA8B,CAAC;EAC/C;EACA,IAAII,QAAQ,GAAGV,KAAK,CAACU,QAAQ;EAC7B,OAAO;IAAEA,QAAQ,EAAEA,QAAQ;IAAEH,YAAY,EAAEA;EAAa,CAAC;AAC7D;AACA;AACA;AACA;AACA;AACA,SAASI,0BAA0BA,CAAA,EAAG;EAClC,IAAIC,IAAI,GAAGX,MAAM,CAACC,QAAQ,CAACU,IAAI,CAACC,SAAS,CAACZ,MAAM,CAACC,QAAQ,CAACU,IAAI,CAACE,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;EAChF,IAAI7E,MAAM,GAAG6D,UAAU,CAACA,UAAU,CAAC,CAAC,CAAC,EAAEvL,KAAK,CAAC0L,MAAM,CAACC,QAAQ,CAACC,MAAM,EAAE;IAAEC,iBAAiB,EAAE;EAAK,CAAC,CAAC,CAAC,EAAE7L,KAAK,CAACqM,IAAI,CAAC,CAAC;EAChH,OAAOpK,MAAM,CAACuK,WAAW,CAACvK,MAAM,CAACsG,OAAO,CAACb,MAAM,CAAC,CAACzH,MAAM;EACvD;EACA;EACA,UAAUsF,CAAC,EAAE;IAAE,OAAO,OAAOA,CAAC,CAAC,CAAC,CAAC,KAAK,QAAQ;EAAE,CAAC,CAAC,CAAC;AACvD;AACA;AACA;AACA;AACA;AACA,SAASkH,uBAAuBA,CAAA,EAAG;EAC/B,IAAI/E,MAAM,GAAG0E,0BAA0B,CAAC,CAAC;EACzC;EACA;EACA;EACA;EACA,IAAI9E,MAAM,GAAGI,MAAM,CAAC,gBAAgB,CAAC;EACrC,IAAIgF,gBAAgB,GAAG,OAAOpF,MAAM,KAAK,QAAQ,IAAIA,MAAM,KAAK,iBAAiB;EACjF,OAAO;IACHgC,MAAM,EAAE5B,MAAM,CAAC,gBAAgB,CAAC;IAChCiF,WAAW,EAAEjF,MAAM,CAAC,qBAAqB,CAAC;IAC1CkF,SAAS,EAAElF,MAAM,CAAC,mBAAmB,CAAC;IACtCJ,MAAM,EAAEA,MAAM;IACduF,KAAK,EAAEnF,MAAM,CAAC,OAAO,CAAC;IACtBoF,QAAQ,EAAEpF,MAAM,CAAC,kBAAkB,CAAC;IACpCqF,cAAc,EAAErF,MAAM,CAAC,wBAAwB,CAAC;IAChDsF,OAAO,EAAEtF,MAAM,CAAC,iBAAiB,CAAC;IAClCuF,QAAQ,EAAEvF,MAAM,CAAC,kBAAkB,CAAC;IACpCgF,gBAAgB,EAAEA;EACtB,CAAC;AACL;AACA;AACA;AACA;AACA;AACA;AACA,SAASQ,aAAaA,CAACf,QAAQ,EAAE;EAC7B;EACA,IAAIgB,YAAY,GAAGC,kBAAkB,CAACjB,QAAQ,CAAC,CAACkB,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC;EACtE,IAAI/F,MAAM,GAAG6F,YAAY,CAACZ,OAAO,CAAC,GAAG,CAAC,GAChCa,kBAAkB,CAACD,YAAY,CAACG,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,GAC9CvL,SAAS;EACf,IAAIwL,OAAO,GAAG,CAACJ,YAAY,CAACK,KAAK,CAAC,IAAI,CAAC,IAAI,EAAE,EAAEhL,MAAM,GAAG,CAAC,GACnD4K,kBAAkB,CAACD,YAAY,CAACG,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,GAC9CvL,SAAS;EACf,IAAI0L,OAAO,GAAGL,kBAAkB,CAACjB,QAAQ,CAAC,CAACuB,UAAU,CAAC,QAAQ,CAAC;EAC/D,OAAO;IACHP,YAAY,EAAEA,YAAY;IAC1B7F,MAAM,EAAEA,MAAM;IACdiG,OAAO,EAAEA,OAAO;IAChBE,OAAO,EAAEA;EACb,CAAC;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAIzL,QAAQ,GAAID,SAAS,IAAIA,SAAS,CAACC,QAAQ,IAAK,YAAY;EAC5DA,QAAQ,GAAGC,MAAM,CAACC,MAAM,IAAI,UAASC,CAAC,EAAE;IACpC,KAAK,IAAIC,CAAC,EAAEC,CAAC,GAAG,CAAC,EAAEC,CAAC,GAAGC,SAAS,CAACC,MAAM,EAAEH,CAAC,GAAGC,CAAC,EAAED,CAAC,EAAE,EAAE;MACjDD,CAAC,GAAGG,SAAS,CAACF,CAAC,CAAC;MAChB,KAAK,IAAII,CAAC,IAAIL,CAAC,EAAE,IAAIH,MAAM,CAACS,SAAS,CAACC,cAAc,CAACC,IAAI,CAACR,CAAC,EAAEK,CAAC,CAAC,EAC3DN,CAAC,CAACM,CAAC,CAAC,GAAGL,CAAC,CAACK,CAAC,CAAC;IACnB;IACA,OAAON,CAAC;EACZ,CAAC;EACD,OAAOH,QAAQ,CAACa,KAAK,CAAC,IAAI,EAAEN,SAAS,CAAC;AAC1C,CAAC;AACD,IAAIoL,WAAW,GAAI5L,SAAS,IAAIA,SAAS,CAAC2C,SAAS,IAAK,UAAUC,OAAO,EAAEC,UAAU,EAAEC,CAAC,EAAEC,SAAS,EAAE;EACjG,SAASC,KAAKA,CAACC,KAAK,EAAE;IAAE,OAAOA,KAAK,YAAYH,CAAC,GAAGG,KAAK,GAAG,IAAIH,CAAC,CAAC,UAAUI,OAAO,EAAE;MAAEA,OAAO,CAACD,KAAK,CAAC;IAAE,CAAC,CAAC;EAAE;EAC3G,OAAO,KAAKH,CAAC,KAAKA,CAAC,GAAGK,OAAO,CAAC,EAAE,UAAUD,OAAO,EAAEE,MAAM,EAAE;IACvD,SAASC,SAASA,CAACJ,KAAK,EAAE;MAAE,IAAI;QAAEK,IAAI,CAACP,SAAS,CAACQ,IAAI,CAACN,KAAK,CAAC,CAAC;MAAE,CAAC,CAAC,OAAOO,CAAC,EAAE;QAAEJ,MAAM,CAACI,CAAC,CAAC;MAAE;IAAE;IAC1F,SAASC,QAAQA,CAACR,KAAK,EAAE;MAAE,IAAI;QAAEK,IAAI,CAACP,SAAS,CAAC,OAAO,CAAC,CAACE,KAAK,CAAC,CAAC;MAAE,CAAC,CAAC,OAAOO,CAAC,EAAE;QAAEJ,MAAM,CAACI,CAAC,CAAC;MAAE;IAAE;IAC7F,SAASF,IAAIA,CAACI,MAAM,EAAE;MAAEA,MAAM,CAACC,IAAI,GAAGT,OAAO,CAACQ,MAAM,CAACT,KAAK,CAAC,GAAGD,KAAK,CAACU,MAAM,CAACT,KAAK,CAAC,CAACW,IAAI,CAACP,SAAS,EAAEI,QAAQ,CAAC;IAAE;IAC7GH,IAAI,CAAC,CAACP,SAAS,GAAGA,SAAS,CAACjC,KAAK,CAAC8B,OAAO,EAAEC,UAAU,IAAI,EAAE,CAAC,EAAEU,IAAI,CAAC,CAAC,CAAC;EACzE,CAAC,CAAC;AACN,CAAC;AACD,IAAIsI,aAAa,GAAI7L,SAAS,IAAIA,SAAS,CAAC8D,WAAW,IAAK,UAAUlB,OAAO,EAAEmB,IAAI,EAAE;EACjF,IAAIC,CAAC,GAAG;MAAEC,KAAK,EAAE,CAAC;MAAEC,IAAI,EAAE,SAAAA,CAAA,EAAW;QAAE,IAAI9D,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,MAAMA,CAAC,CAAC,CAAC,CAAC;QAAE,OAAOA,CAAC,CAAC,CAAC,CAAC;MAAE,CAAC;MAAE+D,IAAI,EAAE,EAAE;MAAEC,GAAG,EAAE;IAAG,CAAC;IAAEC,CAAC;IAAEC,CAAC;IAAElE,CAAC;IAAEmE,CAAC,GAAGrE,MAAM,CAACsE,MAAM,CAAC,CAAC,OAAOC,QAAQ,KAAK,UAAU,GAAGA,QAAQ,GAAGvE,MAAM,EAAES,SAAS,CAAC;EAChM,OAAO4D,CAAC,CAAChB,IAAI,GAAGmB,IAAI,CAAC,CAAC,CAAC,EAAEH,CAAC,CAAC,OAAO,CAAC,GAAGG,IAAI,CAAC,CAAC,CAAC,EAAEH,CAAC,CAAC,QAAQ,CAAC,GAAGG,IAAI,CAAC,CAAC,CAAC,EAAE,OAAOC,MAAM,KAAK,UAAU,KAAKJ,CAAC,CAACI,MAAM,CAACC,QAAQ,CAAC,GAAG,YAAW;IAAE,OAAO,IAAI;EAAE,CAAC,CAAC,EAAEL,CAAC;EAC3J,SAASG,IAAIA,CAACnE,CAAC,EAAE;IAAE,OAAO,UAAUsE,CAAC,EAAE;MAAE,OAAOvB,IAAI,CAAC,CAAC/C,CAAC,EAAEsE,CAAC,CAAC,CAAC;IAAE,CAAC;EAAE;EACjE,SAASvB,IAAIA,CAACwB,EAAE,EAAE;IACd,IAAIT,CAAC,EAAE,MAAM,IAAIU,SAAS,CAAC,iCAAiC,CAAC;IAC7D,OAAOR,CAAC,KAAKA,CAAC,GAAG,CAAC,EAAEO,EAAE,CAAC,CAAC,CAAC,KAAKd,CAAC,GAAG,CAAC,CAAC,CAAC,EAAEA,CAAC,EAAE,IAAI;MAC1C,IAAIK,CAAC,GAAG,CAAC,EAAEC,CAAC,KAAKlE,CAAC,GAAG0E,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,GAAGR,CAAC,CAAC,QAAQ,CAAC,GAAGQ,EAAE,CAAC,CAAC,CAAC,GAAGR,CAAC,CAAC,OAAO,CAAC,KAAK,CAAClE,CAAC,GAAGkE,CAAC,CAAC,QAAQ,CAAC,KAAKlE,CAAC,CAACS,IAAI,CAACyD,CAAC,CAAC,EAAE,CAAC,CAAC,GAAGA,CAAC,CAACf,IAAI,CAAC,IAAI,CAAC,CAACnD,CAAC,GAAGA,CAAC,CAACS,IAAI,CAACyD,CAAC,EAAEQ,EAAE,CAAC,CAAC,CAAC,CAAC,EAAEnB,IAAI,EAAE,OAAOvD,CAAC;MAC5J,IAAIkE,CAAC,GAAG,CAAC,EAAElE,CAAC,EAAE0E,EAAE,GAAG,CAACA,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE1E,CAAC,CAAC6C,KAAK,CAAC;MACvC,QAAQ6B,EAAE,CAAC,CAAC,CAAC;QACT,KAAK,CAAC;QAAE,KAAK,CAAC;UAAE1E,CAAC,GAAG0E,EAAE;UAAE;QACxB,KAAK,CAAC;UAAEd,CAAC,CAACC,KAAK,EAAE;UAAE,OAAO;YAAEhB,KAAK,EAAE6B,EAAE,CAAC,CAAC,CAAC;YAAEnB,IAAI,EAAE;UAAM,CAAC;QACvD,KAAK,CAAC;UAAEK,CAAC,CAACC,KAAK,EAAE;UAAEK,CAAC,GAAGQ,EAAE,CAAC,CAAC,CAAC;UAAEA,EAAE,GAAG,CAAC,CAAC,CAAC;UAAE;QACxC,KAAK,CAAC;UAAEA,EAAE,GAAGd,CAAC,CAACI,GAAG,CAACY,GAAG,CAAC,CAAC;UAAEhB,CAAC,CAACG,IAAI,CAACa,GAAG,CAAC,CAAC;UAAE;QACxC;UACI,IAAI,EAAE5E,CAAC,GAAG4D,CAAC,CAACG,IAAI,EAAE/D,CAAC,GAAGA,CAAC,CAACK,MAAM,GAAG,CAAC,IAAIL,CAAC,CAACA,CAAC,CAACK,MAAM,GAAG,CAAC,CAAC,CAAC,KAAKqE,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,IAAIA,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE;YAAEd,CAAC,GAAG,CAAC;YAAE;UAAU;UAC3G,IAAIc,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC1E,CAAC,IAAK0E,EAAE,CAAC,CAAC,CAAC,GAAG1E,CAAC,CAAC,CAAC,CAAC,IAAI0E,EAAE,CAAC,CAAC,CAAC,GAAG1E,CAAC,CAAC,CAAC,CAAE,CAAC,EAAE;YAAE4D,CAAC,CAACC,KAAK,GAAGa,EAAE,CAAC,CAAC,CAAC;YAAE;UAAO;UACrF,IAAIA,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,IAAId,CAAC,CAACC,KAAK,GAAG7D,CAAC,CAAC,CAAC,CAAC,EAAE;YAAE4D,CAAC,CAACC,KAAK,GAAG7D,CAAC,CAAC,CAAC,CAAC;YAAEA,CAAC,GAAG0E,EAAE;YAAE;UAAO;UACpE,IAAI1E,CAAC,IAAI4D,CAAC,CAACC,KAAK,GAAG7D,CAAC,CAAC,CAAC,CAAC,EAAE;YAAE4D,CAAC,CAACC,KAAK,GAAG7D,CAAC,CAAC,CAAC,CAAC;YAAE4D,CAAC,CAACI,GAAG,CAACa,IAAI,CAACH,EAAE,CAAC;YAAE;UAAO;UAClE,IAAI1E,CAAC,CAAC,CAAC,CAAC,EAAE4D,CAAC,CAACI,GAAG,CAACY,GAAG,CAAC,CAAC;UACrBhB,CAAC,CAACG,IAAI,CAACa,GAAG,CAAC,CAAC;UAAE;MACtB;MACAF,EAAE,GAAGf,IAAI,CAAClD,IAAI,CAAC+B,OAAO,EAAEoB,CAAC,CAAC;IAC9B,CAAC,CAAC,OAAOR,CAAC,EAAE;MAAEsB,EAAE,GAAG,CAAC,CAAC,EAAEtB,CAAC,CAAC;MAAEc,CAAC,GAAG,CAAC;IAAE,CAAC,SAAS;MAAED,CAAC,GAAGjE,CAAC,GAAG,CAAC;IAAE;IACzD,IAAI0E,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,MAAMA,EAAE,CAAC,CAAC,CAAC;IAAE,OAAO;MAAE7B,KAAK,EAAE6B,EAAE,CAAC,CAAC,CAAC,GAAGA,EAAE,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC;MAAEnB,IAAI,EAAE;IAAK,CAAC;EACpF;AACJ,CAAC;AACD,IAAImI,MAAM,GAAI9L,SAAS,IAAIA,SAAS,CAAC8L,MAAM,IAAK,UAAUzL,CAAC,EAAEmD,CAAC,EAAE;EAC5D,IAAIpD,CAAC,GAAG,CAAC,CAAC;EACV,KAAK,IAAIM,CAAC,IAAIL,CAAC,EAAE,IAAIH,MAAM,CAACS,SAAS,CAACC,cAAc,CAACC,IAAI,CAACR,CAAC,EAAEK,CAAC,CAAC,IAAI8C,CAAC,CAACgH,OAAO,CAAC9J,CAAC,CAAC,GAAG,CAAC,EAC/EN,CAAC,CAACM,CAAC,CAAC,GAAGL,CAAC,CAACK,CAAC,CAAC;EACf,IAAIL,CAAC,IAAI,IAAI,IAAI,OAAOH,MAAM,CAAC6L,qBAAqB,KAAK,UAAU,EAC/D,KAAK,IAAIzL,CAAC,GAAG,CAAC,EAAEI,CAAC,GAAGR,MAAM,CAAC6L,qBAAqB,CAAC1L,CAAC,CAAC,EAAEC,CAAC,GAAGI,CAAC,CAACD,MAAM,EAAEH,CAAC,EAAE,EAAE;IACpE,IAAIkD,CAAC,CAACgH,OAAO,CAAC9J,CAAC,CAACJ,CAAC,CAAC,CAAC,GAAG,CAAC,IAAIJ,MAAM,CAACS,SAAS,CAACqL,oBAAoB,CAACnL,IAAI,CAACR,CAAC,EAAEK,CAAC,CAACJ,CAAC,CAAC,CAAC,EAC1EF,CAAC,CAACM,CAAC,CAACJ,CAAC,CAAC,CAAC,GAAGD,CAAC,CAACK,CAAC,CAACJ,CAAC,CAAC,CAAC;EACzB;EACJ,OAAOF,CAAC;AACZ,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA,SAAS6L,mBAAmBA,CAAC3G,SAAS,EAAE;EACpC,OAAQ,OAAOA,SAAS,CAAC4G,gBAAgB,CAAC3E,MAAM,KAAK,QAAQ,IACzD,OAAOjC,SAAS,CAAC4G,gBAAgB,CAACtB,WAAW,KAAK,QAAQ,IAC1D,OAAOtF,SAAS,CAAC4G,gBAAgB,CAACrB,SAAS,KAAK,QAAQ,IACxD,OAAOvF,SAAS,CAAC4G,gBAAgB,CAAC3G,MAAM,KAAK,QAAQ,IACrD,OAAOD,SAAS,CAAC4G,gBAAgB,CAACpB,KAAK,KAAK,QAAQ,IACpD,OAAOxF,SAAS,CAAC4G,gBAAgB,CAACnB,QAAQ,KAAK,QAAQ,IACvD,OAAOzF,SAAS,CAAC4G,gBAAgB,CAAClB,cAAc,KAAK,QAAQ,IAC7D,OAAO1F,SAAS,CAAC4G,gBAAgB,CAACjB,OAAO,KAAK,QAAQ;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASkB,6BAA6BA,CAACC,OAAO,EAAE;EAC5C,IAAI3G,EAAE,EAAEI,EAAE,EAAEqC,EAAE,EAAEmE,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE;EACtC,IAAIN,OAAO,KAAK,KAAK,CAAC,EAAE;IAAEA,OAAO,GAAG,CAAC,CAAC;EAAE;EACxC,IAAIO,QAAQ,GAAGP,OAAO,CAACO,QAAQ;IAAEC,EAAE,GAAGR,OAAO,CAACS,iBAAiB;IAAEA,iBAAiB,GAAGD,EAAE,KAAK,KAAK,CAAC,GAAG,IAAI,GAAGA,EAAE;IAAEV,gBAAgB,GAAGE,OAAO,CAACF,gBAAgB;EAC3J;EACA;EACA,IAAIY,EAAE,GAAGzC,0BAA0B,CAAC,CAAC;EAAEyC,EAAE,CAAC1C,QAAQ;EAAE0C,EAAE,CAAC/C,SAAS;EAAE,IAAIgD,mBAAmB,GAAGjB,MAAM,CAACgB,EAAE,EAAE,CAAC,UAAU,EAAE,WAAW,CAAC,CAAC;EACjI,IAAIE,UAAU,GAAG9M,MAAM,CAACsG,OAAO,CAACvG,QAAQ,CAACA,QAAQ,CAAC,CAAC,CAAC,EAAE8M,mBAAmB,CAAC,EAAE;IAAEjC,KAAK,EAAE,CAACrF,EAAE,GAAGyG,gBAAgB,KAAK,IAAI,IAAIA,gBAAgB,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,gBAAgB,CAACpB,KAAK,MAAM,IAAI,IAAIrF,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG,kCAAkC;IAAEwH,cAAc,EAAE,CAACpH,EAAE,GAAGqG,gBAAgB,KAAK,IAAI,IAAIA,gBAAgB,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,gBAAgB,CAAC3E,MAAM,MAAM,IAAI,IAAI1B,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG,iBAAiB;IAAEqH,mBAAmB,EAAE,CAAChF,EAAE,GAAGgE,gBAAgB,KAAK,IAAI,IAAIA,gBAAgB,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,gBAAgB,CAACtB,WAAW,MAAM,IAAI,IAAI1C,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG,sBAAsB;IAAEiF,iBAAiB,EAAE,CAACd,EAAE,GAAGH,gBAAgB,KAAK,IAAI,IAAIA,gBAAgB,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,gBAAgB,CAACrB,SAAS,MAAM,IAAI,IAAIwB,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG,oBAAoB;IAAEe,cAAc,EAAE,CAACd,EAAE,GAAGJ,gBAAgB,KAAK,IAAI,IAAIA,gBAAgB,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,gBAAgB,CAAC3G,MAAM,MAAM,IAAI,IAAI+G,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG,iBAAiB;IAAEe,gBAAgB,EAAE,CAACd,EAAE,GAAGL,gBAAgB,KAAK,IAAI,IAAIA,gBAAgB,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,gBAAgB,CAACnB,QAAQ,MAAM,IAAI,IAAIwB,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG,+BAA+B;IAAEe,sBAAsB,EAAE,CAACd,EAAE,GAAGN,gBAAgB,KAAK,IAAI,IAAIA,gBAAgB,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,gBAAgB,CAAClB,cAAc,MAAM,IAAI,IAAIwB,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG,qCAAqC;IAAEe,gBAAgB,EAAE,CAACd,EAAE,GAAGP,gBAAgB,KAAK,IAAI,IAAIA,gBAAgB,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,gBAAgB,CAAChB,QAAQ,MAAM,IAAI,IAAIuB,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG,sCAAsC;IAAEe,eAAe,EAAE,CAACd,EAAE,GAAGR,gBAAgB,KAAK,IAAI,IAAIA,gBAAgB,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,gBAAgB,CAACjB,OAAO,MAAM,IAAI,IAAIyB,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG;EAAsC,CAAC,CAAC,CAAC,CAC9qDrO,GAAG,CAAC,UAAUoH,EAAE,EAAE;IACnB,IAAIiB,CAAC,GAAGjB,EAAE,CAAC,CAAC,CAAC;MAAEZ,CAAC,GAAGY,EAAE,CAAC,CAAC,CAAC;IACxB,OAAO,EAAE,CAAC/G,MAAM,CAACgI,CAAC,EAAE,GAAG,CAAC,CAAChI,MAAM,CAACmG,CAAC,CAAC;EACtC,CAAC,CAAC,CACG4I,IAAI,CAAC,GAAG,CAAC;EACd,IAAI7H,GAAG,GAAG,IAAIsE,GAAG,CAACP,MAAM,CAACC,QAAQ,CAAC8D,IAAI,CAAC;EACvC,IAAIf,QAAQ,EAAE;IACV/G,GAAG,CAAC+H,QAAQ,GAAGhB,QAAQ;EAC3B,CAAC,MACI;IACD;IACA/G,GAAG,CAAC+H,QAAQ,GAAG/H,GAAG,CAAC+H,QAAQ,CAACrC,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC;EACpD;EACA1F,GAAG,CAACiE,MAAM,GAAG,EAAE;EACfjE,GAAG,CAAC0E,IAAI,GAAGuC,iBAAiB,GAAG,KAAK,CAACnO,MAAM,CAACsO,UAAU,CAAC,GAAG,EAAE;EAC5D,OAAOpH,GAAG,CAACgI,QAAQ,CAAC,CAAC;AACzB;AACA,IAAIC,mBAAmB,GAAG,2BAA2B;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASC,wBAAwBA,CAAC1I,WAAW,EAAE;EAC3C,OAAOwG,WAAW,CAAC,IAAI,EAAEpL,SAAS,EAAE,KAAK,CAAC,EAAE,UAAU8E,SAAS,EAAEyI,YAAY,EAAE;IAC3E,IAAIC,UAAU,EAAEpI,GAAG,EAAEqI,IAAI,EAAEtM,IAAI,EAAEuM,IAAI;IACrC,IAAIH,YAAY,KAAK,KAAK,CAAC,EAAE;MAAEA,YAAY,GAAG,CAAC,CAAC;IAAE;IAClD,OAAOlC,aAAa,CAAC,IAAI,EAAE,UAAUpG,EAAE,EAAE;MACrC,QAAQA,EAAE,CAACxB,KAAK;QACZ,KAAK,CAAC;UAAE,OAAO,CAAC,CAAC,CAAC,WAAWqB,SAAS,CAAC6I,mBAAmB,CAAC,CACnD3Q,qBAAqB,CAAC4Q,aAAa,CAAC3Q,cAAc,CAAC4Q,IAAI,EAAER,mBAAmB,EAAEvI,SAAS,CAAC8E,QAAQ,CAAC,EACjG5M,qBAAqB,CAAC4Q,aAAa,CAAC3Q,cAAc,CAAC6Q,OAAO,EAAET,mBAAmB,EAAEvI,SAAS,CAAC8E,QAAQ,CAAC,CACvG,CAAC,CAAC;QACP,KAAK,CAAC;UACF3E,EAAE,CAACvB,IAAI,CAAC,CAAC;UACT,OAAO,CAAC,CAAC,CAAC,WAAWoB,SAAS,CAACiJ,uBAAuB,CAACV,mBAAmB,EAAEvI,SAAS,CAAC8E,QAAQ,CAAC,CAAC;QACpG,KAAK,CAAC;UACF4D,UAAU,GAAGvI,EAAE,CAACvB,IAAI,CAAC,CAAC;UACtB,IAAI,CAAC8J,UAAU,EAAE;YACb,MAAM,IAAIhE,KAAK,CAAC,uEAAuE,CAAC;UAC5F;UACApE,GAAG,GAAGuG,6BAA6B,CAAC,CAAC;UACrC8B,IAAI,GAAGF,YAAY,CAACE,IAAI,KACnB,CAACD,UAAU,CAAC1O,OAAO,CAAC2O,IAAI,IACrBD,UAAU,CAAC1O,OAAO,CAAC2O,IAAI,KAAK,eAAe,IAC3CD,UAAU,CAAC1O,OAAO,CAAC2O,IAAI,KAAK,QAAQ,CAAC,GACvCF,YAAY,CAACE,IAAI,GACjBD,UAAU,CAAC1O,OAAO,CAAC2O,IAAI;UAC7BtM,IAAI,GAAGoM,YAAY,CAACpM,IAAI,KACnB,CAACqM,UAAU,CAAC1O,OAAO,CAACqC,IAAI,IAAIqM,UAAU,CAAC1O,OAAO,CAACqC,IAAI,KAAK,UAAU,CAAC,GAClEoM,YAAY,CAACpM,IAAI,GACjBqM,UAAU,CAAC1O,OAAO,CAACqC,IAAI;UAC7BuM,IAAI,GAAGH,YAAY,CAACG,IAAI,GAClBjO,QAAQ,CAACA,QAAQ,CAAC,CAAC,CAAC,EAAE+N,UAAU,CAAC1O,OAAO,CAAC4O,IAAI,CAAC,EAAEH,YAAY,CAACG,IAAI,CAAC,GAAGF,UAAU,CAAC1O,OAAO,CAAC4O,IAAI;UAClG;UACA;UACA;UACA;UACA,OAAO,CAAC,CAAC,CAAC,WAAW/K,OAAO,CAACqL,IAAI,CAAC,CAC1BlJ,SAAS,CAACmJ,cAAc,CAACZ,mBAAmB,EAAE5N,QAAQ,CAACA,QAAQ,CAAC,CAAC,CAAC,EAAE+N,UAAU,CAAC1O,OAAO,CAAC,EAAE;YAAEsG,GAAG,EAAEA,GAAG,CAACgI,QAAQ,CAAC,CAAC;YAAEK,IAAI,EAAEA,IAAI;YAAEtM,IAAI,EAAEA,IAAI;YAAEuM,IAAI,EAAEA;UAAK,CAAC,CAAC,EAAE;YAAEQ,QAAQ,EAAEpJ,SAAS,CAAC8E;UAAS,CAAC,CAAC,EACxL,IAAIjH,OAAO,CAAC,UAAUD,OAAO,EAAE;YAAE,OAAOyL,UAAU,CAACzL,OAAO,EAAE,IAAI,CAAC;UAAE,CAAC,CAAC,CACxE,CAAC,CAAC;QACX,KAAK,CAAC;UACF;UACA;UACA;UACA;UACAuC,EAAE,CAACvB,IAAI,CAAC,CAAC;UACT,OAAO,CAAC,CAAC,CAAC,WAAW;MAC7B;IACJ,CAAC,CAAC;EACN,CAAC,CAAC;AACN;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI0K,eAAe;AACnB,CAAC,UAAUA,eAAe,EAAE;EACxBA,eAAe,CAAC,QAAQ,CAAC,GAAG,QAAQ;EACpCA,eAAe,CAAC,aAAa,CAAC,GAAG,aAAa;EAC9CA,eAAe,CAAC,WAAW,CAAC,GAAG,WAAW;EAC1CA,eAAe,CAAC,QAAQ,CAAC,GAAG,QAAQ;EACpCA,eAAe,CAAC,OAAO,CAAC,GAAG,OAAO;EAClCA,eAAe,CAAC,UAAU,CAAC,GAAG,UAAU;EACxCA,eAAe,CAAC,gBAAgB,CAAC,GAAG,gBAAgB;EACpDA,eAAe,CAAC,UAAU,CAAC,GAAG,UAAU;EACxCA,eAAe,CAAC,SAAS,CAAC,GAAG,SAAS;AAC1C,CAAC,EAAEA,eAAe,KAAKA,eAAe,GAAG,CAAC,CAAC,CAAC,CAAC;;AAE7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAIC,WAAW,GAAI7O,SAAS,IAAIA,SAAS,CAAC2C,SAAS,IAAK,UAAUC,OAAO,EAAEC,UAAU,EAAEC,CAAC,EAAEC,SAAS,EAAE;EACjG,SAASC,KAAKA,CAACC,KAAK,EAAE;IAAE,OAAOA,KAAK,YAAYH,CAAC,GAAGG,KAAK,GAAG,IAAIH,CAAC,CAAC,UAAUI,OAAO,EAAE;MAAEA,OAAO,CAACD,KAAK,CAAC;IAAE,CAAC,CAAC;EAAE;EAC3G,OAAO,KAAKH,CAAC,KAAKA,CAAC,GAAGK,OAAO,CAAC,EAAE,UAAUD,OAAO,EAAEE,MAAM,EAAE;IACvD,SAASC,SAASA,CAACJ,KAAK,EAAE;MAAE,IAAI;QAAEK,IAAI,CAACP,SAAS,CAACQ,IAAI,CAACN,KAAK,CAAC,CAAC;MAAE,CAAC,CAAC,OAAOO,CAAC,EAAE;QAAEJ,MAAM,CAACI,CAAC,CAAC;MAAE;IAAE;IAC1F,SAASC,QAAQA,CAACR,KAAK,EAAE;MAAE,IAAI;QAAEK,IAAI,CAACP,SAAS,CAAC,OAAO,CAAC,CAACE,KAAK,CAAC,CAAC;MAAE,CAAC,CAAC,OAAOO,CAAC,EAAE;QAAEJ,MAAM,CAACI,CAAC,CAAC;MAAE;IAAE;IAC7F,SAASF,IAAIA,CAACI,MAAM,EAAE;MAAEA,MAAM,CAACC,IAAI,GAAGT,OAAO,CAACQ,MAAM,CAACT,KAAK,CAAC,GAAGD,KAAK,CAACU,MAAM,CAACT,KAAK,CAAC,CAACW,IAAI,CAACP,SAAS,EAAEI,QAAQ,CAAC;IAAE;IAC7GH,IAAI,CAAC,CAACP,SAAS,GAAGA,SAAS,CAACjC,KAAK,CAAC8B,OAAO,EAAEC,UAAU,IAAI,EAAE,CAAC,EAAEU,IAAI,CAAC,CAAC,CAAC;EACzE,CAAC,CAAC;AACN,CAAC;AACD,IAAIuL,aAAa,GAAI9O,SAAS,IAAIA,SAAS,CAAC8D,WAAW,IAAK,UAAUlB,OAAO,EAAEmB,IAAI,EAAE;EACjF,IAAIC,CAAC,GAAG;MAAEC,KAAK,EAAE,CAAC;MAAEC,IAAI,EAAE,SAAAA,CAAA,EAAW;QAAE,IAAI9D,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,MAAMA,CAAC,CAAC,CAAC,CAAC;QAAE,OAAOA,CAAC,CAAC,CAAC,CAAC;MAAE,CAAC;MAAE+D,IAAI,EAAE,EAAE;MAAEC,GAAG,EAAE;IAAG,CAAC;IAAEC,CAAC;IAAEC,CAAC;IAAElE,CAAC;IAAEmE,CAAC,GAAGrE,MAAM,CAACsE,MAAM,CAAC,CAAC,OAAOC,QAAQ,KAAK,UAAU,GAAGA,QAAQ,GAAGvE,MAAM,EAAES,SAAS,CAAC;EAChM,OAAO4D,CAAC,CAAChB,IAAI,GAAGmB,IAAI,CAAC,CAAC,CAAC,EAAEH,CAAC,CAAC,OAAO,CAAC,GAAGG,IAAI,CAAC,CAAC,CAAC,EAAEH,CAAC,CAAC,QAAQ,CAAC,GAAGG,IAAI,CAAC,CAAC,CAAC,EAAE,OAAOC,MAAM,KAAK,UAAU,KAAKJ,CAAC,CAACI,MAAM,CAACC,QAAQ,CAAC,GAAG,YAAW;IAAE,OAAO,IAAI;EAAE,CAAC,CAAC,EAAEL,CAAC;EAC3J,SAASG,IAAIA,CAACnE,CAAC,EAAE;IAAE,OAAO,UAAUsE,CAAC,EAAE;MAAE,OAAOvB,IAAI,CAAC,CAAC/C,CAAC,EAAEsE,CAAC,CAAC,CAAC;IAAE,CAAC;EAAE;EACjE,SAASvB,IAAIA,CAACwB,EAAE,EAAE;IACd,IAAIT,CAAC,EAAE,MAAM,IAAIU,SAAS,CAAC,iCAAiC,CAAC;IAC7D,OAAOR,CAAC,KAAKA,CAAC,GAAG,CAAC,EAAEO,EAAE,CAAC,CAAC,CAAC,KAAKd,CAAC,GAAG,CAAC,CAAC,CAAC,EAAEA,CAAC,EAAE,IAAI;MAC1C,IAAIK,CAAC,GAAG,CAAC,EAAEC,CAAC,KAAKlE,CAAC,GAAG0E,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,GAAGR,CAAC,CAAC,QAAQ,CAAC,GAAGQ,EAAE,CAAC,CAAC,CAAC,GAAGR,CAAC,CAAC,OAAO,CAAC,KAAK,CAAClE,CAAC,GAAGkE,CAAC,CAAC,QAAQ,CAAC,KAAKlE,CAAC,CAACS,IAAI,CAACyD,CAAC,CAAC,EAAE,CAAC,CAAC,GAAGA,CAAC,CAACf,IAAI,CAAC,IAAI,CAAC,CAACnD,CAAC,GAAGA,CAAC,CAACS,IAAI,CAACyD,CAAC,EAAEQ,EAAE,CAAC,CAAC,CAAC,CAAC,EAAEnB,IAAI,EAAE,OAAOvD,CAAC;MAC5J,IAAIkE,CAAC,GAAG,CAAC,EAAElE,CAAC,EAAE0E,EAAE,GAAG,CAACA,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE1E,CAAC,CAAC6C,KAAK,CAAC;MACvC,QAAQ6B,EAAE,CAAC,CAAC,CAAC;QACT,KAAK,CAAC;QAAE,KAAK,CAAC;UAAE1E,CAAC,GAAG0E,EAAE;UAAE;QACxB,KAAK,CAAC;UAAEd,CAAC,CAACC,KAAK,EAAE;UAAE,OAAO;YAAEhB,KAAK,EAAE6B,EAAE,CAAC,CAAC,CAAC;YAAEnB,IAAI,EAAE;UAAM,CAAC;QACvD,KAAK,CAAC;UAAEK,CAAC,CAACC,KAAK,EAAE;UAAEK,CAAC,GAAGQ,EAAE,CAAC,CAAC,CAAC;UAAEA,EAAE,GAAG,CAAC,CAAC,CAAC;UAAE;QACxC,KAAK,CAAC;UAAEA,EAAE,GAAGd,CAAC,CAACI,GAAG,CAACY,GAAG,CAAC,CAAC;UAAEhB,CAAC,CAACG,IAAI,CAACa,GAAG,CAAC,CAAC;UAAE;QACxC;UACI,IAAI,EAAE5E,CAAC,GAAG4D,CAAC,CAACG,IAAI,EAAE/D,CAAC,GAAGA,CAAC,CAACK,MAAM,GAAG,CAAC,IAAIL,CAAC,CAACA,CAAC,CAACK,MAAM,GAAG,CAAC,CAAC,CAAC,KAAKqE,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,IAAIA,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE;YAAEd,CAAC,GAAG,CAAC;YAAE;UAAU;UAC3G,IAAIc,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC1E,CAAC,IAAK0E,EAAE,CAAC,CAAC,CAAC,GAAG1E,CAAC,CAAC,CAAC,CAAC,IAAI0E,EAAE,CAAC,CAAC,CAAC,GAAG1E,CAAC,CAAC,CAAC,CAAE,CAAC,EAAE;YAAE4D,CAAC,CAACC,KAAK,GAAGa,EAAE,CAAC,CAAC,CAAC;YAAE;UAAO;UACrF,IAAIA,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,IAAId,CAAC,CAACC,KAAK,GAAG7D,CAAC,CAAC,CAAC,CAAC,EAAE;YAAE4D,CAAC,CAACC,KAAK,GAAG7D,CAAC,CAAC,CAAC,CAAC;YAAEA,CAAC,GAAG0E,EAAE;YAAE;UAAO;UACpE,IAAI1E,CAAC,IAAI4D,CAAC,CAACC,KAAK,GAAG7D,CAAC,CAAC,CAAC,CAAC,EAAE;YAAE4D,CAAC,CAACC,KAAK,GAAG7D,CAAC,CAAC,CAAC,CAAC;YAAE4D,CAAC,CAACI,GAAG,CAACa,IAAI,CAACH,EAAE,CAAC;YAAE;UAAO;UAClE,IAAI1E,CAAC,CAAC,CAAC,CAAC,EAAE4D,CAAC,CAACI,GAAG,CAACY,GAAG,CAAC,CAAC;UACrBhB,CAAC,CAACG,IAAI,CAACa,GAAG,CAAC,CAAC;UAAE;MACtB;MACAF,EAAE,GAAGf,IAAI,CAAClD,IAAI,CAAC+B,OAAO,EAAEoB,CAAC,CAAC;IAC9B,CAAC,CAAC,OAAOR,CAAC,EAAE;MAAEsB,EAAE,GAAG,CAAC,CAAC,EAAEtB,CAAC,CAAC;MAAEc,CAAC,GAAG,CAAC;IAAE,CAAC,SAAS;MAAED,CAAC,GAAGjE,CAAC,GAAG,CAAC;IAAE;IACzD,IAAI0E,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,MAAMA,EAAE,CAAC,CAAC,CAAC;IAAE,OAAO;MAAE7B,KAAK,EAAE6B,EAAE,CAAC,CAAC,CAAC,GAAGA,EAAE,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC;MAAEnB,IAAI,EAAE;IAAK,CAAC;EACpF;AACJ,CAAC;AACD,SAASoL,wBAAwBA,CAACC,eAAe,EAAE;EAC/C,OAAOA,eAAe,CAAC3Q,GAAG,CAAC,UAAU4Q,CAAC,EAAE;IAAE,OAAQ,OAAOA,CAAC,KAAK,QAAQ,GAAGA,CAAC,GAAGA,CAAC,CAACC,GAAG;EAAG,CAAC,CAAC;AAC5F;AACA,SAASC,SAASA,CAACC,GAAG,EAAE;EACpB,OAAOA,GAAG,KAAK,IAAI,IAAIA,GAAG,KAAKpP,SAAS;AAC5C;AACA,SAASqP,MAAMA,CAACC,KAAK,EAAE;EACnB,OAAOtQ,KAAK,CAACR,IAAI,CAAC,IAAI+Q,GAAG,CAACD,KAAK,CAAC,CAAC;AACrC;AACA,SAASE,WAAWA,CAACC,EAAE,EAAEC,EAAE,EAAE;EACzB,IAAIhM,MAAM,GAAG,IAAI6L,GAAG,CAACE,EAAE,CAAC;EACxBC,EAAE,CAACC,OAAO,CAAC,UAAU9K,CAAC,EAAE;IAAE,OAAOnB,MAAM,CAACkM,MAAM,CAAC/K,CAAC,CAAC;EAAE,CAAC,CAAC;EACrD,OAAOnB,MAAM;AACjB;AACA,SAASmM,QAAQA,CAACC,WAAW,EAAEC,aAAa,EAAEjR,OAAO,EAAE;EACnD,IAAI,CAACA,OAAO,EAAE;IACV,OAAOgR,WAAW,CAAClQ,OAAO,KAAKmQ,aAAa;EAChD;EACA,IAAI,OAAOjR,OAAO,KAAK,QAAQ,EAAE;IAC7B,IAAIA,OAAO,KAAKvB,OAAO,CAACwB,OAAO,EAAE;MAC7B,MAAMiL,KAAK,CAAC,0BAA0B,CAACtL,MAAM,CAACI,OAAO,CAAC,CAAC;IAC3D;IACA,OAAO,IAAI;EACf;EACA,OAAOA,OAAO,CAACe,QAAQ,CAACiQ,WAAW,CAAClQ,OAAO,CAAC;AAChD;AACA;AACA;AACA;AACA;AACA;AACA,SAASoQ,iCAAiCA,CAACrO,IAAI,EAAE+M,QAAQ,EAAEpP,OAAO,EAAEwC,MAAM,EAAEmO,UAAU,EAAE;EACpF,IAAIA,UAAU,CAAC/N,QAAQ,KAAKlC,SAAS,EAAE;IACnC,MAAM,IAAIgK,KAAK,CAAC,6CAA6C,CAAC;EAClE;EACA,OAAO;IACH1K,OAAO,EAAEA,OAAO;IAChB4C,QAAQ,EAAE+N,UAAU,CAAC/N,QAAQ;IAC7BC,gBAAgB,EAAE+N,IAAI,CAACC,GAAG,CAAC,CAAC;IAC5BvQ,OAAO,EAAEqQ,UAAU,CAACrQ,OAAO;IAC3BkC,MAAM,EAAEA,MAAM;IACdtC,SAAS,EAAEkP,QAAQ;IACnB/M,IAAI,EAAEA;EACV,CAAC;AACL;AACA;AACA;AACA;AACA;AACA;AACA,SAASyO,6BAA6BA,CAAC9K,SAAS,EAAE3D,IAAI,EAAE+M,QAAQ,EAAEpP,OAAO,EAAE;EACvE,OAAOuP,WAAW,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;IACjD,IAAIwB,QAAQ;IACZ,OAAOvB,aAAa,CAAC,IAAI,EAAE,UAAUrJ,EAAE,EAAE;MACrC,QAAQA,EAAE,CAACxB,KAAK;QACZ,KAAK,CAAC;UACF,IAAIqB,SAAS,CAAC4G,gBAAgB,CAAC3E,MAAM,KAAKvH,SAAS,EAAE;YACjD,MAAM,IAAIgK,KAAK,CAAC,0BAA0B,CAAC;UAC/C;UACA,OAAO,CAAC,CAAC,CAAC,WAAW1E,SAAS,CAACmJ,cAAc,CAAC9M,IAAI,EAAErC,OAAO,EAAE;YAAEoP,QAAQ,EAAEA;UAAS,CAAC,CAAC,CAAC;QACzF,KAAK,CAAC;UACF2B,QAAQ,GAAG5K,EAAE,CAACvB,IAAI,CAAC,CAAC;UACpB,OAAO,CAAC,CAAC,CAAC,YAAY8L,iCAAiC,CAACrO,IAAI,EAAE+M,QAAQ,EAAEpP,OAAO,EAAEgG,SAAS,CAAC4G,gBAAgB,CAAC3E,MAAM,EAAE8I,QAAQ,CAAC,CAAC;MACtI;IACJ,CAAC,CAAC;EACN,CAAC,CAAC;AACN;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI1N,SAAS,GAAI3C,SAAS,IAAIA,SAAS,CAAC2C,SAAS,IAAK,UAAUC,OAAO,EAAEC,UAAU,EAAEC,CAAC,EAAEC,SAAS,EAAE;EAC/F,SAASC,KAAKA,CAACC,KAAK,EAAE;IAAE,OAAOA,KAAK,YAAYH,CAAC,GAAGG,KAAK,GAAG,IAAIH,CAAC,CAAC,UAAUI,OAAO,EAAE;MAAEA,OAAO,CAACD,KAAK,CAAC;IAAE,CAAC,CAAC;EAAE;EAC3G,OAAO,KAAKH,CAAC,KAAKA,CAAC,GAAGK,OAAO,CAAC,EAAE,UAAUD,OAAO,EAAEE,MAAM,EAAE;IACvD,SAASC,SAASA,CAACJ,KAAK,EAAE;MAAE,IAAI;QAAEK,IAAI,CAACP,SAAS,CAACQ,IAAI,CAACN,KAAK,CAAC,CAAC;MAAE,CAAC,CAAC,OAAOO,CAAC,EAAE;QAAEJ,MAAM,CAACI,CAAC,CAAC;MAAE;IAAE;IAC1F,SAASC,QAAQA,CAACR,KAAK,EAAE;MAAE,IAAI;QAAEK,IAAI,CAACP,SAAS,CAAC,OAAO,CAAC,CAACE,KAAK,CAAC,CAAC;MAAE,CAAC,CAAC,OAAOO,CAAC,EAAE;QAAEJ,MAAM,CAACI,CAAC,CAAC;MAAE;IAAE;IAC7F,SAASF,IAAIA,CAACI,MAAM,EAAE;MAAEA,MAAM,CAACC,IAAI,GAAGT,OAAO,CAACQ,MAAM,CAACT,KAAK,CAAC,GAAGD,KAAK,CAACU,MAAM,CAACT,KAAK,CAAC,CAACW,IAAI,CAACP,SAAS,EAAEI,QAAQ,CAAC;IAAE;IAC7GH,IAAI,CAAC,CAACP,SAAS,GAAGA,SAAS,CAACjC,KAAK,CAAC8B,OAAO,EAAEC,UAAU,IAAI,EAAE,CAAC,EAAEU,IAAI,CAAC,CAAC,CAAC;EACzE,CAAC,CAAC;AACN,CAAC;AACD,IAAIO,WAAW,GAAI9D,SAAS,IAAIA,SAAS,CAAC8D,WAAW,IAAK,UAAUlB,OAAO,EAAEmB,IAAI,EAAE;EAC/E,IAAIC,CAAC,GAAG;MAAEC,KAAK,EAAE,CAAC;MAAEC,IAAI,EAAE,SAAAA,CAAA,EAAW;QAAE,IAAI9D,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,MAAMA,CAAC,CAAC,CAAC,CAAC;QAAE,OAAOA,CAAC,CAAC,CAAC,CAAC;MAAE,CAAC;MAAE+D,IAAI,EAAE,EAAE;MAAEC,GAAG,EAAE;IAAG,CAAC;IAAEC,CAAC;IAAEC,CAAC;IAAElE,CAAC;IAAEmE,CAAC,GAAGrE,MAAM,CAACsE,MAAM,CAAC,CAAC,OAAOC,QAAQ,KAAK,UAAU,GAAGA,QAAQ,GAAGvE,MAAM,EAAES,SAAS,CAAC;EAChM,OAAO4D,CAAC,CAAChB,IAAI,GAAGmB,IAAI,CAAC,CAAC,CAAC,EAAEH,CAAC,CAAC,OAAO,CAAC,GAAGG,IAAI,CAAC,CAAC,CAAC,EAAEH,CAAC,CAAC,QAAQ,CAAC,GAAGG,IAAI,CAAC,CAAC,CAAC,EAAE,OAAOC,MAAM,KAAK,UAAU,KAAKJ,CAAC,CAACI,MAAM,CAACC,QAAQ,CAAC,GAAG,YAAW;IAAE,OAAO,IAAI;EAAE,CAAC,CAAC,EAAEL,CAAC;EAC3J,SAASG,IAAIA,CAACnE,CAAC,EAAE;IAAE,OAAO,UAAUsE,CAAC,EAAE;MAAE,OAAOvB,IAAI,CAAC,CAAC/C,CAAC,EAAEsE,CAAC,CAAC,CAAC;IAAE,CAAC;EAAE;EACjE,SAASvB,IAAIA,CAACwB,EAAE,EAAE;IACd,IAAIT,CAAC,EAAE,MAAM,IAAIU,SAAS,CAAC,iCAAiC,CAAC;IAC7D,OAAOR,CAAC,KAAKA,CAAC,GAAG,CAAC,EAAEO,EAAE,CAAC,CAAC,CAAC,KAAKd,CAAC,GAAG,CAAC,CAAC,CAAC,EAAEA,CAAC,EAAE,IAAI;MAC1C,IAAIK,CAAC,GAAG,CAAC,EAAEC,CAAC,KAAKlE,CAAC,GAAG0E,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,GAAGR,CAAC,CAAC,QAAQ,CAAC,GAAGQ,EAAE,CAAC,CAAC,CAAC,GAAGR,CAAC,CAAC,OAAO,CAAC,KAAK,CAAClE,CAAC,GAAGkE,CAAC,CAAC,QAAQ,CAAC,KAAKlE,CAAC,CAACS,IAAI,CAACyD,CAAC,CAAC,EAAE,CAAC,CAAC,GAAGA,CAAC,CAACf,IAAI,CAAC,IAAI,CAAC,CAACnD,CAAC,GAAGA,CAAC,CAACS,IAAI,CAACyD,CAAC,EAAEQ,EAAE,CAAC,CAAC,CAAC,CAAC,EAAEnB,IAAI,EAAE,OAAOvD,CAAC;MAC5J,IAAIkE,CAAC,GAAG,CAAC,EAAElE,CAAC,EAAE0E,EAAE,GAAG,CAACA,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE1E,CAAC,CAAC6C,KAAK,CAAC;MACvC,QAAQ6B,EAAE,CAAC,CAAC,CAAC;QACT,KAAK,CAAC;QAAE,KAAK,CAAC;UAAE1E,CAAC,GAAG0E,EAAE;UAAE;QACxB,KAAK,CAAC;UAAEd,CAAC,CAACC,KAAK,EAAE;UAAE,OAAO;YAAEhB,KAAK,EAAE6B,EAAE,CAAC,CAAC,CAAC;YAAEnB,IAAI,EAAE;UAAM,CAAC;QACvD,KAAK,CAAC;UAAEK,CAAC,CAACC,KAAK,EAAE;UAAEK,CAAC,GAAGQ,EAAE,CAAC,CAAC,CAAC;UAAEA,EAAE,GAAG,CAAC,CAAC,CAAC;UAAE;QACxC,KAAK,CAAC;UAAEA,EAAE,GAAGd,CAAC,CAACI,GAAG,CAACY,GAAG,CAAC,CAAC;UAAEhB,CAAC,CAACG,IAAI,CAACa,GAAG,CAAC,CAAC;UAAE;QACxC;UACI,IAAI,EAAE5E,CAAC,GAAG4D,CAAC,CAACG,IAAI,EAAE/D,CAAC,GAAGA,CAAC,CAACK,MAAM,GAAG,CAAC,IAAIL,CAAC,CAACA,CAAC,CAACK,MAAM,GAAG,CAAC,CAAC,CAAC,KAAKqE,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,IAAIA,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE;YAAEd,CAAC,GAAG,CAAC;YAAE;UAAU;UAC3G,IAAIc,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC1E,CAAC,IAAK0E,EAAE,CAAC,CAAC,CAAC,GAAG1E,CAAC,CAAC,CAAC,CAAC,IAAI0E,EAAE,CAAC,CAAC,CAAC,GAAG1E,CAAC,CAAC,CAAC,CAAE,CAAC,EAAE;YAAE4D,CAAC,CAACC,KAAK,GAAGa,EAAE,CAAC,CAAC,CAAC;YAAE;UAAO;UACrF,IAAIA,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,IAAId,CAAC,CAACC,KAAK,GAAG7D,CAAC,CAAC,CAAC,CAAC,EAAE;YAAE4D,CAAC,CAACC,KAAK,GAAG7D,CAAC,CAAC,CAAC,CAAC;YAAEA,CAAC,GAAG0E,EAAE;YAAE;UAAO;UACpE,IAAI1E,CAAC,IAAI4D,CAAC,CAACC,KAAK,GAAG7D,CAAC,CAAC,CAAC,CAAC,EAAE;YAAE4D,CAAC,CAACC,KAAK,GAAG7D,CAAC,CAAC,CAAC,CAAC;YAAE4D,CAAC,CAACI,GAAG,CAACa,IAAI,CAACH,EAAE,CAAC;YAAE;UAAO;UAClE,IAAI1E,CAAC,CAAC,CAAC,CAAC,EAAE4D,CAAC,CAACI,GAAG,CAACY,GAAG,CAAC,CAAC;UACrBhB,CAAC,CAACG,IAAI,CAACa,GAAG,CAAC,CAAC;UAAE;MACtB;MACAF,EAAE,GAAGf,IAAI,CAAClD,IAAI,CAAC+B,OAAO,EAAEoB,CAAC,CAAC;IAC9B,CAAC,CAAC,OAAOR,CAAC,EAAE;MAAEsB,EAAE,GAAG,CAAC,CAAC,EAAEtB,CAAC,CAAC;MAAEc,CAAC,GAAG,CAAC;IAAE,CAAC,SAAS;MAAED,CAAC,GAAGjE,CAAC,GAAG,CAAC;IAAE;IACzD,IAAI0E,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,MAAMA,EAAE,CAAC,CAAC,CAAC;IAAE,OAAO;MAAE7B,KAAK,EAAE6B,EAAE,CAAC,CAAC,CAAC,GAAGA,EAAE,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC;MAAEnB,IAAI,EAAE;IAAK,CAAC;EACpF;AACJ,CAAC;AACD,IAAI2M,aAAa,GAAItQ,SAAS,IAAIA,SAAS,CAACsQ,aAAa,IAAK,UAAUC,EAAE,EAAE/R,IAAI,EAAEgS,IAAI,EAAE;EACpF,IAAIA,IAAI,IAAIhQ,SAAS,CAACC,MAAM,KAAK,CAAC,EAAE,KAAK,IAAIH,CAAC,GAAG,CAAC,EAAEmQ,CAAC,GAAGjS,IAAI,CAACiC,MAAM,EAAEiQ,EAAE,EAAEpQ,CAAC,GAAGmQ,CAAC,EAAEnQ,CAAC,EAAE,EAAE;IACjF,IAAIoQ,EAAE,IAAI,EAAEpQ,CAAC,IAAI9B,IAAI,CAAC,EAAE;MACpB,IAAI,CAACkS,EAAE,EAAEA,EAAE,GAAG1R,KAAK,CAAC2B,SAAS,CAACgQ,KAAK,CAAC9P,IAAI,CAACrC,IAAI,EAAE,CAAC,EAAE8B,CAAC,CAAC;MACpDoQ,EAAE,CAACpQ,CAAC,CAAC,GAAG9B,IAAI,CAAC8B,CAAC,CAAC;IACnB;EACJ;EACA,OAAOiQ,EAAE,CAAC7R,MAAM,CAACgS,EAAE,IAAI1R,KAAK,CAAC2B,SAAS,CAACgQ,KAAK,CAAC9P,IAAI,CAACrC,IAAI,CAAC,CAAC;AAC5D,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA,IAAIoS,aAAa,GAAG,aAAe,YAAY;EAC3C,SAASA,aAAaA;EACtB;AACJ;AACA;AACA;AACA;AACA;AACA;EACIC,eAAe,EACf;EACAzG,QAAQ,EACR;EACA8B,gBAAgB,EAAEzG,EAAE,EAAE;IAClB,IAAII,EAAE,GAAGJ,EAAE,KAAK,KAAK,CAAC,GAAG,CAAC,CAAC,GAAGA,EAAE;MAAEyC,EAAE,GAAGrC,EAAE,CAACiL,YAAY;MAAEA,YAAY,GAAG5I,EAAE,KAAK,KAAK,CAAC,GAAG,EAAE,GAAGA,EAAE;MAAEmE,EAAE,GAAGxG,EAAE,CAACkL,iBAAiB;MAAEA,iBAAiB,GAAG1E,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,GAAGA,EAAE;IACzK,IAAI2E,KAAK,GAAG,IAAI;IAChB,IAAI,CAACH,eAAe,GAAGA,eAAe;IACtC,IAAI,CAACzG,QAAQ,GAAGA,QAAQ;IACxB,IAAI,CAAC8B,gBAAgB,GAAGA,gBAAgB;IACxC;IACA,IAAI,CAAC2E,eAAe,CAACI,EAAE,CAAC,SAAS,CAACvS,MAAM,CAACf,uBAAuB,CAACuT,oBAAoB,CAAC,EAAE,UAAUlQ,KAAK,EAAE;MACrGA,KAAK,CAACmQ,cAAc,CAAC,CAAC;MACtB,IAAIC,iBAAiB,GAAGxT,kBAAkB,CAACM,MAAM,CAAC,UAAUmT,UAAU,EAAE;QACpE,OAAOA,UAAU,KAAKxT,kBAAkB,CAACyT,oBAAoB;MACjE,CAAC,CAAC;MACFT,eAAe,CAACU,SAAS,CAACC,KAAK,CAACxQ,KAAK,CAACyQ,MAAM,EAAE;QAC1CC,kBAAkB,EAAEN;MACxB,CAAC,CAAC;IACN,CAAC,CAAC;IACF,IAAI,CAACO,OAAO,GAAGxT,SAAS,CAAC,IAAI,CAAC0S,eAAe,EAAE,SAAS,CAACnS,MAAM,CAACf,uBAAuB,CAACiU,SAAS,CAAC,EAAE,UAAU5Q,KAAK,EAAE;MACjHA,KAAK,CAACmQ,cAAc,CAAC,CAAC;MACtB,IAAI;QACAH,KAAK,CAACH,eAAe,CAACU,SAAS,CAACC,KAAK,CAACxQ,KAAK,CAACyQ,MAAM,EAAE,CAAC,CAAC,CAAC;MAC3D,CAAC,CACD,OAAOhM,EAAE,EAAE;QACP;MAAA;MAEJ,OAAOzE,KAAK;IAChB,CAAC,CAAC,CAAC6H,IAAI,CAACjK,KAAK,CAAC,CAAC,CAAC;IAChB,IAAI,CAACiT,iBAAiB,GAAG1T,SAAS,CAAC,IAAI,CAAC0S,eAAe,EAAE,uBAAuB,EAAE,UAAU7P,KAAK,EAAE;MAC/FA,KAAK,CAACmQ,cAAc,CAAC,CAAC;MACtB,IAAI;QACAN,eAAe,CAACU,SAAS,CAACC,KAAK,CAACxQ,KAAK,CAACyQ,MAAM,EAAE,CAAC,CAAC,CAAC;MACrD,CAAC,CACD,OAAOhM,EAAE,EAAE;QACP;MAAA;MAEJ,OAAOzE,KAAK;IAChB,CAAC,CAAC,CACG6H,IAAI,CAAC3K,MAAM,CAAC,UAAU8C,KAAK,EAAE;MAAE,OAAOQ,2BAA2B,CAACR,KAAK,CAACyQ,MAAM,CAACvD,IAAI,CAAC;IAAE,CAAC,CAAC,CAAC,CACzFrF,IAAI,CAACjK,KAAK,CAAC,CAAC,CAAC;IAClB,IAAI,CAACkT,mBAAmB,GAAGxB,aAAa,CAACA,aAAa,CAAC,EAAE,EAAEQ,YAAY,EAAE,IAAI,CAAC,EAAGC,iBAAiB,GAAG,EAAE,GAAG,CAACjT,kBAAkB,CAACiU,cAAc,CAAC,EAAG,IAAI,CAAC;EACzJ;EACA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACInB,aAAa,CAACpM,MAAM,GAAG,YAAY;IAC/B,OAAO7B,SAAS,CAAC,IAAI,EAAEnC,SAAS,EAAE,KAAK,CAAC,EAAE,UAAUiF,EAAE,EAAE;MACpD,IAAII,EAAE,EAAEoE,YAAY,EAAEG,QAAQ,EAAE8B,gBAAgB,EAAE2E,eAAe,EAAEvL,SAAS;MAC5E,IAAI4C,EAAE,GAAGzC,EAAE,KAAK,KAAK,CAAC,GAAG,CAAC,CAAC,GAAGA,EAAE;QAAE4G,EAAE,GAAGnE,EAAE,CAAC4I,YAAY;QAAEA,YAAY,GAAGzE,EAAE,KAAK,KAAK,CAAC,GAAG,EAAE,GAAGA,EAAE;QAAEC,EAAE,GAAGpE,EAAE,CAAC6I,iBAAiB;QAAEA,iBAAiB,GAAGzE,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,GAAGA,EAAE;MACzK,OAAOxI,WAAW,CAAC,IAAI,EAAE,UAAUyI,EAAE,EAAE;QACnC,QAAQA,EAAE,CAACtI,KAAK;UACZ,KAAK,CAAC;YACF4B,EAAE,GAAG4D,0BAA0B,CAAC,CAAC,EAAEQ,YAAY,GAAGpE,EAAE,CAACoE,YAAY,EAAEG,QAAQ,GAAGvE,EAAE,CAACuE,QAAQ;YACzF8B,gBAAgB,GAAGxB,uBAAuB,CAAC,CAAC;YAC5CmG,eAAe,GAAG,IAAInT,SAAS,CAAC0M,QAAQ,EAAEH,YAAY,CAAC;YACvD3E,SAAS,GAAG,IAAIsL,aAAa,CAACC,eAAe,EAAEzG,QAAQ,EAAE8B,gBAAgB,EAAE;cAAE4E,YAAY,EAAEA,YAAY;cAAEC,iBAAiB,EAAEA;YAAkB,CAAC,CAAC;YAChJ,OAAO,CAAC,CAAC,CAAC,WAAWzL,SAAS,CAAC0M,UAAU,CAAC,CAAC,CAAC;UAChD,KAAK,CAAC;YACFzF,EAAE,CAACrI,IAAI,CAAC,CAAC;YACT,OAAO,CAAC,CAAC,CAAC,YAAYoB,SAAS,CAAC;QACxC;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIsL,aAAa,CAACjQ,SAAS,CAACqR,UAAU,GAAG,YAAY;IAC7C,OAAOrP,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;MAC/C,IAAIsP,KAAK,EAAEvG,OAAO,EAAEwG,WAAW,EAAElD,eAAe;MAChD,IAAIgC,KAAK,GAAG,IAAI;MAChB,OAAOlN,WAAW,CAAC,IAAI,EAAE,UAAU2B,EAAE,EAAE;QACnC,QAAQA,EAAE,CAACxB,KAAK;UACZ,KAAK,CAAC;YACFgO,KAAK,GAAG,IAAI9O,OAAO,CAAC,UAAUD,OAAO,EAAE;cACnC8N,KAAK,CAACH,eAAe,CAACsB,IAAI,CAAC,OAAO,EAAE,YAAY;gBAAE,OAAOjP,OAAO,CAAC,CAAC;cAAE,CAAC,CAAC;YAC1E,CAAC,CAAC;YACFwI,OAAO,GAAGP,aAAa,CAAC,IAAI,CAACf,QAAQ,CAAC,CAACsB,OAAO;YAC9CwG,WAAW,GAAGxG,OAAO,GACd,YAAY;cAAE,OAAO/I,SAAS,CAACqO,KAAK,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;gBACjE,IAAIoB,aAAa,EAAE3M,EAAE;gBACrB,IAAIuL,KAAK,GAAG,IAAI;gBAChB,OAAOlN,WAAW,CAAC,IAAI,EAAE,UAAU+B,EAAE,EAAE;kBACnC,QAAQA,EAAE,CAAC5B,KAAK;oBACZ,KAAK,CAAC;sBACFmO,aAAa,GAAGjU,SAAS,CAAC,IAAI,CAAC0S,eAAe,EAAE,SAAS,CAACnS,MAAM,CAACf,uBAAuB,CAAC0U,YAAY,CAAC,EAAE,UAAUC,EAAE,EAAE;wBAClHA,EAAE,CAACnB,cAAc,CAAC,CAAC;wBACnBH,KAAK,CAACH,eAAe,CAACU,SAAS,CAACC,KAAK,CAACc,EAAE,CAACb,MAAM,EAAE,CAAC,CAAC,CAAC;wBACpD,OAAOa,EAAE,CAACb,MAAM,CAACvD,IAAI;sBACzB,CAAC,CAAC;sBACFzI,EAAE,GAAG,IAAI;sBACT,OAAO,CAAC,CAAC,CAAC,WAAWrH,cAAc,CAACgU,aAAa,CAAC,CAAC;oBACvD,KAAK,CAAC;sBACF3M,EAAE,CAAC8M,YAAY,GAAG1M,EAAE,CAAC3B,IAAI,CAAC,CAAC;sBAC3B,OAAO,CAAC,CAAC,CAAC,WAAW;kBAC7B;gBACJ,CAAC,CAAC;cACN,CAAC,CAAC;YAAE,CAAC,CAAE,CAAC,GACNlE,SAAS;YACfgP,eAAe,GAAGK,MAAM,CAACN,wBAAwB,CAAC,IAAI,CAAC+C,mBAAmB,CAAC,CAAC;YAC5E,IAAI,CAACjB,eAAe,CAAC1C,mBAAmB,CAACa,eAAe,CAAC;YACzD,IAAI,CAAC6B,eAAe,CAAC2B,KAAK,CAAC,CAAC;YAC5B,OAAO,CAAC,CAAC,CAAC,WAAWP,KAAK,CAAC;UAC/B,KAAK,CAAC;YACFxM,EAAE,CAACvB,IAAI,CAAC,CAAC;YACT,IAAI,CAACgO,WAAW,EAAE,OAAO,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC;YACzC,OAAO,CAAC,CAAC,CAAC,WAAWA,WAAW,CAAC;UACrC,KAAK,CAAC;YACFzM,EAAE,CAACvB,IAAI,CAAC,CAAC;YACTuB,EAAE,CAACxB,KAAK,GAAG,CAAC;UAChB,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,WAAW;QACjC;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD;EACA2M,aAAa,CAACjQ,SAAS,CAAC8R,eAAe,GAAG,YAAY;IAClD,OAAO,IAAI,CAACF,YAAY;EAC5B,CAAC;EACD;EACA3B,aAAa,CAACjQ,SAAS,CAAC+R,4BAA4B,GAAG,YAAY;IAC/D,OAAO/P,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;MAC/C,OAAOmB,WAAW,CAAC,IAAI,EAAE,UAAU2B,EAAE,EAAE;QACnC,QAAQA,EAAE,CAACxB,KAAK;UACZ,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAACkK,mBAAmB,CAAC,IAAI,CAAC2D,mBAAmB,CAAC,CAAC;UAChF,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,YAAYrM,EAAE,CAACvB,IAAI,CAAC,CAAC,CAAC;QAC5C;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD;EACA0M,aAAa,CAACjQ,SAAS,CAACgS,sBAAsB,GAAG,YAAY;IACzD,OAAO,IAAI,CAACC,eAAe,CAAC,IAAI,CAACd,mBAAmB,CAAC;EACzD,CAAC;EACD;EACAlB,aAAa,CAACjQ,SAAS,CAACwN,mBAAmB,GAAG,UAAU2C,YAAY,EAAE;IAClE,OAAOnO,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;MAC/C,OAAOmB,WAAW,CAAC,IAAI,EAAE,UAAU+B,EAAE,EAAE;QACnC,QAAQA,EAAE,CAAC5B,KAAK;UACZ,KAAK,CAAC;YACF,IAAI,CAAC,IAAI,CAAC4O,8BAA8B,EAAE,OAAO,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC;YACjEhN,EAAE,CAAC5B,KAAK,GAAG,CAAC;UAChB,KAAK,CAAC;YACF4B,EAAE,CAAC1B,IAAI,CAACc,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,GAAI,CAAC,CAAC,CAAC;YACzB,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC4N,8BAA8B,CAAC;UAC7D,KAAK,CAAC;YACFhN,EAAE,CAAC3B,IAAI,CAAC,CAAC;YACT,OAAO,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC;UAC3B,KAAK,CAAC;YACF2B,EAAE,CAAC3B,IAAI,CAAC,CAAC;YACT,OAAO,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC;UAC3B,KAAK,CAAC;YACF2B,EAAE,CAAC1B,IAAI,CAACc,IAAI,CAAC,CAAC,CAAC,GAAI,CAAC,EAAE,CAAC,CAAC,CAAC;YACzB,IAAI,CAAC4N,8BAA8B,GAC/B,IAAI,CAACC,2BAA2B,CAAChC,YAAY,CAAC;YAClD,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC+B,8BAA8B,CAAC;UAC7D,KAAK,CAAC;YACFhN,EAAE,CAAC3B,IAAI,CAAC,CAAC;YACT,OAAO,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC;UAC3B,KAAK,CAAC;YACF,IAAI,CAAC2O,8BAA8B,GAAG7S,SAAS;YAC/C,OAAO,CAAC,CAAC,CAAC,eAAe;UAC7B,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,WAAW;QACjC;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD4Q,aAAa,CAACjQ,SAAS,CAACmS,2BAA2B,GAAG,UAAUhC,YAAY,EAAE;IAC1E,OAAOnO,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;MAC/C,IAAIqM,eAAe,EAAE+D,YAAY,EAAEC,aAAa;MAChD,IAAIhC,KAAK,GAAG,IAAI;MAChB,OAAOlN,WAAW,CAAC,IAAI,EAAE,UAAU2B,EAAE,EAAE;QACnC,QAAQA,EAAE,CAACxB,KAAK;UACZ,KAAK,CAAC;YACF+K,eAAe,GAAGK,MAAM,CAACN,wBAAwB,CAAC+B,YAAY,CAAC,CAAC;YAChE;YACA,IAAI,IAAI,CAAC8B,eAAe,CAAC5D,eAAe,CAAC,EAAE;cACvC,OAAO,CAAC,CAAC,CAAC,WAAW;YACzB;YACA+D,YAAY,GAAG,IAAIxD,GAAG,CAACP,eAAe,CAAC;YACvCgE,aAAa,GAAG7U,SAAS,CAAC,IAAI,CAAC0S,eAAe,EAAE,SAAS,CAACnS,MAAM,CAACf,uBAAuB,CAACsV,kBAAkB,CAAC,EAAE,UAAUX,EAAE,EAAE;cAAE,OAAOA,EAAE;YAAE,CAAC,CAAC,CAACzJ,IAAI;YAChJ;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACAxK,GAAG,CAAC,UAAUiU,EAAE,EAAE;cACd,IAAIY,WAAW,GAAG,IAAI3D,GAAG,CAAC+C,EAAE,CAACb,MAAM,CAACvD,IAAI,CAACiF,QAAQ,CAAC;cAClD,IAAIC,UAAU,GAAG5D,WAAW,CAACuD,YAAY,EAAEG,WAAW,CAAC;cACvD,IAAIE,UAAU,CAACC,IAAI,GAAG,CAAC,EAAE;gBACrB,MAAM,IAAIrJ,KAAK,CAAC,yBAAyB,CAACtL,MAAM,CAACM,KAAK,CAACR,IAAI,CAAC4U,UAAU,CAAC,CAAC3F,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;cACxF;YACJ,CAAC,CAAC,EAAEnP,KAAK,CAAC,CAAC,CAAC;YACZ;YACA,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI6E,OAAO,CAAC,UAAUD,OAAO,EAAEE,MAAM,EAAE;cAAE,OAAOT,SAAS,CAACqO,KAAK,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;gBAC1G,IAAIsC,YAAY,EAAEC,KAAK;gBACvB,OAAOzP,WAAW,CAAC,IAAI,EAAE,UAAU2B,EAAE,EAAE;kBACnC,QAAQA,EAAE,CAACxB,KAAK;oBACZ,KAAK,CAAC;sBACFqP,YAAY,GAAGN,aAAa,CAACQ,SAAS,CAAC;wBACnCjQ,IAAI,EAAEL,OAAO;wBACb7B,KAAK,EAAE+B;sBACX,CAAC,CAAC;sBACFqC,EAAE,CAACxB,KAAK,GAAG,CAAC;oBAChB,KAAK,CAAC;sBACFwB,EAAE,CAACtB,IAAI,CAACc,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,GAAI,CAAC,CAAC,CAAC;sBACzB,IAAI,CAAC4L,eAAe,CAAC1C,mBAAmB,CAACa,eAAe,CAAC;sBACzD,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC6B,eAAe,CAAC4C,2BAA2B,CAAC,CAAC,CAAC;oBAC5E,KAAK,CAAC;sBACFhO,EAAE,CAACvB,IAAI,CAAC,CAAC;sBACT,OAAO,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC;oBAC3B,KAAK,CAAC;sBACFqP,KAAK,GAAG9N,EAAE,CAACvB,IAAI,CAAC,CAAC;sBACjBoP,YAAY,CAACI,WAAW,CAAC,CAAC;sBAC1BtQ,MAAM,CAACmQ,KAAK,CAAC;sBACb,OAAO,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC;oBAC3B,KAAK,CAAC;sBAAE,OAAO,CAAC,CAAC,CAAC,WAAW;kBACjC;gBACJ,CAAC,CAAC;cACN,CAAC,CAAC;YAAE,CAAC,CAAC,CAAC;UACf,KAAK,CAAC;YACF;YACA9N,EAAE,CAACvB,IAAI,CAAC,CAAC;YACT,OAAO,CAAC,CAAC,CAAC,WAAW;QAC7B;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD;EACA0M,aAAa,CAACjQ,SAAS,CAACiS,eAAe,GAAG,UAAU9B,YAAY,EAAE;IAC9D,IAAIE,KAAK,GAAG,IAAI;IAChB,IAAIhC,eAAe,GAAGD,wBAAwB,CAAC+B,YAAY,CAAC;IAC5D,OAAO9B,eAAe,CAACvI,KAAK,CAAC,UAAUwI,CAAC,EAAE;MAAE,OAAO+B,KAAK,CAACH,eAAe,CAAC8C,aAAa,CAAC1E,CAAC,CAAC;IAAE,CAAC,CAAC;EACjG,CAAC;EACD;EACA2B,aAAa,CAACjQ,SAAS,CAAC4N,uBAAuB,GAAG,UAAUqF,WAAW,EAAE;IACrE,OAAOjR,SAAS,CAAC,IAAI,EAAEnC,SAAS,EAAE,KAAK,CAAC,EAAE,UAAUgH,SAAS,EAAEkH,QAAQ,EAAE;MACrE,IAAI9H,MAAM;MACV,IAAI8H,QAAQ,KAAK,KAAK,CAAC,EAAE;QAAEA,QAAQ,GAAG,EAAE;MAAE;MAC1C,OAAO5K,WAAW,CAAC,IAAI,EAAE,UAAU2B,EAAE,EAAE;QACnC,QAAQA,EAAE,CAACxB,KAAK;UACZ,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC4P,kBAAkB,CAACrM,SAAS,EAAE;cAAEkH,QAAQ,EAAEA;YAAS,CAAC,CAAC,CAAC;UACxF,KAAK,CAAC;YACF9H,MAAM,GAAGnB,EAAE,CAACvB,IAAI,CAAC,CAAC;YAClB,OAAO,CAAC,CAAC,CAAC,YAAY0C,MAAM,IAAIA,MAAM,CAAC,CAAC,CAAC,CAAC;QAClD;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD;EACAgK,aAAa,CAACjQ,SAAS,CAACkT,kBAAkB,GAAG,UAAUD,WAAW,EAAE;IAChE,OAAOjR,SAAS,CAAC,IAAI,EAAEnC,SAAS,EAAE,KAAK,CAAC,EAAE,UAAUgH,SAAS,EAAE/B,EAAE,EAAE;MAC/D,IAAIqO,iBAAiB,EAAEC,eAAe;MACtC,IAAIlO,EAAE,GAAGJ,EAAE,KAAK,KAAK,CAAC,GAAG,CAAC,CAAC,GAAGA,EAAE;QAAEiJ,QAAQ,GAAG7I,EAAE,CAAC6I,QAAQ;QAAE5P,OAAO,GAAG+G,EAAE,CAAC/G,OAAO;MAC9E,OAAOgF,WAAW,CAAC,IAAI,EAAE,UAAUoE,EAAE,EAAE;QACnC,QAAQA,EAAE,CAACjE,KAAK;UACZ,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC4M,eAAe,CAACmD,eAAe,CAACxM,SAAS,EAAEyM,MAAM,CAACC,gBAAgB,EAAExF,QAAQ,EAAE,OAAO5P,OAAO,KAAK,QAAQ,GAAG,CAACvB,OAAO,CAACwB,OAAO,CAAC,GAAGD,OAAO,CAAC,CAAC;UAC3K,KAAK,CAAC;YACFgV,iBAAiB,GAAI5L,EAAE,CAAChE,IAAI,CAAC,CAAE;YAC/B6P,eAAe,GAAGD,iBAAiB,CAAC5V,MAAM,CAACoD,iBAAiB,CAAC;YAC7D,OAAO,CAAC,CAAC,CAAC,YAAYyS,eAAe,CAAC;QAC9C;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD;EACAnD,aAAa,CAACjQ,SAAS,CAACwT,kBAAkB,GAAG,UAAU3M,SAAS,EAAE/B,EAAE,EAAE;IAClE,IAAII,EAAE,GAAGJ,EAAE,KAAK,KAAK,CAAC,GAAG,CAAC,CAAC,GAAGA,EAAE;MAAEiJ,QAAQ,GAAG7I,EAAE,CAAC6I,QAAQ;MAAE5P,OAAO,GAAG+G,EAAE,CAAC/G,OAAO;IAC9E,IAAIiR,aAAa,GAAG,IAAI,CAAC7D,gBAAgB,CAAC3G,MAAM;IAChD,IAAI,CAACwK,aAAa,EAAE;MAChB,OAAOxR,UAAU,CAAC,YAAY;QAAE,OAAO,IAAIyL,KAAK,CAAC,4BAA4B,CAAC;MAAE,CAAC,CAAC;IACtF;IACA,IAAIoK,aAAa,GAAG5V,IAAI,CAAC,IAAI,CAACqV,kBAAkB,CAACrM,SAAS,EAAE;MAAEkH,QAAQ,EAAEA,QAAQ;MAAE5P,OAAO,EAAEA;IAAQ,CAAC,CAAC,CAAC,CAAC+J,IAAI,CAACpK,QAAQ,CAAC,CAAC,CAAC;IACvH,IAAI4V,YAAY,GAAG,IAAI,CAAC1C,OAAO,CAAC9I,IAAI,CAACxK,GAAG,CAAC,UAAU2C,KAAK,EAAE;MACtD,IAAI8O,WAAW,GAAG9O,KAAK,CAACyQ,MAAM,CAACvD,IAAI;MACnC,IAAI4B,WAAW,CAACnO,IAAI,KAAK6F,SAAS,IAC9BsI,WAAW,CAACtQ,SAAS,KAAKQ,SAAS,KAClC0O,QAAQ,KAAK1O,SAAS,IAAI8P,WAAW,CAACtQ,SAAS,KAAKkP,QAAQ,CAAC,IAC9DmB,QAAQ,CAACC,WAAW,EAAEC,aAAa,EAAEjR,OAAO,CAAC,EAAE;QAC/C,OAAOkC,KAAK,CAACyQ,MAAM,CAACvD,IAAI;MAC5B;MACA,OAAOlO,SAAS;IACpB,CAAC,CAAC,EAAE9B,MAAM,CAACiR,SAAS,CAAC,CAAC;IACtB,OAAOzQ,MAAM,CAAC0V,aAAa,EAAEC,YAAY,CAAC,CAACxL,IAAI,CAAC3K,MAAM,CAACoD,iBAAiB,CAAC,CAAC;EAC9E,CAAC;EACD;EACAsP,aAAa,CAACjQ,SAAS,CAAC8N,cAAc,GAAG,UAAUjH,SAAS,EAAElI,OAAO,EAAEmG,EAAE,EAAE;IACvE,IAAII,EAAE,GAAGJ,EAAE,KAAK,KAAK,CAAC,GAAG,CAAC,CAAC,GAAGA,EAAE;MAAEF,MAAM,GAAGM,EAAE,CAACN,MAAM;MAAE2C,EAAE,GAAGrC,EAAE,CAAC6I,QAAQ;MAAEA,QAAQ,GAAGxG,EAAE,KAAK,KAAK,CAAC,GAAG,EAAE,GAAGA,EAAE;IAC1G,OAAO,IAAI,CAAC2I,eAAe,CAACpC,cAAc,CAACjH,SAAS,EAAEkH,QAAQ,EAAEpP,OAAO,EAAEiG,MAAM,CAAC;EACpF,CAAC;EACD;EACAqL,aAAa,CAACjQ,SAAS,CAAC2T,qBAAqB,GAAG,UAAUV,WAAW,EAAEW,SAAS,EAAEC,OAAO,EAAE;IACvF,OAAO7R,SAAS,CAAC,IAAI,EAAEnC,SAAS,EAAE,KAAK,CAAC,EAAE,UAAUgH,SAAS,EAAElI,OAAO,EAAEmV,KAAK,EAAEhP,EAAE,EAAE;MAC/E,IAAIiP,QAAQ;MACZ,IAAI7O,EAAE,GAAGJ,EAAE,KAAK,KAAK,CAAC,GAAG,CAAC,CAAC,GAAGA,EAAE;QAAEF,MAAM,GAAGM,EAAE,CAACN,MAAM;QAAE2C,EAAE,GAAGrC,EAAE,CAAC6I,QAAQ;QAAEA,QAAQ,GAAGxG,EAAE,KAAK,KAAK,CAAC,GAAG,EAAE,GAAGA,EAAE;MAC1G,OAAOpE,WAAW,CAAC,IAAI,EAAE,UAAUuI,EAAE,EAAE;QACnC,QAAQA,EAAE,CAACpI,KAAK;UACZ,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC4M,eAAe,CAACpC,cAAc,CAACjH,SAAS,EAAEkH,QAAQ,EAAEpP,OAAO,EAAEiG,MAAM,EAAEkP,KAAK,CAAC,CAAC;UAC9G,KAAK,CAAC;YACFC,QAAQ,GAAIrI,EAAE,CAACnI,IAAI,CAAC,CAAC,CAAEwQ,QAAQ;YAC/B,IAAI,CAACA,QAAQ,EAAE;cACX,MAAM,IAAI1K,KAAK,CAAC,oCAAoC,CAAC;YACzD;YACA,OAAO,CAAC,CAAC,CAAC,YAAY;cAAE0K,QAAQ,EAAEA;YAAS,CAAC,CAAC;QACrD;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD;EACA9D,aAAa,CAACjQ,SAAS,CAACgU,iBAAiB,GAAG,UAAUf,WAAW,EAAE;IAC/D,OAAOjR,SAAS,CAAC,IAAI,EAAEnC,SAAS,EAAE,KAAK,CAAC,EAAE,UAAUgH,SAAS,EAAE/B,EAAE,EAAE;MAC/D,IAAIqO,iBAAiB,EAAEC,eAAe;MACtC,IAAIlO,EAAE,GAAGJ,EAAE,KAAK,KAAK,CAAC,GAAG,CAAC,CAAC,GAAGA,EAAE;QAAEmP,WAAW,GAAG/O,EAAE,CAAC+O,WAAW;QAAE9V,OAAO,GAAG+G,EAAE,CAAC/G,OAAO;MACpF,OAAOgF,WAAW,CAAC,IAAI,EAAE,UAAUoE,EAAE,EAAE;QACnC,QAAQA,EAAE,CAACjE,KAAK;UACZ,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC4M,eAAe,CAACgE,cAAc,CAACrN,SAAS,EAAEyM,MAAM,CAACC,gBAAgB,EAAEU,WAAW,EAAE,OAAO9V,OAAO,KAAK,QAAQ,GAAG,CAACvB,OAAO,CAACwB,OAAO,CAAC,GAAGD,OAAO,CAAC,CAAC;UAC7K,KAAK,CAAC;YACFgV,iBAAiB,GAAI5L,EAAE,CAAChE,IAAI,CAAC,CAAE;YAC/B6P,eAAe,GAAGD,iBAAiB,CAAC5V,MAAM,CAACgD,gBAAgB,CAAC;YAC5D,OAAO,CAAC,CAAC,CAAC,YAAY6S,eAAe,CAAC;QAC9C;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD;EACAnD,aAAa,CAACjQ,SAAS,CAACiI,iBAAiB,GAAG,UAAUpB,SAAS,EAAE/B,EAAE,EAAE;IACjE,IAAII,EAAE,GAAGJ,EAAE,KAAK,KAAK,CAAC,GAAG,CAAC,CAAC,GAAGA,EAAE;MAAEmP,WAAW,GAAG/O,EAAE,CAAC+O,WAAW;MAAE9V,OAAO,GAAG+G,EAAE,CAAC/G,OAAO;IACpF,IAAIiR,aAAa,GAAG,IAAI,CAAC7D,gBAAgB,CAAC3G,MAAM;IAChD,IAAI,CAACwK,aAAa,EAAE;MAChB,OAAOxR,UAAU,CAAC,YAAY;QAAE,OAAO,IAAIyL,KAAK,CAAC,4BAA4B,CAAC;MAAE,CAAC,CAAC;IACtF;IACA,IAAIoK,aAAa,GAAG5V,IAAI,CAAC,IAAI,CAACmW,iBAAiB,CAACnN,SAAS,EAAE;MAAEoN,WAAW,EAAEA,WAAW;MAAE9V,OAAO,EAAEA;IAAQ,CAAC,CAAC,CAAC,CAAC+J,IAAI,CAACpK,QAAQ,CAAC,CAAC,CAAC;IAC5H,IAAI4V,YAAY,GAAG,IAAI,CAAC1C,OAAO,CAAC9I,IAAI,CAACxK,GAAG,CAAC,UAAU2C,KAAK,EAAE;MACtD,IAAI8O,WAAW,GAAG9O,KAAK,CAACyQ,MAAM,CAACvD,IAAI;MACnC,IAAI4B,WAAW,CAACnO,IAAI,KAAK6F,SAAS,IAC9BsI,WAAW,CAACtQ,SAAS,KAAKQ,SAAS,KAClC,CAAC4U,WAAW,IAAI9E,WAAW,CAACxQ,OAAO,CAACwV,OAAO,KAAKF,WAAW,CAAC,IAC7D/E,QAAQ,CAACC,WAAW,EAAEC,aAAa,EAAEjR,OAAO,CAAC,EAAE;QAC/C,OAAOkC,KAAK,CAACyQ,MAAM,CAACvD,IAAI;MAC5B;MACA,OAAOlO,SAAS;IACpB,CAAC,CAAC,EAAE9B,MAAM,CAACiR,SAAS,CAAC,CAAC;IACtB,OAAOzQ,MAAM,CAAC0V,aAAa,EAAEC,YAAY,CAAC,CAACxL,IAAI,CAAC3K,MAAM,CAACgD,gBAAgB,CAAC,CAAC;EAC7E,CAAC;EACD;EACA0P,aAAa,CAACjQ,SAAS,CAAC+H,aAAa,GAAG,UAAUkL,WAAW,EAAEW,SAAS,EAAE;IACtE,OAAO5R,SAAS,CAAC,IAAI,EAAEnC,SAAS,EAAE,KAAK,CAAC,EAAE,UAAUgH,SAAS,EAAElI,OAAO,EAAEmG,EAAE,EAAE;MACxE,IAAIsP,OAAO,EAAEzB,YAAY,EAAEzN,EAAE,EAAEmP,UAAU,EAAEC,SAAS,EAAEC,OAAO;MAC7D,IAAIhN,EAAE,GAAGzC,EAAE,KAAK,KAAK,CAAC,GAAG,CAAC,CAAC,GAAGA,EAAE;QAAEF,MAAM,GAAG2C,EAAE,CAAC3C,MAAM;MACpD,OAAOzB,WAAW,CAAC,IAAI,EAAE,UAAUuI,EAAE,EAAE;QACnC,QAAQA,EAAE,CAACpI,KAAK;UACZ,KAAK,CAAC;YACF8Q,OAAO,GAAG,IAAIpW,aAAa,CAAC,CAAC;YAC7B2U,YAAY,GAAG,IAAI,CAAC3B,OAAO,CAAC6B,SAAS,CAAC,UAAUhQ,CAAC,EAAE;cAAE,OAAOuR,OAAO,CAACxR,IAAI,CAACC,CAAC,CAAC;YAAE,CAAC,CAAC;YAC/E6I,EAAE,CAACpI,KAAK,GAAG,CAAC;UAChB,KAAK,CAAC;YACFoI,EAAE,CAAClI,IAAI,CAACc,IAAI,CAAC,CAAC,CAAC,GAAI,CAAC,EAAE,CAAC,CAAC,CAAC;YACzB,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC4L,eAAe,CAACnI,aAAa,CAAClB,SAAS,EAAElI,OAAO,EAAEiG,MAAM,CAAC,CAAC;UACxF,KAAK,CAAC;YACFM,EAAE,GAAGwG,EAAE,CAACnI,IAAI,CAAC,CAAC,EAAE8Q,UAAU,GAAGnP,EAAE,CAAC3D,QAAQ,EAAE+S,SAAS,GAAGpP,EAAE,CAACjG,OAAO;YAChE,OAAO,CAAC,CAAC,CAAC,WAAWxB,cAAc,CAAC2W,OAAO,CAAClM,IAAI,CAAC3K,MAAM,CAAC,UAAU8C,KAAK,EAAE;cACjE,IAAI8O,WAAW,GAAG9O,KAAK,CAACyQ,MAAM,CAACvD,IAAI;cACnC,OAAQ4B,WAAW,CAAC5N,QAAQ,KAAK8S,UAAU,IACvClF,WAAW,CAAClQ,OAAO,KAAKqV,SAAS;YACzC,CAAC,CAAC,EAAE5W,GAAG,CAAC,UAAU2C,KAAK,EAAE;cAAE,OAAOA,KAAK,CAACyQ,MAAM,CAACvD,IAAI;YAAE,CAAC,CAAC,CAAC,CAAC,CAAC;UAClE,KAAK,CAAC;YACFgH,OAAO,GAAG7I,EAAE,CAACnI,IAAI,CAAC,CAAC;YACnB,OAAO,CAAC,CAAC,CAAC,YAAYgR,OAAO,CAAC;UAClC,KAAK,CAAC;YACF5B,YAAY,CAACI,WAAW,CAAC,CAAC;YAC1B,OAAO,CAAC,CAAC,CAAC,eAAe;UAC7B,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,WAAW;QACjC;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD;EACA9C,aAAa,CAACjQ,SAAS,CAACwU,oBAAoB,GAAG,UAAUvB,WAAW,EAAEW,SAAS,EAAEC,OAAO,EAAE;IACtF,OAAO7R,SAAS,CAAC,IAAI,EAAEnC,SAAS,EAAE,KAAK,CAAC,EAAE,UAAUgH,SAAS,EAAElI,OAAO,EAAEmV,KAAK,EAAEhP,EAAE,EAAE;MAC/E,IAAIiP,QAAQ;MACZ,IAAI7O,EAAE,GAAGJ,EAAE,KAAK,KAAK,CAAC,GAAG,CAAC,CAAC,GAAGA,EAAE;QAAEF,MAAM,GAAGM,EAAE,CAACN,MAAM;MACpD,OAAOzB,WAAW,CAAC,IAAI,EAAE,UAAUoE,EAAE,EAAE;QACnC,QAAQA,EAAE,CAACjE,KAAK;UACZ,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC4M,eAAe,CAACnI,aAAa,CAAClB,SAAS,EAAElI,OAAO,EAAEiG,MAAM,EAAEkP,KAAK,CAAC,CAAC;UACnG,KAAK,CAAC;YACFC,QAAQ,GAAIxM,EAAE,CAAChE,IAAI,CAAC,CAAC,CAAEwQ,QAAQ;YAC/B,IAAI,CAACA,QAAQ,EAAE;cACX,MAAM,IAAI1K,KAAK,CAAC,oCAAoC,CAAC;YACzD;YACA,OAAO,CAAC,CAAC,CAAC,YAAY;cAAE0K,QAAQ,EAAEA;YAAS,CAAC,CAAC;QACrD;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD;EACA9D,aAAa,CAACjQ,SAAS,CAACyU,kBAAkB,GAAG,UAAUC,OAAO,EAAErN,MAAM,EAAE;IACpE,OAAOrF,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;MAC/C,OAAOmB,WAAW,CAAC,IAAI,EAAE,UAAU2B,EAAE,EAAE;QACnC,QAAQA,EAAE,CAACxB,KAAK;UACZ,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC4M,eAAe,CAACuE,kBAAkB,CAACC,OAAO,EAAErN,MAAM,CAAC,CAAC;UACtF,KAAK,CAAC;YACFvC,EAAE,CAACvB,IAAI,CAAC,CAAC;YACT,OAAO,CAAC,CAAC,CAAC,WAAW;QAC7B;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD;EACA0M,aAAa,CAACjQ,SAAS,CAAC2U,kBAAkB,GAAG,UAAU7M,OAAO,EAAE2D,OAAO,EAAE;IACrE,OAAOzJ,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;MAC/C,IAAI8C,EAAE,EAAE8P,KAAK,EAAEC,UAAU;MACzB,OAAO1R,WAAW,CAAC,IAAI,EAAE,UAAU+B,EAAE,EAAE;QACnC,QAAQA,EAAE,CAAC5B,KAAK;UACZ,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC4M,eAAe,CAACyE,kBAAkB,CAAC7M,OAAO,EAAE2D,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAAC7G,MAAM,EAAE6G,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAACqJ,YAAY,EAAErJ,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAAC5E,SAAS,EAAE4E,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAACsJ,KAAK,EAAEtJ,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAAC5N,IAAI,EAAEwB,SAAS,EAAEoM,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAACuJ,SAAS,CAAC,CAAC;UAC9e,KAAK,CAAC;YACFlQ,EAAE,GAAGI,EAAE,CAAC3B,IAAI,CAAC,CAAC,EAAEqR,KAAK,GAAG9P,EAAE,CAAC8P,KAAK,EAAEC,UAAU,GAAG/P,EAAE,CAAC+P,UAAU;YAC5D,OAAO,CAAC,CAAC,CAAC,YAAY;cACdD,KAAK,EAAEA,KAAK;cACZK,SAAS,EAAEJ,UAAU,KAAK,IAAI,IAAIA,UAAU,KAAK,KAAK,CAAC,GAAGA,UAAU,GAAGxV;YAC3E,CAAC,CAAC;QACd;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD;EACA4Q,aAAa,CAACjQ,SAAS,CAACkV,mBAAmB,GAAG,UAAUrO,SAAS,EAAEhF,SAAS,EAAElD,OAAO,EAAE;IACnF,OAAOqD,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;MAC/C,OAAOmB,WAAW,CAAC,IAAI,EAAE,UAAU2B,EAAE,EAAE;QACnC,QAAQA,EAAE,CAACxB,KAAK;UACZ,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC4M,eAAe,CAACiF,YAAY,CAACtO,SAAS,EAAEhF,SAAS,EAAElD,OAAO,CAAC,CAAC;UAC9F,KAAK,CAAC;YACFmG,EAAE,CAACvB,IAAI,CAAC,CAAC;YACT,OAAO,CAAC,CAAC,CAAC,WAAW;QAC7B;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD;EACA0M,aAAa,CAACjQ,SAAS,CAACoV,uBAAuB,GAAG,UAAUvO,SAAS,EAAE;IACnE,OAAO,IAAI,CAACqK,iBAAiB,CAAChJ,IAAI,CAACxK,GAAG,CAAC,UAAUmF,CAAC,EAAE;MAAE,OAAOA,CAAC,CAACiO,MAAM,CAACvD,IAAI;IAAE,CAAC,CAAC,EAAEhQ,MAAM,CAACsD,2BAA2B,CAAC,EAAEtD,MAAM,CAAC,UAAUsF,CAAC,EAAE;MAAE,OAAOA,CAAC,CAAC7B,IAAI,KAAK6F,SAAS;IAAE,CAAC,CAAC,CAAC;EAC/K,CAAC;EACD;EACAoJ,aAAa,CAACjQ,SAAS,CAACqV,SAAS,GAAG,UAAUrJ,QAAQ,EAAEsB,IAAI,EAAE7B,OAAO,EAAE;IACnE,OAAOzJ,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;MAC/C,IAAI+I,OAAO,EAAE9F,GAAG,EAAEqQ,iBAAiB;MACnC,IAAIjF,KAAK,GAAG,IAAI;MAChB,OAAOlN,WAAW,CAAC,IAAI,EAAE,UAAU2B,EAAE,EAAE;QACnC,QAAQA,EAAE,CAACxB,KAAK;UACZ,KAAK,CAAC;YACFyH,OAAO,GAAGP,aAAa,CAAC,IAAI,CAACf,QAAQ,CAAC,CAACsB,OAAO;YAC9C,IAAIA,OAAO,EAAE;cACT,MAAM,IAAI1B,KAAK,CAAC,kDAAkD,CAAC;YACvE;YACApE,GAAG,GAAGuG,6BAA6B,CAAC;cAChCQ,QAAQ,EAAEA,QAAQ;cAClBT,gBAAgB,EAAE,IAAI,CAACA;YAC3B,CAAC,CAAC;YACF,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC2E,eAAe,CAACqF,eAAe,CAACtQ,GAAG,EAAEqI,IAAI,EAAE7B,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAAC+J,OAAO,EAAE/J,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAAC8B,IAAI,CAAC,CAAC;UAC5M,KAAK,CAAC;YACFzI,EAAE,CAACvB,IAAI,CAAC,CAAC;YACT+R,iBAAiB,GAAG9X,SAAS,CAAC,IAAI,CAAC0S,eAAe,EAAE,SAAS,CAACnS,MAAM,CAACf,uBAAuB,CAACyY,gBAAgB,CAAC,EAAE,UAAUpV,KAAK,EAAE;cAC7H,IAAIyE,EAAE;cACNzE,KAAK,CAACmQ,cAAc,CAAC,CAAC;cACtBH,KAAK,CAACH,eAAe,CAACU,SAAS,CAACC,KAAK,CAACxQ,KAAK,CAACyQ,MAAM,EAAE,CAAC,CAAC,CAAC;cACvD,IAAI,CAAC,CAAChM,EAAE,GAAGzE,KAAK,CAACyQ,MAAM,CAACvD,IAAI,MAAM,IAAI,IAAIzI,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAAC,UAAU,CAAC,MAAM,IAAI,EAAE;gBACzF,OAAOzF,SAAS;cACpB;cACA,OAAOgB,KAAK,CAACyQ,MAAM,CAACvD,IAAI;YAC5B,CAAC,CAAC;YACF,OAAO,CAAC,CAAC,CAAC,YAAY9P,cAAc,CAAC6X,iBAAiB,CAAC,CAAC;QAChE;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD;EACArF,aAAa,CAACjQ,SAAS,CAAC0V,qBAAqB,GAAG,UAAUC,QAAQ,EAAEC,SAAS,EAAE;IAC3E,OAAO5T,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;MAC/C,IAAI+I,OAAO;MACX,OAAO5H,WAAW,CAAC,IAAI,EAAE,UAAU2B,EAAE,EAAE;QACnC,QAAQA,EAAE,CAACxB,KAAK;UACZ,KAAK,CAAC;YACFyH,OAAO,GAAGP,aAAa,CAAC,IAAI,CAACf,QAAQ,CAAC,CAACsB,OAAO;YAC9C,IAAI,CAACA,OAAO,EAAE;cACV,MAAM,IAAI1B,KAAK,CAAC,uDAAuD,CAAC;YAC5E;YACA,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC6G,eAAe,CAACwF,qBAAqB,CAACC,QAAQ,EAAEC,SAAS,CAAC,CAAC;UACzF,KAAK,CAAC;YACF9Q,EAAE,CAACvB,IAAI,CAAC,CAAC;YACT,OAAO,CAAC,CAAC,CAAC,WAAW;QAC7B;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD;EACA0M,aAAa,CAACjQ,SAAS,CAAC6V,mBAAmB,GAAG,YAAY;IACtD,IAAIxF,KAAK,GAAG,IAAI;IAChB,IAAItF,OAAO,GAAGP,aAAa,CAAC,IAAI,CAACf,QAAQ,CAAC,CAACsB,OAAO;IAClD,IAAI,CAACA,OAAO,EAAE;MACV,MAAM,IAAI1B,KAAK,CAAC,wDAAwD,CAAC;IAC7E;IACA,OAAO7L,SAAS,CAAC,IAAI,CAAC0S,eAAe,EAAE,SAAS,CAACnS,MAAM,CAACf,uBAAuB,CAAC8Y,aAAa,CAAC,EAAE,UAAUzV,KAAK,EAAE;MAC7GA,KAAK,CAACmQ,cAAc,CAAC,CAAC;MACtBH,KAAK,CAACH,eAAe,CAACU,SAAS,CAACC,KAAK,CAACxQ,KAAK,CAACyQ,MAAM,EAAE,CAAC,CAAC,CAAC;MACvD,OAAOzQ,KAAK,CAACyQ,MAAM,CAACvD,IAAI,CAAChP,EAAE;IAC/B,CAAC,CAAC;EACN,CAAC;EACD;EACA0R,aAAa,CAACjQ,SAAS,CAAC+V,UAAU,GAAG,UAAUxI,IAAI,EAAE;IACjD,OAAOvL,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;MAC/C,IAAI+I,OAAO;MACX,OAAO5H,WAAW,CAAC,IAAI,EAAE,UAAU2B,EAAE,EAAE;QACnC,QAAQA,EAAE,CAACxB,KAAK;UACZ,KAAK,CAAC;YACFyH,OAAO,GAAGP,aAAa,CAAC,IAAI,CAACf,QAAQ,CAAC,CAACsB,OAAO;YAC9C,IAAI,CAACA,OAAO,EAAE;cACV,MAAM,IAAI1B,KAAK,CAAC,+CAA+C,CAAC;YACpE;YACA,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC6G,eAAe,CAAC8F,gBAAgB,CAACzI,IAAI,GAAGA,IAAI,GAAG;cAAE,UAAU,EAAE;YAAK,CAAC,CAAC,CAAC;UACnG,KAAK,CAAC;YACFzI,EAAE,CAACvB,IAAI,CAAC,CAAC;YACT,OAAO,CAAC,CAAC,CAAC,WAAW;QAC7B;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD;EACA0M,aAAa,CAACjQ,SAAS,CAACsF,UAAU,GAAG,UAAU2Q,GAAG,EAAE;IAChD,OAAOjU,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;MAC/C,OAAOmB,WAAW,CAAC,IAAI,EAAE,UAAU2B,EAAE,EAAE;QACnC,QAAQA,EAAE,CAACxB,KAAK;UACZ,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC4M,eAAe,CAAC5K,UAAU,CAAC2Q,GAAG,CAAC,CAAC;UAClE,KAAK,CAAC;YACFnR,EAAE,CAACvB,IAAI,CAAC,CAAC;YACT,OAAO,CAAC,CAAC,CAAC,WAAW;QAC7B;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD;EACA0M,aAAa,CAACjQ,SAAS,CAACkW,yBAAyB,GAAG,YAAY;IAC5D,OAAOlU,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;MAC/C,OAAOmB,WAAW,CAAC,IAAI,EAAE,UAAU+B,EAAE,EAAE;QACnC,QAAQA,EAAE,CAAC5B,KAAK;UACZ,KAAK,CAAC;YACF,IAAI,CAAC,IAAI,CAAC6S,oCAAoC,EAAE,OAAO,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC;YACvEjR,EAAE,CAAC5B,KAAK,GAAG,CAAC;UAChB,KAAK,CAAC;YACF4B,EAAE,CAAC1B,IAAI,CAACc,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,GAAI,CAAC,CAAC,CAAC;YACzB,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC6R,oCAAoC,CAAC;UACnE,KAAK,CAAC;YACFjR,EAAE,CAAC3B,IAAI,CAAC,CAAC;YACT,OAAO,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC;UAC3B,KAAK,CAAC;YACF2B,EAAE,CAAC3B,IAAI,CAAC,CAAC;YACT,OAAO,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC;UAC3B,KAAK,CAAC;YACF2B,EAAE,CAAC1B,IAAI,CAACc,IAAI,CAAC,CAAC,CAAC,GAAI,CAAC,EAAE,CAAC,CAAC,CAAC;YACzB,IAAI,CAAC6R,oCAAoC,GACrC,IAAI,CAACC,iCAAiC,CAAC,CAAC;YAC5C,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAACD,oCAAoC,CAAC;UACnE,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,YAAYjR,EAAE,CAAC3B,IAAI,CAAC,CAAC,CAAC;UACxC,KAAK,CAAC;YACF,IAAI,CAAC4S,oCAAoC,GAAG9W,SAAS;YACrD,OAAO,CAAC,CAAC,CAAC,eAAe;UAC7B,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,WAAW;QACjC;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD4Q,aAAa,CAACjQ,SAAS,CAACoW,iCAAiC,GAAG,YAAY;IACpE,OAAOpU,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;MAC/C,IAAIqU,kBAAkB,EAAEC,WAAW,EAAEC,KAAK;MAC1C,IAAIzR,EAAE;MACN,OAAO3B,WAAW,CAAC,IAAI,EAAE,UAAU+B,EAAE,EAAE;QACnC,QAAQA,EAAE,CAAC5B,KAAK;UACZ,KAAK,CAAC;YACF+S,kBAAkB,GAAG,EAAE,GAAG,IAAI;YAC9B,IAAI,IAAI,CAACG,iBAAiB,IACtB,IAAI,CAACA,iBAAiB,CAACC,SAAS,GAAGJ,kBAAkB,GAAG9G,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE;cACpE,OAAO,CAAC,CAAC,CAAC,YAAY,IAAI,CAACgH,iBAAiB,CAACF,WAAW,CAAC;YAC7D;YACApR,EAAE,CAAC5B,KAAK,GAAG,CAAC;UAChB,KAAK,CAAC;YACF4B,EAAE,CAAC1B,IAAI,CAACc,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,GAAI,CAAC,CAAC,CAAC;YACzB,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC4L,eAAe,CAACgG,yBAAyB,CAAC,CAAC,CAAC;UAC1E,KAAK,CAAC;YACFI,WAAW,GAAGpR,EAAE,CAAC3B,IAAI,CAAC,CAAC;YACvB,IAAI,CAACiT,iBAAiB,GAAG;cACrBF,WAAW,EAAEA,WAAW;cACxBG,SAAS,EAAElH,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC1K,EAAE,GAAGwR,WAAW,CAACI,UAAU,MAAM,IAAI,IAAI5R,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG,CAAC,IAAI;YACjG,CAAC;YACD,OAAO,CAAC,CAAC,CAAC,YAAYwR,WAAW,CAAC;UACtC,KAAK,CAAC;YACFC,KAAK,GAAGrR,EAAE,CAAC3B,IAAI,CAAC,CAAC;YACjB,IAAI,CAACiT,iBAAiB,GAAGnX,SAAS;YAClC,MAAMkX,KAAK;UACf,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,WAAW;QACjC;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD;EACAtG,aAAa,CAACjQ,SAAS,CAAC2W,kBAAkB,GAAG,YAAY;IACrD,OAAO9Y,IAAI,CAAC,IAAI,CAACqS,eAAe,CAAC0G,cAAc,CAAC,CAAC,CAAC,CAAC1O,IAAI;IACvD;IACA;IACAxK,GAAG,CAAC,UAAUoH,EAAE,EAAE;MACd,IAAI+R,IAAI,GAAG/R,EAAE,CAAC+R,IAAI;QAAEC,QAAQ,GAAGhS,EAAE,CAACgS,QAAQ;QAAEC,QAAQ,GAAGjS,EAAE,CAACiS,QAAQ;MAClE,OAAQ;QACJC,IAAI,EAAEH,IAAI;QACVC,QAAQ,EAAEA,QAAQ;QAClBG,UAAU,EAAEF;MAChB,CAAC;IACL,CAAC,CAAC,CAAC;EACP,CAAC;EACD;EACA9G,aAAa,CAACjQ,SAAS,CAACkX,mBAAmB,GAAG,UAAUC,UAAU,EAAE1L,OAAO,EAAE;IACzE,OAAOzJ,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;MAC/C,IAAIoV,OAAO;MACX,OAAOjU,WAAW,CAAC,IAAI,EAAE,UAAU2B,EAAE,EAAE;QACnC,QAAQA,EAAE,CAACxB,KAAK;UACZ,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC4M,eAAe,CAACgH,mBAAmB,CAACC,UAAU,EAAE1L,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAACsJ,KAAK,CAAC,CAAC;UACnJ,KAAK,CAAC;YACFqC,OAAO,GAAItS,EAAE,CAACvB,IAAI,CAAC,CAAC,CAAE6T,OAAO;YAC7B,OAAO,CAAC,CAAC,CAAC,YAAY;cACdA,OAAO,EAAEA,OAAO,CAAC1Z,GAAG,CAAC,UAAUoH,EAAE,EAAE;gBAC/B,IAAIuS,OAAO,GAAGvS,EAAE,CAACuS,OAAO;kBAAEC,YAAY,GAAGxS,EAAE,CAACwS,YAAY;kBAAE1O,UAAU,GAAG9D,EAAE,CAAC8D,UAAU;gBACpF,OAAQ;kBACJhC,MAAM,EAAEyQ,OAAO;kBACfpN,WAAW,EAAEqN,YAAY;kBACzBpN,SAAS,EAAEtB;gBACf,CAAC;cACL,CAAC;YACL,CAAC,CAAC;QACd;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD;EACAqH,aAAa,CAACjQ,SAAS,CAACuX,cAAc,GAAG,YAAY;IACjD,OAAOvV,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;MAC/C,OAAOmB,WAAW,CAAC,IAAI,EAAE,UAAU2B,EAAE,EAAE;QACnC,QAAQA,EAAE,CAACxB,KAAK;UACZ,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC4M,eAAe,CAACqH,cAAc,CAAC,CAAC,CAAC;UACnE,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,YAAYzS,EAAE,CAACvB,IAAI,CAAC,CAAC,CAAC;QAC5C;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD;EACA0M,aAAa,CAACjQ,SAAS,CAACwX,UAAU,GAAG,UAAUC,IAAI,EAAE;IACjD,OAAOzV,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;MAC/C,OAAOmB,WAAW,CAAC,IAAI,EAAE,UAAU2B,EAAE,EAAE;QACnC,QAAQA,EAAE,CAACxB,KAAK;UACZ,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC4M,eAAe,CAACsH,UAAU,CAACC,IAAI,CAAC,CAAC;UACnE,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,YAAY3S,EAAE,CAACvB,IAAI,CAAC,CAAC,CAAC;QAC5C;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD;EACA0M,aAAa,CAACjQ,SAAS,CAAC0X,YAAY,GAAG,UAAUC,UAAU,EAAE;IACzD,OAAO3V,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;MAC/C,OAAOmB,WAAW,CAAC,IAAI,EAAE,UAAU2B,EAAE,EAAE;QACnC,QAAQA,EAAE,CAACxB,KAAK;UACZ,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC4M,eAAe,CAACwH,YAAY,CAACC,UAAU,CAAC,CAAC;UAC3E,KAAK,CAAC;YAAE,OAAO,CAAC,CAAC,CAAC,YAAY7S,EAAE,CAACvB,IAAI,CAAC,CAAC,CAAC;QAC5C;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN,CAAC;EACD,OAAO0M,aAAa;AACxB,CAAC,CAAC,CAAE;AAEJ,SAASvI,oBAAoB,EAAEhC,wBAAwB,EAAE+C,uBAAuB,EAAElE,0BAA0B,EAAE0L,aAAa,EAAEhC,eAAe,EAAElH,uBAAuB,EAAExB,qBAAqB,EAAEmE,0BAA0B,EAAEZ,0BAA0B,EAAEiB,uBAAuB,EAAE7L,gCAAgC,EAAEsN,6BAA6B,EAAElD,UAAU,EAAEH,kBAAkB,EAAE3J,wBAAwB,EAAE4I,cAAc,EAAEV,iBAAiB,EAAEQ,kBAAkB,EAAEoE,mBAAmB,EAAEhL,WAAW,EAAEF,YAAY,EAAEmI,yBAAyB,EAAEvC,2BAA2B,EAAE2B,qBAAqB,EAAEpH,gBAAgB,EAAEoI,2BAA2B,EAAEhI,iBAAiB,IAAIiX,iBAAiB,EAAE/W,2BAA2B,EAAEwO,iCAAiC,EAAE7K,cAAc,EAAEwD,sBAAsB,EAAEwC,aAAa,EAAE3C,WAAW,EAAEsF,wBAAwB,EAAEsC,6BAA6B","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}