{"ast":null,"code":"import React,{useState,useCallback,useEffect}from'react';import{useWidgetApi}from'@matrix-widget-toolkit/react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const RatingWidget=()=>{const[rating,setRating]=useState(0);const[hoverRating,setHoverRating]=useState(0);const[feedback,setFeedback]=useState('');const[isSubmitting,setIsSubmitting]=useState(false);const widgetApi=useWidgetApi();// Получаем event_id из URL параметров\nconst getEventId=useCallback(()=>{const urlParams=new URLSearchParams(window.location.search);return urlParams.get('event_id');},[]);const sendRating=useCallback(async stars=>{const eventId=getEventId();if(!eventId){setFeedback('Локальное тестирование - реакция не отправлена');return;}setIsSubmitting(true);setFeedback('Отправляем оценку...');try{await widgetApi.sendRoomEvent('m.reaction',{'m.relates_to':{rel_type:'m.annotation',event_id:eventId,key:`rating:${stars}`}});setFeedback(`Спасибо! Вы поставили ${stars} ${stars===1?'звезду':stars<5?'звезды':'звёзд'}`);}catch(error){console.error('Ошибка отправки реакции:',error);setFeedback('Ошибка при отправке оценки');}finally{setIsSubmitting(false);}},[widgetApi,getEventId]);const handleStarClick=useCallback(stars=>{if(isSubmitting)return;setRating(stars);sendRating(stars);},[sendRating,isSubmitting]);const handleStarHover=useCallback(stars=>{if(!isSubmitting){setHoverRating(stars);}},[isSubmitting]);const handleMouseLeave=useCallback(()=>{setHoverRating(0);},[]);// Проверяем наличие event_id при загрузке\nuseEffect(()=>{const eventId=getEventId();if(!eventId){setFeedback('Режим предварительного просмотра');}},[getEventId]);const renderStars=()=>{const stars=[];const displayRating=hoverRating||rating;for(let i=1;i<=5;i++){stars.push(/*#__PURE__*/_jsx(\"span\",{className:`star ${i<=displayRating?'active':''}`,onClick:()=>handleStarClick(i),onMouseEnter:()=>handleStarHover(i),style:{cursor:isSubmitting?'not-allowed':'pointer',opacity:isSubmitting?0.6:1},children:\"\\u2605\"},i));}return stars;};return/*#__PURE__*/_jsxs(\"div\",{className:\"rating-widget\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"rating-title\",children:\"\\u041E\\u0446\\u0435\\u043D\\u0438\\u0442\\u0435 \\u043E\\u0442\\u0432\\u0435\\u0442 \\u0431\\u043E\\u0442\\u0430\"}),/*#__PURE__*/_jsx(\"div\",{className:\"stars-container\",onMouseLeave:handleMouseLeave,children:renderStars()}),/*#__PURE__*/_jsx(\"div\",{className:\"rating-feedback\",children:feedback})]});};export default RatingWidget;","map":{"version":3,"names":["React","useState","useCallback","useEffect","useWidgetApi","jsx","_jsx","jsxs","_jsxs","RatingWidget","rating","setRating","hoverRating","setHoverRating","feedback","setFeedback","isSubmitting","setIsSubmitting","widgetApi","getEventId","urlParams","URLSearchParams","window","location","search","get","sendRating","stars","eventId","sendRoomEvent","rel_type","event_id","key","error","console","handleStarClick","handleStarHover","handleMouseLeave","renderStars","displayRating","i","push","className","onClick","onMouseEnter","style","cursor","opacity","children","onMouseLeave"],"sources":["C:/Users/pilat/Documents/Knwlab/matrix-bot-widget/src/components/RatingWidget.js"],"sourcesContent":["import React, { useState, useCallback, useEffect } from 'react';\r\nimport { useWidgetApi } from '@matrix-widget-toolkit/react';\r\n\r\nconst RatingWidget = () => {\r\n  const [rating, setRating] = useState(0);\r\n  const [hoverRating, setHoverRating] = useState(0);\r\n  const [feedback, setFeedback] = useState('');\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  \r\n  const widgetApi = useWidgetApi();\r\n\r\n  // Получаем event_id из URL параметров\r\n  const getEventId = useCallback(() => {\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    return urlParams.get('event_id');\r\n  }, []);\r\n\r\n  const sendRating = useCallback(async (stars) => {\r\n    const eventId = getEventId();\r\n    if (!eventId) {\r\n      setFeedback('Локальное тестирование - реакция не отправлена');\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n    setFeedback('Отправляем оценку...');\r\n\r\n    try {\r\n      await widgetApi.sendRoomEvent('m.reaction', {\r\n        'm.relates_to': {\r\n          rel_type: 'm.annotation',\r\n          event_id: eventId,\r\n          key: `rating:${stars}`\r\n        }\r\n      });\r\n      \r\n      setFeedback(`Спасибо! Вы поставили ${stars} ${stars === 1 ? 'звезду' : stars < 5 ? 'звезды' : 'звёзд'}`);\r\n    } catch (error) {\r\n      console.error('Ошибка отправки реакции:', error);\r\n      setFeedback('Ошибка при отправке оценки');\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  }, [widgetApi, getEventId]);\r\n\r\n  const handleStarClick = useCallback((stars) => {\r\n    if (isSubmitting) return;\r\n    \r\n    setRating(stars);\r\n    sendRating(stars);\r\n  }, [sendRating, isSubmitting]);\r\n\r\n  const handleStarHover = useCallback((stars) => {\r\n    if (!isSubmitting) {\r\n      setHoverRating(stars);\r\n    }\r\n  }, [isSubmitting]);\r\n\r\n  const handleMouseLeave = useCallback(() => {\r\n    setHoverRating(0);\r\n  }, []);\r\n\r\n  // Проверяем наличие event_id при загрузке\r\n  useEffect(() => {\r\n    const eventId = getEventId();\r\n    if (!eventId) {\r\n      setFeedback('Режим предварительного просмотра');\r\n    }\r\n  }, [getEventId]);\r\n\r\n  const renderStars = () => {\r\n    const stars = [];\r\n    const displayRating = hoverRating || rating;\r\n\r\n    for (let i = 1; i <= 5; i++) {\r\n      stars.push(\r\n        <span\r\n          key={i}\r\n          className={`star ${i <= displayRating ? 'active' : ''}`}\r\n          onClick={() => handleStarClick(i)}\r\n          onMouseEnter={() => handleStarHover(i)}\r\n          style={{ \r\n            cursor: isSubmitting ? 'not-allowed' : 'pointer',\r\n            opacity: isSubmitting ? 0.6 : 1\r\n          }}\r\n        >\r\n          ★\r\n        </span>\r\n      );\r\n    }\r\n\r\n    return stars;\r\n  };\r\n\r\n  return (\r\n    <div className=\"rating-widget\">\r\n      <h3 className=\"rating-title\">Оцените ответ бота</h3>\r\n      <div \r\n        className=\"stars-container\" \r\n        onMouseLeave={handleMouseLeave}\r\n      >\r\n        {renderStars()}\r\n      </div>\r\n      <div className=\"rating-feedback\">\r\n        {feedback}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RatingWidget;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}